{"error": null, "response": {"classes": [{"cls_lc": [[63, 0], [227, 31]], "cls_var_ln": {}, "cls_var_occur": {}, "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[65, 4], [70, 33]], "fn_var_ln": {"char_list": [[66, 8], [66, 17]]}, "fn_var_occur": {"char_list": [["char_list", "append", "random", "choice", "string", "printable"], ["join", "char_list"]]}, "name": "_gen_random_string", "params": {"seed": "", "str_len": ""}, "params_descr": {"seed": "", "str_len": ""}, "params_occur": {"seed": [["random", "seed", "str", "seed", "char_seed"]], "str_len": [["range", "str_len"]]}, "params_p": {"args": [], "kwargs": [], "seed": [["str", 0.6944642335147146], ["List[str]", 0.23281314710015946], ["int", 0.07272261938512586]], "self": [], "str_len": [["str", 0.9999999992822926], ["int", 4.236013474490734e-10]]}, "q_name": "TestAirflowKubernetesScheduler._gen_random_string", "ret_exprs": ["return \"\".join(char_list)"], "ret_type": "", "ret_type_p": [["str", 0.2911387231972773], ["Set[int]", 0.1690827673467596], ["pathlib.Path", 0.10249836768670775], ["bool", 0.10249836768670775]], "variables": {"char_list": ""}, "variables_p": {"char_list": [["list", 0.5685233554904632], ["List[bool]", 0.24712412637116513], ["List[str]", 0.18435251813837156]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[72, 4], [88, 20]], "fn_var_ln": {"cases": [[73, 8], [73, 13]]}, "fn_var_occur": {"cases": [["cases", "extend", "self", "_gen_random_string", "seed", "self", "_gen_random_string", "seed", "seed", "range"]]}, "name": "_cases", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["cases", "extend", "self", "_gen_random_string", "seed", "self", "_gen_random_string", "seed", "seed", "range"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler._cases", "ret_exprs": ["return cases"], "ret_type": "", "ret_type_p": [["int", 0.30000000000000004], ["Callable", 0.2], ["models.Question", 0.1], ["str", 0.1]], "variables": {"cases": ""}, "variables_p": {"cases": [["str", 0.31292474506302714], ["Set[str]", 0.08859374336878491]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[91, 4], [93, 98]], "fn_var_ln": {"regex": [[92, 8], [92, 13]]}, "fn_var_occur": {"regex": [["len", "name", "all", "ch", "lower", "ch", "ch", "name", "re", "match", "regex", "name"]]}, "name": "_is_valid_pod_id", "params": {"name": ""}, "params_descr": {"name": ""}, "params_occur": {"name": [["len", "name", "all", "ch", "lower", "ch", "ch", "name", "re", "match", "regex", "name"]]}, "params_p": {"args": [], "kwargs": [], "name": [["str", 0.9125556390671536], ["Optional[str]", 0.08744436093284629]], "self": []}, "q_name": "TestAirflowKubernetesScheduler._is_valid_pod_id", "ret_exprs": ["return len(name) <= 253 and all(ch.lower() == ch for ch in name) and re.match(regex, name)"], "ret_type": "", "ret_type_p": [["str", 0.20488696700491377], ["audiopyle.lib.models.plugin.VampyPlugin", 0.14291714146847312], ["bool", 0.09005126449871143]], "variables": {"regex": ""}, "variables_p": {"regex": [["str", 0.4357949369099319], ["dict", 0.24139124036403345], ["pathlib.Path", 0.08556802377573237], ["Dict[Any, List[str]]", 0.07833877460420507]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[96, 4], [98, 58]], "fn_var_ln": {"regex": [[97, 8], [97, 13]]}, "fn_var_occur": {"regex": [["len", "value", "re", "match", "regex", "value"]]}, "name": "_is_safe_label_value", "params": {"value": ""}, "params_descr": {"value": ""}, "params_occur": {"value": [["len", "value", "re", "match", "regex", "value"]]}, "params_p": {"args": [], "kwargs": [], "self": [], "value": [["str", 0.8811730476433928], ["Iterable[str]", 0.11882695235660701]]}, "q_name": "TestAirflowKubernetesScheduler._is_safe_label_value", "ret_exprs": ["return len(value) <= 63 and re.match(regex, value)"], "ret_type": "", "ret_type_p": [["bool", 0.2967314516561901], ["str", 0.08283793735764482]], "variables": {"regex": ""}, "variables_p": {"regex": [["Pattern[str]", 0.29445780600672844], ["str", 0.29030106856437443], ["Tuple[str, str, str]", 0.11514127571086548], ["int", 0.11011392217061781], ["Pattern", 0.09538144370734011], ["List[str]", 0.09460448384007374]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[103, 4], [106, 50]], "fn_var_ln": {"pod_name": [[105, 12], [105, 20]]}, "fn_var_occur": {"pod_name": [["pod_name", "PodGenerator", "make_unique_pod_id", "create_pod_id", "dag_id", "task_id"], ["self", "_is_valid_pod_id", "pod_name"]]}, "name": "test_create_pod_id", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "_cases"], ["self", "_is_valid_pod_id", "pod_name"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler.test_create_pod_id", "ret_exprs": [], "ret_type": "", "variables": {"pod_name": ""}, "variables_p": {"pod_name": [["str", 0.7318047309050386], ["int", 0.09029078136127532], ["transfer.models.SnippetID", 0.08895224386684286]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[113, 4], [140, 70]], "fn_var_ln": {"expected_pod_dict": [[130, 12], [130, 29]], "path": [[128, 8], [128, 12]], "pod_template_file": [[137, 8], [137, 41]], "pod_template_file_path": [[132, 8], [132, 30]]}, "fn_var_occur": {"expected_pod_dict": [["expected_pod_dict", "yaml", "safe_load", "stream"], ["mock_generator", "mock_calls", "expected_pod_dict"], ["mock_generator", "mock_calls", "expected_pod_dict"]], "path": [["path", "sys", "path"], ["open", "path", "stream"], ["pod_template_file_path", "path"], ["mock_kubeconfig", "pod_template_file", "path"]], "pod_template_file": [["mock_kubeconfig", "pod_template_file"], ["mock_kubeconfig", "pod_template_file", "path"]], "pod_template_file_path": [["get_base_pod_from_template", "pod_template_file_path", "None"], ["pod_template_file_path", "path"], ["get_base_pod_from_template", "pod_template_file_path", "None"]]}, "name": "test_get_base_pod_from_template", "params": {"mock_generator": "", "mock_kubeconfig": "", "self": ""}, "params_descr": {"mock_generator": "", "mock_kubeconfig": "", "self": ""}, "params_occur": {"mock_generator": [["mock_generator", "mock_calls"], ["mock_generator", "mock_calls", "None"], ["mock_generator", "mock_calls"], ["mock_generator", "mock_calls", "None"], ["mock_generator", "mock_calls"], ["mock_generator", "mock_calls", "expected_pod_dict"], ["mock_generator", "mock_calls"], ["mock_generator", "mock_calls", "expected_pod_dict"]], "mock_kubeconfig": [["mock_kubeconfig", "pod_template_file"], ["get_base_pod_from_template", "None", "mock_kubeconfig"], ["mock_kubeconfig", "pod_template_file", "path"], ["get_base_pod_from_template", "None", "mock_kubeconfig"]], "self": []}, "params_p": {"args": [], "kwargs": [], "mock_generator": [["mock.Mock", 0.12095412622465813]], "mock_kubeconfig": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler.test_get_base_pod_from_template", "ret_exprs": [], "ret_type": "", "variables": {"expected_pod_dict": "", "path": "", "pod_template_file": "", "pod_template_file_path": ""}, "variables_p": {"expected_pod_dict": [["str", 0.19960556334194615], ["Dict[str, int]", 0.11247110702555181], ["Dict[str, List[Any]]", 0.09872002484811217], ["tests.utils.MockCoroutine", 0.09789520194821522]], "path": [["str", 0.4163605038524193], ["tests.helpers.NamedIO", 0.11869838765514515], ["Dict[str, Any]", 0.11338163721162718]], "pod_template_file": [["str", 1.0]], "pod_template_file_path": [["pathlib.Path", 0.37068587049109425], ["str", 0.3240522819594033], ["Dict[pathlib.Path, fast-hashdeep.FileDescription]", 0.10712467206728556], ["tensorflow.keras.models.Model", 0.08884481510544288]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[142, 4], [151, 104]], "fn_var_ln": {"dag_id": [[150, 12], [150, 18]], "safe_dag_id": [[144, 12], [144, 23]], "safe_task_id": [[146, 12], [146, 24]]}, "fn_var_occur": {"dag_id": [["safe_dag_id", "pod_generator", "make_safe_label_value", "dag_id"], ["dag_id", "pod_generator", "make_safe_label_value", "dag_id"], ["pod_generator", "make_safe_label_value", "dag_id"]], "safe_dag_id": [["safe_dag_id", "pod_generator", "make_safe_label_value", "dag_id"], ["self", "_is_safe_label_value", "safe_dag_id"]], "safe_task_id": [["safe_task_id", "pod_generator", "make_safe_label_value", "task_id"], ["self", "_is_safe_label_value", "safe_task_id"]]}, "name": "test_make_safe_label_value", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "_cases"], ["self", "_is_safe_label_value", "safe_dag_id"], ["self", "_is_safe_label_value", "safe_task_id"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler.test_make_safe_label_value", "ret_exprs": [], "ret_type": "", "variables": {"dag_id": "", "safe_dag_id": "", "safe_task_id": ""}, "variables_p": {"dag_id": [["int", 0.4246225351660493], ["List[int]", 0.1796004747892002], ["str", 0.12288291219368855], ["Iterator[Any]", 0.09218443222224629], ["List[str]", 0.09156174434764222], ["list", 0.0891479012811736]], "safe_dag_id": [["int", 0.39863289856313044], ["List[int]", 0.19715696542747385], ["list", 0.07919543027202829], ["str", 0.07757601900497864], ["RuntimeError", 0.07581872858944422]], "safe_task_id": [["str", 0.4018518567753289], ["dict", 0.1881240752244932], ["Dict[str, Union[Any, Any]]", 0.08540045410311725], ["Tuple[Literal, Literal]", 0.08411745194566725]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[153, 4], [158, 47]], "fn_var_ln": {"datetime_obj": [[154, 8], [154, 20]], "new_datetime_obj": [[156, 8], [156, 24]], "serialized_datetime": [[155, 8], [155, 27]]}, "fn_var_occur": {"datetime_obj": [["datetime_obj", "datetime", "now"], ["serialized_datetime", "pod_generator", "datetime_to_label_safe_datestring", "datetime_obj"], ["datetime_obj", "new_datetime_obj"]], "new_datetime_obj": [["new_datetime_obj", "pod_generator", "label_safe_datestring_to_datetime", "serialized_datetime"], ["datetime_obj", "new_datetime_obj"]], "serialized_datetime": [["serialized_datetime", "pod_generator", "datetime_to_label_safe_datestring", "datetime_obj"], ["new_datetime_obj", "pod_generator", "label_safe_datestring_to_datetime", "serialized_datetime"]]}, "name": "test_execution_date_serialize_deserialize", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": []}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler.test_execution_date_serialize_deserialize", "ret_exprs": [], "ret_type": "", "variables": {"datetime_obj": "", "new_datetime_obj": "", "serialized_datetime": ""}, "variables_p": {"datetime_obj": [["datetime.datetime.datetime", 0.48262342989751916], ["datetime.datetime", 0.2998813232880289], ["datetime.datetime.timedelta", 0.12740412600834677], ["datetime.date", 0.09009112080610533]], "new_datetime_obj": [["datetime.datetime", 0.25685945504320257], ["int", 0.2182264964197313], ["datetime.datetime.datetime", 0.18405100618702597], ["Dict[str, Dict[int, Any]]", 0.13316998116064396], ["str", 0.11579786280598099], ["datetime.date", 0.09189519838341516]], "serialized_datetime": [["dict", 0.2571561763887495], ["float", 0.13641061772026586], ["cmk.utils.piggyback.PiggybackTimeSettings", 0.09605253255322896], ["raiden.transfer.mediated_transfer.state.LockedTransferUnsignedState", 0.09087186711118571], ["raiden.transfer.state.NettingChannelState", 0.08741457131689181]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[166, 4], [180, 31]], "fn_var_ln": {"job_id": [[174, 8], [174, 28]], "kube_executor": [[173, 8], [173, 21]], "mock_delete_namespace": [[170, 8], [170, 29]], "namespace": [[168, 8], [168, 17]], "pod_name": [[167, 8], [167, 16]]}, "fn_var_occur": {"job_id": [["kube_executor", "job_id"]], "kube_executor": [["kube_executor", "KubernetesExecutor"], ["kube_executor", "job_id"], ["kube_executor", "start"], ["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["kube_executor", "end"]], "mock_delete_namespace": [["mock_delete_namespace", "mock", "MagicMock"], ["mock_kube_client", "return_value", "delete_namespaced_pod", "mock_delete_namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "namespace": [["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "pod_name": [["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]]}, "name": "test_delete_pod_successfully", "params": {"mock_client": "", "mock_kube_client": "", "mock_watcher": "", "self": ""}, "params_descr": {"mock_client": "", "mock_kube_client": "", "mock_watcher": "", "self": ""}, "params_occur": {"mock_client": [["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "mock_kube_client": [["mock_kube_client", "return_value", "delete_namespaced_pod", "mock_delete_namespace"]], "mock_watcher": [], "self": []}, "params_p": {"args": [], "kwargs": [], "mock_client": [["tests.test_util.aiohttp.AiohttpClientMocker", 0.3861363416103016]], "mock_kube_client": [], "mock_watcher": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler.test_delete_pod_successfully", "ret_exprs": [], "ret_type": "", "variables": {"job_id": "", "kube_executor": "", "mock_delete_namespace": "", "namespace": "", "pod_name": ""}, "variables_p": {"job_id": [["str", 0.8897319347700274], ["Type[int]", 0.11026806522997254]], "kube_executor": [["Tuple[str, str, str, str]", 0.11619024886791716], ["str", 0.08991558949907591]], "mock_delete_namespace": [], "namespace": [["str", 0.11192417573988606], ["int", 0.08142020991162698]], "pod_name": [["str", 0.6030588849116498], ["string.Template", 0.31062639494744404]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[188, 4], [203, 109]], "fn_var_ln": {"job_id": [[198, 8], [198, 28]], "kube_executor": [[197, 8], [197, 21]], "mock_delete_namespace": [[192, 8], [192, 29]], "namespace": [[190, 8], [190, 17]], "pod_name": [[189, 8], [189, 16]]}, "fn_var_occur": {"job_id": [["kube_executor", "job_id"]], "kube_executor": [["kube_executor", "KubernetesExecutor"], ["kube_executor", "job_id"], ["kube_executor", "start"], ["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"]], "mock_delete_namespace": [["mock_delete_namespace", "mock", "MagicMock"], ["mock_kube_client", "return_value", "delete_namespaced_pod", "mock_delete_namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "namespace": [["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "pod_name": [["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]]}, "name": "test_delete_pod_raises_404", "params": {"mock_client": "", "mock_kube_client": "", "mock_watcher": "", "self": ""}, "params_descr": {"mock_client": "", "mock_kube_client": "", "mock_watcher": "", "self": ""}, "params_occur": {"mock_client": [["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "mock_kube_client": [["mock_kube_client", "return_value", "delete_namespaced_pod", "mock_delete_namespace"], ["mock_kube_client", "return_value", "delete_namespaced_pod", "side_effect", "ApiException", "status"]], "mock_watcher": [], "self": []}, "params_p": {"args": [], "kwargs": [], "mock_client": [["tests.test_util.aiohttp.AiohttpClientMocker", 0.3861363416103016]], "mock_kube_client": [], "mock_watcher": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler.test_delete_pod_raises_404", "ret_exprs": [], "ret_type": "", "variables": {"job_id": "", "kube_executor": "", "mock_delete_namespace": "", "namespace": "", "pod_name": ""}, "variables_p": {"job_id": [["str", 0.8897319347700274], ["Type[int]", 0.11026806522997254]], "kube_executor": [["Tuple[str, str, str, str]", 0.10859626579440376]], "mock_delete_namespace": [], "namespace": [["str", 0.11192417573988606], ["int", 0.08142020991162698]], "pod_name": [["str", 0.6030588849116498], ["string.Template", 0.31062639494744404]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[211, 4], [227, 31]], "fn_var_ln": {"job_id": [[221, 8], [221, 28]], "kube_executor": [[220, 8], [220, 21]], "mock_delete_namespace": [[215, 8], [215, 29]], "namespace": [[213, 8], [213, 17]], "pod_name": [[212, 8], [212, 16]]}, "fn_var_occur": {"job_id": [["kube_executor", "job_id"]], "kube_executor": [["kube_executor", "KubernetesExecutor"], ["kube_executor", "job_id"], ["kube_executor", "start"], ["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["kube_executor", "end"]], "mock_delete_namespace": [["mock_delete_namespace", "mock", "MagicMock"], ["mock_kube_client", "return_value", "delete_namespaced_pod", "mock_delete_namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "namespace": [["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "pod_name": [["kube_executor", "kube_scheduler", "delete_pod", "pod_name", "namespace"], ["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]]}, "name": "test_delete_pod_404_not_raised", "params": {"mock_client": "", "mock_kube_client": "", "mock_watcher": "", "self": ""}, "params_descr": {"mock_client": "", "mock_kube_client": "", "mock_watcher": "", "self": ""}, "params_occur": {"mock_client": [["mock_delete_namespace", "assert_called_with", "pod_name", "namespace", "body", "mock_client", "V1DeleteOptions"]], "mock_kube_client": [["mock_kube_client", "return_value", "delete_namespaced_pod", "mock_delete_namespace"], ["mock_kube_client", "return_value", "delete_namespaced_pod", "side_effect", "ApiException", "status"]], "mock_watcher": [], "self": []}, "params_p": {"args": [], "kwargs": [], "mock_client": [["tests.test_util.aiohttp.AiohttpClientMocker", 0.3861363416103016]], "mock_kube_client": [], "mock_watcher": [], "self": []}, "q_name": "TestAirflowKubernetesScheduler.test_delete_pod_404_not_raised", "ret_exprs": [], "ret_type": "", "variables": {"job_id": "", "kube_executor": "", "mock_delete_namespace": "", "namespace": "", "pod_name": ""}, "variables_p": {"job_id": [["str", 0.8897319347700274], ["Type[int]", 0.11026806522997254]], "kube_executor": [["Tuple[str, str, str, str]", 0.11619024886791716], ["str", 0.08991558949907591]], "mock_delete_namespace": [], "namespace": [["str", 0.11192417573988606], ["int", 0.08142020991162698]], "pod_name": [["str", 0.6030588849116498], ["string.Template", 0.31062639494744404]]}}], "name": "TestAirflowKubernetesScheduler", "q_name": "TestAirflowKubernetesScheduler", "variables": {}, "variables_p": {}}, {"cls_lc": [[230, 0], [1200, 44]], "cls_var_ln": {}, "cls_var_occur": {}, "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[236, 4], [238, 43]], "fn_var_ln": {"kubernetes_executor": [[237, 8], [237, 32]]}, "fn_var_occur": {"kubernetes_executor": [["self", "kubernetes_executor", "KubernetesExecutor"], ["self", "kubernetes_executor", "job_id"]]}, "name": "setup_method", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "kubernetes_executor", "KubernetesExecutor"], ["self", "kubernetes_executor", "job_id"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesExecutor.setup_method", "ret_exprs": [], "ret_type": "None", "variables": {"kubernetes_executor": ""}, "variables_p": {"kubernetes_executor": [["str", 0.31276585839807514], ["int", 0.12334518510488693], ["Dict[str, int]", 0.10445953058969241], ["Tuple[Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal]", 0.09812908968633197], ["Final", 0.08917123675610446]]}}, {"docstring": {"func": "When pod scheduling fails with either reason 'Forbidden', or any reason not yet", "long_descr": "handled in the relevant try-except block, the task should stay in the ``task_queue``\nand be attempted on a subsequent executor sync.  When reason is 'Unprocessable Entity'\nor 'BadRequest', the task should be failed without being re-queued.\n\nNote on error scenarios:\n\n- 403 Forbidden will be returned when your request exceeds namespace quota.\n- 422 Unprocessable Entity is returned when your parameters are valid but unsupported\n    e.g. limits lower than requests.\n- 400 BadRequest is returned when your parameters are invalid e.g. asking for cpu=100ABC123.", "ret": null}, "fn_lc": [[254, 4], [316, 41]], "fn_var_ln": {"api_client": [[281, 8], [281, 35]], "config": [[282, 8], [282, 14]], "create_namespaced_pod": [[277, 8], [277, 46]], "kubernetes_executor": [[286, 12], [286, 31]], "mock_api_client": [[279, 8], [279, 23]], "mock_kube_client": [[276, 8], [276, 24]], "path": [[271, 8], [271, 12]], "response": [[273, 8], [273, 16]], "return_value": [[278, 8], [278, 41]], "task_instance_key": [[291, 16], [291, 33]], "try_number": [[290, 16], [290, 26]]}, "fn_var_occur": {"api_client": [["mock_kube_client", "api_client", "mock_api_client"]], "config": [["config", "path"], ["conf_vars", "config"]], "create_namespaced_pod": [["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock", "side_effect", "ApiException", "http_resp", "response"], ["mock_kube_client", "create_namespaced_pod", "call_count"], ["mock_kube_client", "create_namespaced_pod", "side_effect", "None"], ["mock_kube_client", "create_namespaced_pod", "reset_mock"], ["mock_kube_client", "create_namespaced_pod", "called"]], "kubernetes_executor": [["kubernetes_executor", "self", "kubernetes_executor"], ["kubernetes_executor", "start"], ["kubernetes_executor", "execute_async", "key", "task_instance_key", "queue", "None", "command"], ["kubernetes_executor", "sync"], ["kubernetes_executor", "task_queue", "empty"], ["kubernetes_executor", "sync"], ["kubernetes_executor", "task_queue", "empty"], ["kubernetes_executor", "task_queue", "empty"], ["kubernetes_executor", "event_buffer", "task_instance_key", "State", "FAILED"], ["kubernetes_executor", "end"]], "mock_api_client": [["mock_api_client", "mock", "MagicMock"], ["mock_api_client", "sanitize_for_serialization", "return_value"], ["mock_kube_client", "api_client", "mock_api_client"]], "mock_kube_client": [["mock_kube_client", "mock", "patch", "autospec", "True"], ["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock", "side_effect", "ApiException", "http_resp", "response"], ["mock_get_kube_client", "return_value", "mock_kube_client"], ["mock_kube_client", "api_client", "mock_api_client"], ["mock_kube_client", "create_namespaced_pod", "call_count"], ["mock_kube_client", "create_namespaced_pod", "side_effect", "None"], ["mock_kube_client", "create_namespaced_pod", "reset_mock"], ["mock_kube_client", "create_namespaced_pod", "called"]], "path": [["path", "sys", "path"], ["config", "path"]], "response": [["response", "HTTPResponse", "body", "status", "status"], ["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock", "side_effect", "ApiException", "http_resp", "response"]], "return_value": [["mock_get_kube_client", "return_value", "mock_kube_client"], ["mock_api_client", "sanitize_for_serialization", "return_value"]], "task_instance_key": [["task_instance_key", "TaskInstanceKey", "try_number"], ["kubernetes_executor", "execute_async", "key", "task_instance_key", "queue", "None", "command"], ["kubernetes_executor", "event_buffer", "task_instance_key", "State", "FAILED"]], "try_number": [["task_instance_key", "TaskInstanceKey", "try_number"]]}, "name": "test_run_next_exception_requeue", "params": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": "", "should_requeue": "", "status": ""}, "params_descr": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": "", "should_requeue": "", "status": ""}, "params_occur": {"mock_get_kube_client": [["mock_get_kube_client", "return_value", "mock_kube_client"]], "mock_kubernetes_job_watcher": [], "self": [["kubernetes_executor", "self", "kubernetes_executor"]], "should_requeue": [], "status": [["response", "HTTPResponse", "body", "status", "status"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [], "mock_kubernetes_job_watcher": [["mock.Mock", 0.23863056753955275]], "self": [], "should_requeue": [["mock.Mock", 0.23863056753955275]], "status": [["bytes", 0.07081891517670735]]}, "q_name": "TestKubernetesExecutor.test_run_next_exception_requeue", "ret_exprs": [], "ret_type": "", "variables": {"api_client": "", "config": "", "create_namespaced_pod": "", "kubernetes_executor": "", "mock_api_client": "", "mock_kube_client": "", "path": "", "response": "", "return_value": "", "task_instance_key": "", "try_number": ""}, "variables_p": {"api_client": [["tests.utils.PicklableMock", 0.5365692935623091]], "config": [["str", 0.639286224360248], ["List[str]", 0.18351861928764618], ["app.models.Game", 0.0901522359587894]], "create_namespaced_pod": [["raiden.transfer.state.ChainState", 0.33577740756269087], ["raiden.tests.utils.protocol.WaitForMessage", 0.0928402948637325]], "kubernetes_executor": [["dict", 0.1052918663294762], ["list", 0.09593868408954363], ["tuple", 0.09557066533579651], ["Anaconda3.Lib.site-packages.conda.models.match_spec.MatchSpec", 0.089727413778058]], "mock_api_client": [["mock.Mock", 0.7813637545716539]], "mock_kube_client": [["tests.utils.PicklableMock", 0.49593691441694254], ["dict", 0.07123751595409573]], "path": [["pathlib.Path", 0.503507361285591], ["str", 0.10963825231806626]], "response": [["Dict[str, Union[Any, Any, str]]", 0.20175676512743695], ["int", 0.10591148976026614], ["list", 0.08908305720769208]], "return_value": [["str", 0.2570189103563695], ["Dict[Any, Union[int, str]]", 0.15858322544362846], ["bool", 0.09932101019402825], ["List[Dict[str, str]]", 0.08940851169345068], ["Dict[str, Any]", 0.080273187764063]], "task_instance_key": [["str", 0.48922485965428886], ["Optional[str]", 0.2313143099056429], ["bytes", 0.09023743678916743], ["grpy.core.models.UserKey", 0.07944048835809471]], "try_number": [["str", 0.36893104260475745], ["dict", 0.2956651121899151], ["int", 0.08789828801298717]]}}, {"docstring": {"func": "Exception during Pod Mutation Hook execution should be handled gracefully.", "long_descr": null, "ret": null}, "fn_lc": [[323, 4], [355, 37]], "fn_var_ln": {"create_namespaced_pod": [[331, 8], [331, 46]], "exception_in_pmh": [[327, 8], [327, 24]], "kubernetes_executor": [[334, 8], [334, 27]], "mock_kube_client": [[330, 8], [330, 24]], "return_value": [[332, 8], [332, 41]], "side_effect": [[328, 8], [328, 28]], "task_instance_key": [[338, 12], [338, 29]], "try_number": [[337, 12], [337, 22]]}, "fn_var_occur": {"create_namespaced_pod": [["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock"], ["mock_kube_client", "create_namespaced_pod", "call_count"]], "exception_in_pmh": [["exception_in_pmh", "Exception"], ["mock_pmh", "side_effect", "exception_in_pmh"], ["kubernetes_executor", "event_buffer", "task_instance_key", "__cause__", "exception_in_pmh"]], "kubernetes_executor": [["kubernetes_executor", "self", "kubernetes_executor"], ["kubernetes_executor", "start"], ["kubernetes_executor", "execute_async", "key", "task_instance_key", "queue", "None", "command"], ["kubernetes_executor", "sync"], ["kubernetes_executor", "task_queue", "empty"], ["kubernetes_executor", "event_buffer", "task_instance_key", "State", "FAILED"], ["kubernetes_executor", "event_buffer", "task_instance_key", "__cause__", "exception_in_pmh"], ["kubernetes_executor", "end"]], "mock_kube_client": [["mock_kube_client", "mock", "patch", "autospec", "True"], ["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock"], ["mock_get_kube_client", "return_value", "mock_kube_client"], ["mock_kube_client", "create_namespaced_pod", "call_count"]], "return_value": [["mock_get_kube_client", "return_value", "mock_kube_client"]], "side_effect": [["mock_pmh", "side_effect", "exception_in_pmh"]], "task_instance_key": [["task_instance_key", "TaskInstanceKey", "try_number"], ["kubernetes_executor", "execute_async", "key", "task_instance_key", "queue", "None", "command"], ["kubernetes_executor", "event_buffer", "task_instance_key", "State", "FAILED"], ["kubernetes_executor", "event_buffer", "task_instance_key", "__cause__", "exception_in_pmh"]], "try_number": [["task_instance_key", "TaskInstanceKey", "try_number"]]}, "name": "test_run_next_pmh_error", "params": {"mock_get_kube_client": "", "mock_pmh": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_pmh": "", "self": ""}, "params_occur": {"mock_get_kube_client": [["mock_get_kube_client", "return_value", "mock_kube_client"]], "mock_pmh": [["mock_pmh", "side_effect", "exception_in_pmh"], ["mock_pmh", "call_count"]], "self": [["kubernetes_executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [], "mock_pmh": [["mock.MagicMock", 0.3025005207738047]], "self": []}, "q_name": "TestKubernetesExecutor.test_run_next_pmh_error", "ret_exprs": [], "ret_type": "", "variables": {"create_namespaced_pod": "", "exception_in_pmh": "", "kubernetes_executor": "", "mock_kube_client": "", "return_value": "", "side_effect": "", "task_instance_key": "", "try_number": ""}, "variables_p": {"create_namespaced_pod": [["raiden.utils.TokenAddress", 0.20746183114593408], ["raiden.transfer.state.ChainState", 0.1996239717040567], ["str", 0.11189962998328862], ["Optional[raiden.transfer.state.NettingChannelState]", 0.10290875192874813], ["Optional[raiden.utils.TokenNetworkAddress]", 0.09665468554967363], ["registry.registry.services.datastore.models.DBClient", 0.09345503496786124], ["Optional[raiden.utils.TokenNetworkID]", 0.0925318863357668]], "exception_in_pmh": [["int", 0.5876637135466313], ["frozenset[int]", 0.12018385956472419], ["Tuple[int, int]", 0.09795858984610178], ["bytes", 0.09784540091782158], ["Optional[str]", 0.09634843612472134]], "kubernetes_executor": [["dict", 0.1052918663294762], ["list", 0.09593868408954363], ["tuple", 0.09557066533579651], ["Anaconda3.Lib.site-packages.conda.models.match_spec.MatchSpec", 0.089727413778058]], "mock_kube_client": [["tests.utils.PicklableMock", 0.5371542662831933], ["flask.config.Config", 0.16054871456412798]], "return_value": [["str", 0.3026740351619538], ["list", 0.1146261482508288], ["Optional[bytes]", 0.11041409872608515], ["Dict[str, Any]", 0.09301867454898148], ["Dict[Any, Union[int, str]]", 0.0834713348526144]], "side_effect": [["str", 0.46146968833119484], ["List[Dict[str, float]]", 0.10543346334745063], ["Dict[str, Dict[str, str]]", 0.0831681400737581]], "task_instance_key": [["str", 0.48922485965428886], ["Optional[str]", 0.2313143099056429], ["bytes", 0.09023743678916743], ["grpy.core.models.UserKey", 0.07944048835809471]], "try_number": [["str", 0.36893104260475745], ["dict", 0.2956651121899151], ["int", 0.08789828801298717]]}}, {"docstring": {"func": "When construct_pod raises PodReconciliationError, we should fail the task.", "long_descr": null, "ret": null}, "fn_lc": [[362, 4], [394, 41]], "fn_var_ln": {"api_client": [[374, 8], [374, 35]], "config": [[375, 8], [375, 14]], "create_namespaced_pod": [[370, 8], [370, 46]], "fail_msg": [[369, 8], [369, 16]], "kubernetes_executor": [[377, 12], [377, 31]], "mock_api_client": [[372, 8], [372, 23]], "mock_kube_client": [[368, 8], [368, 24]], "path": [[366, 8], [366, 12]], "return_value": [[371, 8], [371, 41]], "task_instance_key": [[382, 16], [382, 33]], "try_number": [[381, 16], [381, 26]]}, "fn_var_occur": {"api_client": [["mock_kube_client", "api_client", "mock_api_client"]], "config": [["config", "path"], ["conf_vars", "config"]], "create_namespaced_pod": [["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock", "side_effect", "PodReconciliationError", "fail_msg"]], "fail_msg": [["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock", "side_effect", "PodReconciliationError", "fail_msg"], ["kubernetes_executor", "event_buffer", "task_instance_key", "args", "fail_msg"]], "kubernetes_executor": [["kubernetes_executor", "self", "kubernetes_executor"], ["kubernetes_executor", "start"], ["kubernetes_executor", "execute_async", "key", "task_instance_key", "queue", "None", "command"], ["kubernetes_executor", "sync"], ["kubernetes_executor", "task_queue", "empty"], ["kubernetes_executor", "event_buffer", "task_instance_key", "State", "FAILED"], ["kubernetes_executor", "event_buffer", "task_instance_key", "args", "fail_msg"], ["kubernetes_executor", "end"]], "mock_api_client": [["mock_api_client", "mock", "MagicMock"], ["mock_api_client", "sanitize_for_serialization", "return_value"], ["mock_kube_client", "api_client", "mock_api_client"]], "mock_kube_client": [["mock_kube_client", "mock", "patch", "autospec", "True"], ["mock_kube_client", "create_namespaced_pod", "mock", "MagicMock", "side_effect", "PodReconciliationError", "fail_msg"], ["mock_get_kube_client", "return_value", "mock_kube_client"], ["mock_kube_client", "api_client", "mock_api_client"]], "path": [["path", "sys", "path"], ["config", "path"]], "return_value": [["mock_get_kube_client", "return_value", "mock_kube_client"], ["mock_api_client", "sanitize_for_serialization", "return_value"]], "task_instance_key": [["task_instance_key", "TaskInstanceKey", "try_number"], ["kubernetes_executor", "execute_async", "key", "task_instance_key", "queue", "None", "command"], ["kubernetes_executor", "event_buffer", "task_instance_key", "State", "FAILED"], ["kubernetes_executor", "event_buffer", "task_instance_key", "args", "fail_msg"]], "try_number": [["task_instance_key", "TaskInstanceKey", "try_number"]]}, "name": "test_run_next_pod_reconciliation_error", "params": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_occur": {"mock_get_kube_client": [["mock_get_kube_client", "return_value", "mock_kube_client"]], "mock_kubernetes_job_watcher": [], "self": [["kubernetes_executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "self": []}, "q_name": "TestKubernetesExecutor.test_run_next_pod_reconciliation_error", "ret_exprs": [], "ret_type": "", "variables": {"api_client": "", "config": "", "create_namespaced_pod": "", "fail_msg": "", "kubernetes_executor": "", "mock_api_client": "", "mock_kube_client": "", "path": "", "return_value": "", "task_instance_key": "", "try_number": ""}, "variables_p": {"api_client": [["tests.utils.PicklableMock", 0.5365692935623091]], "config": [["str", 0.639286224360248], ["List[str]", 0.18351861928764618], ["app.models.Game", 0.0901522359587894]], "create_namespaced_pod": [["raiden.transfer.state.ChainState", 0.20836938957123013], ["raiden.utils.TokenAddress", 0.12295637056198845], ["Callable", 0.0964433656231681], ["Optional[raiden.utils.TokenNetworkAddress]", 0.09398733594314634], ["str", 0.08191921798423675]], "fail_msg": [["Iterable", 0.10318894450346787]], "kubernetes_executor": [["dict", 0.1052918663294762], ["list", 0.09593868408954363], ["tuple", 0.09557066533579651], ["Anaconda3.Lib.site-packages.conda.models.match_spec.MatchSpec", 0.089727413778058]], "mock_api_client": [["mock.Mock", 0.7813637545716539]], "mock_kube_client": [["tests.utils.PicklableMock", 0.49400770983502534], ["dict", 0.07513422181203475]], "path": [["pathlib.Path", 0.503507361285591], ["str", 0.10963825231806626]], "return_value": [["str", 0.2570189103563695], ["Dict[Any, Union[int, str]]", 0.15858322544362846], ["bool", 0.09932101019402825], ["List[Dict[str, str]]", 0.08940851169345068], ["Dict[str, Any]", 0.080273187764063]], "task_instance_key": [["str", 0.48922485965428886], ["Optional[str]", 0.2313143099056429], ["bytes", 0.09023743678916743], ["grpy.core.models.UserKey", 0.07944048835809471]], "try_number": [["str", 0.36893104260475745], ["dict", 0.2956651121899151], ["int", 0.08789828801298717]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[400, 4], [418, 48]], "fn_var_ln": {"calls": [[403, 8], [403, 13]], "executor": [[401, 8], [401, 16]]}, "fn_var_occur": {"calls": [["calls", "mock", "call", "value", "mock", "ANY", "tags", "mock", "call", "value", "mock", "ANY", "tags", "mock", "call", "value", "mock", "ANY", "tags"], ["mock_stats_gauge", "assert_has_calls", "calls"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "heartbeat"]]}, "name": "test_gauge_executor_metrics", "params": {"mock_kube_config": "", "mock_stats_gauge": "", "mock_sync": "", "mock_trigger_tasks": "", "self": ""}, "params_descr": {"mock_kube_config": "", "mock_stats_gauge": "", "mock_sync": "", "mock_trigger_tasks": "", "self": ""}, "params_occur": {"mock_kube_config": [], "mock_stats_gauge": [["mock_stats_gauge", "assert_has_calls", "calls"]], "mock_sync": [], "mock_trigger_tasks": [], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_kube_config": [["mock.Mock", 0.8293113665281479]], "mock_stats_gauge": [], "mock_sync": [["mock.Mock", 0.8293113665281479]], "mock_trigger_tasks": [["mock.Mock", 0.8293113665281479]], "self": []}, "q_name": "TestKubernetesExecutor.test_gauge_executor_metrics", "ret_exprs": [], "ret_type": "", "variables": {"calls": "", "executor": ""}, "variables_p": {"calls": [["list", 0.19495557708805766], ["List[int]", 0.17160446127383921], ["mock._Call", 0.12624941585677268], ["Dict[str, Union[Any, Any]]", 0.09496353751757497], ["mock.Mock", 0.0829409324341935], ["Tuple[int, int]", 0.08168840126636026], ["Dict[str, Tuple[Any, Any, Any, int]]", 0.07827195370232105], ["List[str]", 0.07736622599826912]], "executor": [["int", 0.7], ["Tuple[Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal, Literal]", 0.1], ["bool", 0.1], ["Type[str]", 0.1]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[422, 4], [440, 26]], "fn_var_ln": {"executor": [[423, 8], [423, 16]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "start"], ["executor", "event_buffer"], ["executor", "execute_async", "key", "datetime", "utcnow", "queue", "None", "command", "executor_config", "k8s", "V1Pod", "spec", "k8s", "V1PodSpec", "containers", "k8s", "V1Container", "name", "image", "image_pull_policy"], ["list", "executor", "event_buffer", "values"], ["executor", "end"]]}, "name": "test_invalid_executor_config", "params": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_occur": {"mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "self": []}, "q_name": "TestKubernetesExecutor.test_invalid_executor_config", "ret_exprs": [], "ret_type": "", "variables": {"executor": ""}, "variables_p": {"executor": [["Type[str]", 0.29431336894178717], ["str", 0.19543389498478303], ["datetime.timedelta", 0.1306428223357868], ["qcodes.utils.validators.Ints", 0.12489294349815865], ["float", 0.08724497317113122], ["int", 0.08549480779516282]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[448, 4], [529, 30]], "fn_var_ln": {"_": [[481, 19], [481, 20]], "current_folder": [[449, 8], [449, 22]], "executor": [[458, 12], [458, 20]], "expected_executor_config": [[481, 22], [481, 46]], "expected_pod_template_file": [[481, 48], [481, 74]], "mock_kube_client": [[454, 8], [454, 24]], "return_value": [[455, 8], [455, 41]], "task": [[480, 16], [480, 20]], "template_file": [[450, 8], [450, 21]]}, "fn_var_occur": {"_": [["_", "_", "expected_executor_config", "expected_pod_template_file", "task"]], "current_folder": [["current_folder", "pathlib", "Path", "__file__", "parent", "resolve"], ["template_file", "str", "current_folder", "resolve"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "start"], ["executor", "event_buffer"], ["executor", "task_queue", "empty"], ["executor", "execute_async", "key", "TaskInstanceKey", "queue", "None", "command", "executor_config", "template_file", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "labels", "spec", "k8s", "V1PodSpec", "containers", "k8s", "V1Container", "name", "image"], ["executor", "task_queue", "empty"], ["task", "executor", "task_queue", "get_nowait"], ["executor", "task_queue", "task_done"], ["executor", "end"]], "expected_executor_config": [["_", "_", "expected_executor_config", "expected_pod_template_file", "task"], ["expected_executor_config", "metadata", "labels"]], "expected_pod_template_file": [["_", "_", "expected_executor_config", "expected_pod_template_file", "task"], ["expected_pod_template_file", "template_file"]], "mock_kube_client": [["mock_kube_client", "mock", "patch", "autospec", "True"], ["mock_get_kube_client", "return_value", "mock_kube_client"]], "return_value": [["mock_get_kube_client", "return_value", "mock_kube_client"]], "task": [["task", "executor", "task_queue", "get_nowait"], ["_", "_", "expected_executor_config", "expected_pod_template_file", "task"], ["self", "kubernetes_executor", "kube_scheduler", "run_next", "task"]], "template_file": [["template_file", "str", "current_folder", "resolve"], ["executor", "execute_async", "key", "TaskInstanceKey", "queue", "None", "command", "executor_config", "template_file", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "labels", "spec", "k8s", "V1PodSpec", "containers", "k8s", "V1Container", "name", "image"], ["expected_pod_template_file", "template_file"]]}, "name": "test_pod_template_file_override_in_executor_config", "params": {"mock_get_kube_client": "", "mock_run_pod_async": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_run_pod_async": "", "self": ""}, "params_occur": {"mock_get_kube_client": [["mock_get_kube_client", "return_value", "mock_kube_client"]], "mock_run_pod_async": [["mock_run_pod_async", "assert_called_once_with", "k8s", "V1Pod", "api_version", "kind", "metadata", "k8s", "V1ObjectMeta", "name", "mock", "ANY", "namespace", "annotations", "labels", "mock", "ANY", "spec", "k8s", "V1PodSpec", "containers", "k8s", "V1Container", "name", "image", "args", "env", "k8s", "V1EnvVar", "name", "value", "image_pull_secrets", "k8s", "V1LocalObjectReference", "name", "scheduler_name", "security_context", "k8s", "V1PodSecurityContext", "fs_group", "run_as_user"]], "self": [["executor", "self", "kubernetes_executor"], ["self", "kubernetes_executor", "kube_scheduler", "run_next", "task"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [], "mock_run_pod_async": [["mock.MagicMock", 0.1052701617989145]], "self": []}, "q_name": "TestKubernetesExecutor.test_pod_template_file_override_in_executor_config", "ret_exprs": [], "ret_type": "", "variables": {"_": "", "current_folder": "", "executor": "", "expected_executor_config": "", "expected_pod_template_file": "", "mock_kube_client": "", "return_value": "", "task": "", "template_file": ""}, "variables_p": {"_": [["str", 0.4022510896399238], ["int", 0.10567919378494114], ["bool", 0.08510168092220595]], "current_folder": [["pathlib.Path", 0.9074182074861064], ["float", 0.09258179251389387]], "executor": [["int", 0.30185035137131033], ["dict", 0.10487647704594047], ["list", 0.0976528722829296]], "expected_executor_config": [["str", 0.1890864099804846], ["Dict[str, bool]", 0.08981648802175388], ["Dict[str, int]", 0.08222050574404319], ["pathlib.Path", 0.08017947842880006]], "expected_pod_template_file": [["pathlib.Path", 0.8208876529201432], ["Optional[str]", 0.09450016634251975], ["str", 0.08461218073733699]], "mock_kube_client": [["tests.utils.PicklableMock", 0.5450154279124383], ["flask.config.Config", 0.1541423158115346]], "return_value": [["str", 0.3026740351619538], ["list", 0.1146261482508288], ["Optional[bytes]", 0.11041409872608515], ["Dict[str, Any]", 0.09301867454898148], ["Dict[Any, Union[int, str]]", 0.0834713348526144]], "task": [["str", 0.08295223805834463]], "template_file": [["str", 0.48277798611796974], ["List[str]", 0.3345134567457699], ["pathlib.Path", 0.1827085571362605]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[533, 4], [543, 26]], "fn_var_ln": {"executor": [[534, 8], [534, 16]], "key": [[537, 12], [537, 15]], "running": [[538, 12], [538, 28]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "start"], ["executor", "running", "key"], ["executor", "_change_state", "key", "State", "RUNNING"], ["executor", "event_buffer", "key", "State", "RUNNING"], ["executor", "running", "key"], ["executor", "end"]], "key": [["executor", "running", "key"], ["executor", "_change_state", "key", "State", "RUNNING"], ["executor", "event_buffer", "key", "State", "RUNNING"], ["executor", "running", "key"]], "running": [["executor", "running", "key"], ["executor", "running", "key"]]}, "name": "test_change_state_running", "params": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_occur": {"mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [["mock.MagicMock", 0.41963792513756104], ["mock.Mock", 0.09035544913241274]], "mock_kubernetes_job_watcher": [["mock.MagicMock", 0.41963792513756104], ["mock.Mock", 0.09035544913241274]], "self": []}, "q_name": "TestKubernetesExecutor.test_change_state_running", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "key": "", "running": ""}, "variables_p": {"executor": [["tuple", 0.09603559072941524], ["list", 0.09270323966672502]], "key": [["List[str]", 0.22137256789269502], ["Tuple[str]", 0.12843040091797098], ["alerta.models.key.ApiKey", 0.09594377420464621], ["str", 0.08648645690756608]], "running": [["int", 0.48427712710601095], ["List[int]", 0.11369330149305332], ["Dict[int, List[Any]]", 0.10935421002936294]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[548, 4], [559, 26]], "fn_var_ln": {"executor": [[549, 8], [549, 16]], "key": [[552, 12], [552, 15]], "running": [[553, 12], [553, 28]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "start"], ["executor", "running", "key"], ["executor", "_change_state", "key", "State", "SUCCESS"], ["executor", "event_buffer", "key", "State", "SUCCESS"], ["executor", "running", "set"], ["executor", "end"]], "key": [["executor", "running", "key"], ["executor", "_change_state", "key", "State", "SUCCESS"], ["executor", "event_buffer", "key", "State", "SUCCESS"]], "running": [["executor", "running", "key"], ["executor", "running", "set"]]}, "name": "test_change_state_success", "params": {"mock_delete_pod": "", "mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_descr": {"mock_delete_pod": "", "mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": ""}, "params_occur": {"mock_delete_pod": [["mock_delete_pod", "assert_called_once_with", "pod_name", "namespace"]], "mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_delete_pod": [["mock.Mock", 0.6627833361714751]], "mock_get_kube_client": [["mock.Mock", 0.7615986394730173]], "mock_kubernetes_job_watcher": [["mock.Mock", 0.7615986394730173]], "self": []}, "q_name": "TestKubernetesExecutor.test_change_state_success", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "key": "", "running": ""}, "variables_p": {"executor": [["dict", 0.10114083420616922], ["set", 0.09433887084411867]], "key": [["list", 0.2515448547221163], ["int", 0.134123286161698], ["Tuple[str]", 0.10956225195346742], ["alerta.models.key.ApiKey", 0.1001314916161621]], "running": [["int", 0.37468711710946057], ["Iterator[List[int]]", 0.27276011042702974], ["bytes", 0.08008602109219763]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[564, 4], [582, 26]], "fn_var_ln": {"executor": [[569, 8], [569, 16]], "key": [[574, 12], [574, 15]], "mock_delete_pod": [[567, 8], [567, 23]], "mock_patch_pod": [[568, 8], [568, 22]], "running": [[575, 12], [575, 28]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "kube_config", "delete_worker_pods", "False"], ["executor", "kube_config", "delete_worker_pods_on_failure", "False"], ["executor", "start"], ["executor", "running", "key"], ["executor", "_change_state", "key", "State", "FAILED"], ["executor", "event_buffer", "key", "State", "FAILED"], ["executor", "running", "set"], ["executor", "end"]], "key": [["executor", "running", "key"], ["executor", "_change_state", "key", "State", "FAILED"], ["executor", "event_buffer", "key", "State", "FAILED"]], "mock_delete_pod": [["mock_delete_pod", "mock_kubescheduler", "return_value", "delete_pod"], ["mock_delete_pod", "assert_not_called"]], "mock_patch_pod": [["mock_patch_pod", "mock_kubescheduler", "return_value", "patch_pod_executor_done"], ["mock_patch_pod", "assert_called_once_with", "pod_name", "namespace"]], "running": [["executor", "running", "key"], ["executor", "running", "set"]]}, "name": "test_change_state_failed_no_deletion", "params": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "mock_kubescheduler": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "mock_kubescheduler": "", "self": ""}, "params_occur": {"mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "mock_kubescheduler": [["mock_delete_pod", "mock_kubescheduler", "return_value", "delete_pod"], ["mock_patch_pod", "mock_kubescheduler", "return_value", "patch_pod_executor_done"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [["mock.Mock", 0.9058722961621531]], "mock_kubernetes_job_watcher": [["mock.Mock", 0.9058722961621531]], "mock_kubescheduler": [["mock.Mock", 0.10809085777480257]], "self": []}, "q_name": "TestKubernetesExecutor.test_change_state_failed_no_deletion", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "key": "", "mock_delete_pod": "", "mock_patch_pod": "", "running": ""}, "variables_p": {"executor": [["List[List[Any]]", 0.18508429484799813], ["src.pip_shims.models.ShimmedPathCollection", 0.13320316946900032], ["tests.data.Pri", 0.10775400514943803], ["str", 0.1017528877753267], ["Optional[Match[str]]", 0.09411359496052986], ["int", 0.09270717337308575], ["float", 0.09177180988380666]], "key": [["List[str]", 0.17589381459536105], ["Tuple[str]", 0.15019973265547934], ["alerta.models.key.ApiKey", 0.09863335920987003], ["int", 0.08102673654814016]], "mock_delete_pod": [["Dict[str, datetime.datetime]", 0.33859953624977557], ["tests.utils.MockCoroutine", 0.09835198825103847], ["Dict[str, List[Any]]", 0.08503936228683598], ["str", 0.08097717211834272], ["datetime.datetime", 0.08081858705758566]], "mock_patch_pod": [["tests.utils.MockCoroutine", 0.09679471275482232], ["mock.Mock", 0.09516647713483499], ["Dict[str, str]", 0.09356610778230669]], "running": [["int", 0.37468711710946057], ["Iterator[List[int]]", 0.27276011042702974], ["bytes", 0.08008602109219763]]}}, {"docstring": {"func": "Ensure that when change_state gets state=None, it looks up the TI state from the db", "long_descr": null, "ret": null}, "fn_lc": [[590, 4], [610, 26]], "fn_var_ln": {"executor": [[599, 8], [599, 16]], "key": [[603, 12], [603, 15]], "running": [[604, 12], [604, 28]], "ti": [[602, 12], [602, 14]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "start"], ["executor", "running", "key"], ["executor", "_change_state", "key", "None"], ["executor", "event_buffer", "key", "ti_state"], ["executor", "running", "set"], ["executor", "end"]], "key": [["key", "ti", "key"], ["executor", "running", "key"], ["executor", "_change_state", "key", "None"], ["executor", "event_buffer", "key", "ti_state"]], "running": [["executor", "running", "key"], ["executor", "running", "set"]], "ti": [["ti", "create_task_instance", "state", "ti_state"], ["key", "ti", "key"]]}, "name": "test_change_state_none", "params": {"create_task_instance": "", "mock_delete_pod": "", "mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": "", "ti_state": ""}, "params_descr": {"create_task_instance": "", "mock_delete_pod": "", "mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "self": "", "ti_state": ""}, "params_occur": {"create_task_instance": [["ti", "create_task_instance", "state", "ti_state"]], "mock_delete_pod": [["mock_delete_pod", "assert_called_once_with", "pod_name", "namespace"]], "mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "self": [["executor", "self", "kubernetes_executor"]], "ti_state": [["ti", "create_task_instance", "state", "ti_state"], ["executor", "event_buffer", "key", "ti_state"]]}, "params_p": {"args": [], "create_task_instance": [], "kwargs": [], "mock_delete_pod": [["mock.Mock", 0.7397008732328628]], "mock_get_kube_client": [["mock.Mock", 0.8327931123404155]], "mock_kubernetes_job_watcher": [["mock.Mock", 0.8327931123404155]], "self": [], "ti_state": [["mock.Mock", 0.3419708893928581]]}, "q_name": "TestKubernetesExecutor.test_change_state_none", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "key": "", "running": "", "ti": ""}, "variables_p": {"executor": [["tuple", 0.0891559150132979], ["set", 0.08626463961111706]], "key": [["str", 0.5309785430785654], ["Tuple[str]", 0.10476877134083454]], "running": [["int", 0.37468711710946057], ["Iterator[List[int]]", 0.27276011042702974], ["bytes", 0.08008602109219763]], "ti": [["str", 0.5238046225207902], ["Type[str]", 0.10158900275393805], ["Pattern[str]", 0.09438378294566116], ["dict", 0.09123901617613168]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[620, 4], [633, 26]], "fn_var_ln": {"executor": [[623, 8], [623, 16]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "kube_config", "multi_namespace_mode", "True"], ["executor", "kube_config", "multi_namespace_mode_namespace_list", "multi_namespace_mode_namespace_list"], ["executor", "start"], ["list", "executor", "kube_scheduler", "kube_watchers", "keys", "watchers_keys"], ["all", "isinstance", "v", "KubernetesJobWatcher", "v", "executor", "kube_scheduler", "kube_watchers", "values"], ["executor", "end"]]}, "name": "test_watchers_under_multi_namespace_mode", "params": {"mock_get_kube_client": "", "multi_namespace_mode_namespace_list": "", "self": "", "watchers_keys": ""}, "params_descr": {"mock_get_kube_client": "", "multi_namespace_mode_namespace_list": "", "self": "", "watchers_keys": ""}, "params_occur": {"mock_get_kube_client": [], "multi_namespace_mode_namespace_list": [["executor", "kube_config", "multi_namespace_mode_namespace_list", "multi_namespace_mode_namespace_list"]], "self": [["executor", "self", "kubernetes_executor"]], "watchers_keys": [["list", "executor", "kube_scheduler", "kube_watchers", "keys", "watchers_keys"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [["Callable", 0.3017544278250428], ["bool", 0.21793104071191793], ["Callable[[], None]", 0.12243743679097921], ["Callable[..., None]", 0.08714057190526872], ["salon.models.Stylist", 0.0850758567458885]], "multi_namespace_mode_namespace_list": [["Mapping", 0.16719531111115543], ["dict", 0.119648560237124]], "self": [], "watchers_keys": [["Iterable[bool]", 0.1171716987260788], ["dict", 0.0974476072596613], ["int", 0.09726329518527312], ["salon.models.Stylist", 0.09524572001448998]]}, "q_name": "TestKubernetesExecutor.test_watchers_under_multi_namespace_mode", "ret_exprs": [], "ret_type": "", "variables": {"executor": ""}, "variables_p": {"executor": [["dict", 0.3218984533250069], ["list", 0.0993054464051265], ["List[str]", 0.08893067163920472]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[638, 4], [657, 26]], "fn_var_ln": {"executor": [[643, 8], [643, 16]], "key": [[649, 12], [649, 15]], "mock_delete_pod": [[641, 8], [641, 23]], "mock_patch_pod": [[642, 8], [642, 22]], "running": [[650, 12], [650, 28]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "kube_config", "delete_worker_pods", "False"], ["executor", "kube_config", "delete_worker_pods_on_failure", "False"], ["executor", "start"], ["executor", "running", "key"], ["executor", "_change_state", "key", "State", "SUCCESS"], ["executor", "event_buffer", "key", "State", "SUCCESS"], ["executor", "running", "set"], ["executor", "end"]], "key": [["executor", "running", "key"], ["executor", "_change_state", "key", "State", "SUCCESS"], ["executor", "event_buffer", "key", "State", "SUCCESS"]], "mock_delete_pod": [["mock_delete_pod", "mock_kubescheduler", "return_value", "delete_pod"], ["mock_delete_pod", "assert_not_called"]], "mock_patch_pod": [["mock_patch_pod", "mock_kubescheduler", "return_value", "patch_pod_executor_done"], ["mock_patch_pod", "assert_called_once_with", "pod_name", "namespace"]], "running": [["executor", "running", "key"], ["executor", "running", "set"]]}, "name": "test_change_state_skip_pod_deletion", "params": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "mock_kubescheduler": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "mock_kubescheduler": "", "self": ""}, "params_occur": {"mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "mock_kubescheduler": [["mock_delete_pod", "mock_kubescheduler", "return_value", "delete_pod"], ["mock_patch_pod", "mock_kubescheduler", "return_value", "patch_pod_executor_done"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [["mock.Mock", 0.8008976486815867]], "mock_kubernetes_job_watcher": [["mock.Mock", 0.8008976486815867]], "mock_kubescheduler": [["mock.Mock", 0.10829997417017699]], "self": []}, "q_name": "TestKubernetesExecutor.test_change_state_skip_pod_deletion", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "key": "", "mock_delete_pod": "", "mock_patch_pod": "", "running": ""}, "variables_p": {"executor": [["List[List[Any]]", 0.18508429484799813], ["src.pip_shims.models.ShimmedPathCollection", 0.13320316946900032], ["tests.data.Pri", 0.10775400514943803], ["str", 0.1017528877753267], ["Optional[Match[str]]", 0.09411359496052986], ["int", 0.09270717337308575], ["float", 0.09177180988380666]], "key": [["list", 0.2515448547221163], ["int", 0.134123286161698], ["Tuple[str]", 0.10956225195346742], ["alerta.models.key.ApiKey", 0.1001314916161621]], "mock_delete_pod": [["Dict[str, datetime.datetime]", 0.33859953624977557], ["tests.utils.MockCoroutine", 0.09835198825103847], ["Dict[str, List[Any]]", 0.08503936228683598], ["str", 0.08097717211834272], ["datetime.datetime", 0.08081858705758566]], "mock_patch_pod": [["tests.utils.MockCoroutine", 0.09679471275482232], ["mock.Mock", 0.09516647713483499], ["Dict[str, str]", 0.09356610778230669]], "running": [["int", 0.37468711710946057], ["Iterator[List[int]]", 0.27276011042702974], ["bytes", 0.08008602109219763]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[662, 4], [680, 26]], "fn_var_ln": {"executor": [[667, 8], [667, 16]], "key": [[672, 12], [672, 15]], "mock_delete_pod": [[665, 8], [665, 23]], "mock_patch_pod": [[666, 8], [666, 22]], "running": [[673, 12], [673, 28]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "kube_config", "delete_worker_pods_on_failure", "True"], ["executor", "start"], ["executor", "running", "key"], ["executor", "_change_state", "key", "State", "FAILED"], ["executor", "event_buffer", "key", "State", "FAILED"], ["executor", "running", "set"], ["executor", "end"]], "key": [["executor", "running", "key"], ["executor", "_change_state", "key", "State", "FAILED"], ["executor", "event_buffer", "key", "State", "FAILED"]], "mock_delete_pod": [["mock_delete_pod", "mock_kubescheduler", "return_value", "delete_pod"], ["mock_delete_pod", "assert_called_once_with", "pod_name", "namespace"]], "mock_patch_pod": [["mock_patch_pod", "mock_kubescheduler", "return_value", "patch_pod_executor_done"], ["mock_patch_pod", "assert_not_called"]], "running": [["executor", "running", "key"], ["executor", "running", "set"]]}, "name": "test_change_state_failed_pod_deletion", "params": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "mock_kubescheduler": "", "self": ""}, "params_descr": {"mock_get_kube_client": "", "mock_kubernetes_job_watcher": "", "mock_kubescheduler": "", "self": ""}, "params_occur": {"mock_get_kube_client": [], "mock_kubernetes_job_watcher": [], "mock_kubescheduler": [["mock_delete_pod", "mock_kubescheduler", "return_value", "delete_pod"], ["mock_patch_pod", "mock_kubescheduler", "return_value", "patch_pod_executor_done"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_get_kube_client": [["mock.Mock", 0.8008976486815867]], "mock_kubernetes_job_watcher": [["mock.Mock", 0.8008976486815867]], "mock_kubescheduler": [["mock.Mock", 0.10829997417017699]], "self": []}, "q_name": "TestKubernetesExecutor.test_change_state_failed_pod_deletion", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "key": "", "mock_delete_pod": "", "mock_patch_pod": "", "running": ""}, "variables_p": {"executor": [["List[int]", 0.20612907169754904], ["int", 0.12222609617704956], ["Tuple[int, int, int]", 0.10028947297743629], ["str", 0.09081360771486494], ["bytes", 0.09046968505658166]], "key": [["List[str]", 0.17589381459536105], ["Tuple[str]", 0.15019973265547934], ["alerta.models.key.ApiKey", 0.09863335920987003], ["int", 0.08102673654814016]], "mock_delete_pod": [["str", 0.268096756224771], ["int", 0.16809549392167983], ["tests.utils.MockCoroutine", 0.09904467038030007], ["Optional[bytes]", 0.08671856728901242], ["Dict[str, List[Any]]", 0.08602827893834673], ["list", 0.0825523670198426]], "mock_patch_pod": [["tests.utils.MockCoroutine", 0.0988994373450514], ["mock.Mock", 0.0971955415134456], ["list", 0.08539845492177778]], "running": [["int", 0.37468711710946057], ["Iterator[List[int]]", 0.27276011042702974], ["bytes", 0.08008602109219763]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[684, 4], [732, 30]], "fn_var_ln": {"executor": [[685, 8], [685, 16]], "kube_client": [[699, 8], [699, 28]], "mock_kube_client": [[697, 8], [697, 24]], "mock_ti": [[695, 8], [695, 15]], "pod": [[696, 8], [696, 11]], "queued_by_job_id": [[717, 8], [717, 32]], "reset_tis": [[724, 8], [724, 17]], "scheduler_job_id": [[718, 8], [718, 33]], "side_effect": [[720, 8], [720, 44]], "ti_key": [[687, 8], [687, 14]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "scheduler_job_id"], ["executor", "kube_client", "mock_kube_client"], ["reset_tis", "executor", "try_adopt_task_instances", "mock_ti"], ["executor", "scheduler_job_id"], ["reset_tis", "executor", "try_adopt_task_instances", "mock_ti"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["mock_kube_client", "list_namespaced_pod", "return_value", "items", "pod"], ["executor", "kube_client", "mock_kube_client"], ["mock_kube_client", "list_namespaced_pod", "assert_called_once_with", "namespace", "field_selector", "label_selector"], ["mock_adopt_launched_task", "assert_called_once_with", "mock_kube_client", "pod", "ti_key", "mock_ti"], ["mock_kube_client", "reset_mock"], ["mock_kube_client", "list_namespaced_pod", "assert_called_once_with", "namespace", "field_selector", "label_selector"]], "mock_ti": [["mock_ti", "mock", "MagicMock", "queued_by_job_id", "external_executor_id", "key", "ti_key"], ["reset_tis", "executor", "try_adopt_task_instances", "mock_ti"], ["mock_adopt_launched_task", "assert_called_once_with", "mock_kube_client", "pod", "ti_key", "mock_ti"], ["reset_tis", "mock_ti"], ["mock_ti", "queued_by_job_id"], ["reset_tis", "executor", "try_adopt_task_instances", "mock_ti"]], "pod": [["pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name"], ["mock_kube_client", "list_namespaced_pod", "return_value", "items", "pod"], ["mock_adopt_launched_task", "assert_called_once_with", "mock_kube_client", "pod", "ti_key", "mock_ti"], ["mock_adopt_launched_task", "side_effect", "client", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key", "pop", "ti_key"]], "queued_by_job_id": [["mock_ti", "mock", "MagicMock", "queued_by_job_id", "external_executor_id", "key", "ti_key"], ["mock_ti", "queued_by_job_id"]], "reset_tis": [["reset_tis", "executor", "try_adopt_task_instances", "mock_ti"], ["reset_tis", "mock_ti"], ["reset_tis", "executor", "try_adopt_task_instances", "mock_ti"]], "scheduler_job_id": [["executor", "scheduler_job_id"], ["executor", "scheduler_job_id"]], "side_effect": [["mock_adopt_launched_task", "side_effect", "client", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key", "pop", "ti_key"]], "ti_key": [["ti_key", "annotations_to_key"], ["mock_ti", "mock", "MagicMock", "queued_by_job_id", "external_executor_id", "key", "ti_key"], ["mock_adopt_launched_task", "assert_called_once_with", "mock_kube_client", "pod", "ti_key", "mock_ti"], ["mock_adopt_launched_task", "side_effect", "client", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key", "pop", "ti_key"]]}, "name": "test_try_adopt_task_instances", "params": {"mock_adopt_completed_pods": "", "mock_adopt_launched_task": "", "self": ""}, "params_descr": {"mock_adopt_completed_pods": "", "mock_adopt_launched_task": "", "self": ""}, "params_occur": {"mock_adopt_completed_pods": [["mock_adopt_completed_pods", "assert_called_once"], ["mock_adopt_completed_pods", "reset_mock"], ["mock_adopt_completed_pods", "assert_called_once"]], "mock_adopt_launched_task": [["mock_adopt_launched_task", "assert_called_once_with", "mock_kube_client", "pod", "ti_key", "mock_ti"], ["mock_adopt_launched_task", "reset_mock"], ["mock_adopt_launched_task", "side_effect", "client", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key", "pop", "ti_key"], ["mock_adopt_launched_task", "assert_called_once"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_adopt_completed_pods": [], "mock_adopt_launched_task": [], "self": []}, "q_name": "TestKubernetesExecutor.test_try_adopt_task_instances", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "kube_client": "", "mock_kube_client": "", "mock_ti": "", "pod": "", "queued_by_job_id": "", "reset_tis": "", "scheduler_job_id": "", "side_effect": "", "ti_key": ""}, "variables_p": {"executor": [], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "mock_kube_client": [["mock.Mock", 0.6793106015879692]], "mock_ti": [["mock.Mock", 0.5053645952572723], ["mock.MagicMock", 0.11766824186762663]], "pod": [["qutebrowser.utils.usertypes.Question", 0.11689764914188504]], "queued_by_job_id": [["mock.Mock", 0.43577028115809047], ["mock.MagicMock", 0.07378842707470507]], "reset_tis": [["str", 0.44813102078406375], ["datetime.datetime.timedelta", 0.09465975090613536]], "scheduler_job_id": [["str", 0.6625790207337935], ["int", 0.16571051264819708], ["transfer.models.ArticleID", 0.09197112496465787]], "side_effect": [["str", 0.3262563794125132], ["List[List[int]]", 0.09593711286779637], ["bytes", 0.08304298762821634]], "ti_key": [["str", 0.3891116976578086], ["bytes", 0.10216052152509333], ["bool", 0.09826436542132211], ["Set[str]", 0.09238921537852202]]}}, {"docstring": {"func": "We try to find pods only once per scheduler id", "long_descr": null, "ret": null}, "fn_lc": [[735, 4], [763, 9]], "fn_var_ln": {"executor": [[737, 8], [737, 16]], "kube_client": [[739, 8], [739, 28]], "mock_kube_client": [[738, 8], [738, 24]], "mock_tis": [[741, 8], [741, 16]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "kube_client", "mock_kube_client"], ["executor", "try_adopt_task_instances", "mock_tis"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["executor", "kube_client", "mock_kube_client"], ["mock_kube_client", "list_namespaced_pod", "call_count"], ["mock_kube_client", "list_namespaced_pod", "assert_has_calls", "mock", "call", "namespace", "field_selector", "label_selector", "mock", "call", "namespace", "field_selector", "label_selector", "any_order", "True"]], "mock_tis": [["mock_tis", "mock", "MagicMock", "queued_by_job_id", "external_executor_id", "dag_id", "task_id", "mock", "MagicMock", "queued_by_job_id", "external_executor_id", "dag_id", "task_id", "mock", "MagicMock", "queued_by_job_id", "external_executor_id", "dag_id", "task_id"], ["executor", "try_adopt_task_instances", "mock_tis"]]}, "name": "test_try_adopt_task_instances_multiple_scheduler_ids", "params": {"mock_adopt_completed_pods": "", "self": ""}, "params_descr": {"mock_adopt_completed_pods": "", "self": ""}, "params_occur": {"mock_adopt_completed_pods": [], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_adopt_completed_pods": [["mock.MagicMock", 0.10969092895136587], ["mock.Mock", 0.09761273123989889]], "self": []}, "q_name": "TestKubernetesExecutor.test_try_adopt_task_instances_multiple_scheduler_ids", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "kube_client": "", "mock_kube_client": "", "mock_tis": ""}, "variables_p": {"executor": [["raiden.tests.utils.mocks.MockRaidenService", 0.18964504977568486], ["tests.core.base_schema_tesMockSchemaCollection", 0.12042210444664268], ["Dict[str, Any]", 0.11117581282843893]], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "mock_kube_client": [["mock.Mock", 0.5951604950494418]], "mock_tis": [["mock.Mock", 0.1969712630148684], ["mock.MagicMock", 0.09459866872013326]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[767, 4], [779, 54]], "fn_var_ln": {"executor": [[770, 8], [770, 16]], "kube_client": [[774, 8], [774, 28]], "mock_kube_client": [[772, 8], [772, 24]], "mock_ti": [[771, 8], [771, 15]], "tis_to_flush": [[776, 8], [776, 20]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "kube_client", "mock_kube_client"], ["tis_to_flush", "executor", "try_adopt_task_instances", "mock_ti"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["mock_kube_client", "list_namespaced_pod", "return_value", "items"], ["executor", "kube_client", "mock_kube_client"]], "mock_ti": [["mock_ti", "mock", "MagicMock", "queued_by_job_id", "external_executor_id", "dag_id", "task_id"], ["tis_to_flush", "executor", "try_adopt_task_instances", "mock_ti"], ["tis_to_flush", "mock_ti"]], "tis_to_flush": [["tis_to_flush", "executor", "try_adopt_task_instances", "mock_ti"], ["tis_to_flush", "mock_ti"]]}, "name": "test_try_adopt_task_instances_no_matching_pods", "params": {"mock_adopt_completed_pods": "", "mock_adopt_launched_task": "", "self": ""}, "params_descr": {"mock_adopt_completed_pods": "", "mock_adopt_launched_task": "", "self": ""}, "params_occur": {"mock_adopt_completed_pods": [["mock_adopt_completed_pods", "assert_called_once"]], "mock_adopt_launched_task": [["mock_adopt_launched_task", "assert_not_called"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_adopt_completed_pods": [["mock.Mock", 0.07003414012996424], ["mock.MagicMock", 0.06835576296359834]], "mock_adopt_launched_task": [], "self": []}, "q_name": "TestKubernetesExecutor.test_try_adopt_task_instances_no_matching_pods", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "kube_client": "", "mock_kube_client": "", "mock_ti": "", "tis_to_flush": ""}, "variables_p": {"executor": [["Dict[str, Any]", 0.11264660337230384]], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "mock_kube_client": [["mock.Mock", 0.8595750950757244]], "mock_ti": [["mock.Mock", 0.39087206287001863], ["mock.MagicMock", 0.10329902105483582]], "tis_to_flush": [["Dict[str, Dict[str, Any]]", 0.2575197179701393], ["str", 0.13298981276075247], ["dict", 0.10758890988526207], ["bytes", 0.08349263985899398]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[782, 4], [804, 43]], "fn_var_ln": {"annotations": [[785, 8], [785, 19]], "executor": [[783, 8], [783, 16]], "pod": [[792, 8], [792, 11]], "scheduler_job_id": [[784, 8], [784, 33]], "ti_key": [[791, 8], [791, 14]], "tis_to_flush_by_key": [[795, 8], [795, 27]]}, "fn_var_occur": {"annotations": [["ti_key", "annotations_to_key", "annotations"], ["pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "labels", "annotations", "annotations"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "scheduler_job_id"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"], ["executor", "running", "ti_key"]], "pod": [["pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "labels", "annotations", "annotations"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"]], "scheduler_job_id": [["executor", "scheduler_job_id"]], "ti_key": [["ti_key", "annotations_to_key", "annotations"], ["tis_to_flush_by_key", "ti_key"], ["executor", "running", "ti_key"]], "tis_to_flush_by_key": [["tis_to_flush_by_key", "ti_key"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"]]}, "name": "test_adopt_launched_task", "params": {"mock_kube_client": "", "self": ""}, "params_descr": {"mock_kube_client": "", "self": ""}, "params_occur": {"mock_kube_client": [["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"], ["mock_kube_client", "patch_namespaced_pod", "assert_called_once_with", "body", "name", "namespace", "None"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_kube_client": [], "self": []}, "q_name": "TestKubernetesExecutor.test_adopt_launched_task", "ret_exprs": [], "ret_type": "", "variables": {"annotations": "", "executor": "", "pod": "", "scheduler_job_id": "", "ti_key": "", "tis_to_flush_by_key": ""}, "variables_p": {"annotations": [["Dict[str, bool]", 0.5442920388306858], ["dict", 0.17324158538045986], ["str", 0.08547885245292737], ["bool", 0.07135216943486039]], "executor": [["int", 0.42106058579842565], ["str", 0.11164266610337575], ["float", 0.08900685625340694]], "pod": [["str", 0.0988159975045406], ["qutebrowser.utils.usertypes.Question", 0.09385212284033596]], "scheduler_job_id": [["str", 0.8309518441065099], ["int", 0.11556409045997561]], "ti_key": [["str", 0.45410194724093156], ["int", 0.0946940365324042], ["bytes", 0.08634713686072033]], "tis_to_flush_by_key": [["dict", 0.1801898449845646], ["Dict[str, str]", 0.14222233805841378]]}}, {"docstring": {"func": "We shouldn't think we are running the task if aren't able to patch the pod", "long_descr": null, "ret": null}, "fn_lc": [[807, 4], [829, 40]], "fn_var_ln": {"annotations": [[811, 8], [811, 19]], "executor": [[809, 8], [809, 16]], "pod": [[818, 8], [818, 11]], "scheduler_job_id": [[810, 8], [810, 33]], "ti_key": [[817, 8], [817, 14]], "tis_to_flush_by_key": [[819, 8], [819, 27]]}, "fn_var_occur": {"annotations": [["ti_key", "annotations_to_key", "annotations"], ["pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "annotations", "annotations"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "scheduler_job_id"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"], ["executor", "running", "set"]], "pod": [["pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "annotations", "annotations"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"]], "scheduler_job_id": [["executor", "scheduler_job_id"]], "ti_key": [["ti_key", "annotations_to_key", "annotations"], ["tis_to_flush_by_key", "ti_key"], ["tis_to_flush_by_key", "ti_key"]], "tis_to_flush_by_key": [["tis_to_flush_by_key", "ti_key"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"], ["tis_to_flush_by_key", "ti_key"]]}, "name": "test_adopt_launched_task_api_exception", "params": {"mock_kube_client": "", "self": ""}, "params_descr": {"mock_kube_client": "", "self": ""}, "params_occur": {"mock_kube_client": [["mock_kube_client", "patch_namespaced_pod", "side_effect", "ApiException", "status"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"], ["mock_kube_client", "patch_namespaced_pod", "assert_called_once_with", "body", "name", "namespace", "None"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_kube_client": [["str", 0.13963186451660026]], "self": []}, "q_name": "TestKubernetesExecutor.test_adopt_launched_task_api_exception", "ret_exprs": [], "ret_type": "", "variables": {"annotations": "", "executor": "", "pod": "", "scheduler_job_id": "", "ti_key": "", "tis_to_flush_by_key": ""}, "variables_p": {"annotations": [["Dict[str, bool]", 0.5487782890407215], ["dict", 0.17415200625638116], ["str", 0.0790267499970437], ["bool", 0.07316149221983877]], "executor": [["int", 0.42106058579842565], ["str", 0.11164266610337575], ["float", 0.08900685625340694]], "pod": [["cmk.utils.rulesets.ruleset_matcher.RulesetMatchObject", 0.09964873934746542]], "scheduler_job_id": [["str", 0.8309518441065099], ["int", 0.11556409045997561]], "ti_key": [["str", 0.35717546990372984], ["Tuple[str, str, str, str, str, str, str, str, str, str]", 0.07757001068293284], ["int", 0.07496685642311944], ["bytes", 0.07242583060032345]], "tis_to_flush_by_key": [["dict", 0.17524484412396596], ["Dict[str, str]", 0.1454085062368133]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[840, 8], [846, 13]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "get_annotations", "params": {"pod_name": ""}, "params_descr": {"pod_name": ""}, "params_occur": {"pod_name": []}, "params_p": {"args": [], "kwargs": [], "pod_name": [["str", 0.8999999999999999], ["List[str]", 0.09999999999999999]], "self": []}, "q_name": "TestKubernetesExecutor.test_adopt_completed_pods.<locals>.get_annotations", "ret_exprs": ["return { \"dag_id\": \"dag\", \"run_id\": \"run_id\", \"task_id\": pod_name, \"try_number\": \"1\",}"], "ret_type": "", "ret_type_p": [["bool", 0.3011705179800147], ["str", 0.192091773052336], ["models.Payment", 0.1077993104378952], ["Callable", 0.10593076782368413], ["Mapping[str, Any]", 0.10159365144568092], ["models.Slice", 0.10018680900154771]], "variables": {}, "variables_p": {}}, {"docstring": {"func": "We should adopt all completed pods from other schedulers", "long_descr": null, "ret": null}, "fn_lc": [[832, 4], [879, 59]], "fn_var_ln": {"executor": [[834, 8], [834, 16]], "expected_running_ti_keys": [[859, 8], [859, 32]], "kube_client": [[836, 8], [836, 28]], "pod_names": [[838, 8], [838, 17]], "scheduler_job_id": [[835, 8], [835, 33]]}, "fn_var_occur": {"executor": [["executor", "_adopt_completed_pods", "mock_kube_client"], ["executor", "running", "expected_running_ti_keys"]], "expected_running_ti_keys": [["expected_running_ti_keys", "annotations_to_key", "get_annotations", "pod_name", "pod_name", "pod_names"], ["executor", "running", "expected_running_ti_keys"]], "kube_client": [], "pod_names": [["mock_kube_client", "list_namespaced_pod", "return_value", "items", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "pod_name", "labels", "pod_name", "annotations", "get_annotations", "pod_name", "namespace", "pod_name", "pod_names"], ["expected_running_ti_keys", "annotations_to_key", "get_annotations", "pod_name", "pod_name", "pod_names"], ["len", "pod_names", "mock_kube_client", "patch_namespaced_pod", "call_count"], ["mock_kube_client", "patch_namespaced_pod", "assert_has_calls", "mock", "call", "body", "name", "pod_name", "namespace", "pod_name", "pod_names", "any_order", "True"]], "scheduler_job_id": []}, "name": "test_adopt_completed_pods", "params": {"mock_kube_client": "", "self": ""}, "params_descr": {"mock_kube_client": "", "self": ""}, "params_occur": {"mock_kube_client": [["mock_kube_client", "list_namespaced_pod", "return_value", "items", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "pod_name", "labels", "pod_name", "annotations", "get_annotations", "pod_name", "namespace", "pod_name", "pod_names"], ["executor", "_adopt_completed_pods", "mock_kube_client"], ["mock_kube_client", "list_namespaced_pod", "assert_called_once_with", "namespace", "field_selector", "label_selector"], ["len", "pod_names", "mock_kube_client", "patch_namespaced_pod", "call_count"], ["mock_kube_client", "patch_namespaced_pod", "assert_has_calls", "mock", "call", "body", "name", "pod_name", "namespace", "pod_name", "pod_names", "any_order", "True"]], "self": []}, "params_p": {"args": [], "kwargs": [], "mock_kube_client": [["mock.MagicMock", 0.09038033595830816]], "self": []}, "q_name": "TestKubernetesExecutor.test_adopt_completed_pods", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "expected_running_ti_keys": "", "kube_client": "", "pod_names": "", "scheduler_job_id": ""}, "variables_p": {"executor": [["docusign.models.Config", 0.11076870278363242], ["tests.core.base_schema_tesMockSchemaCollection", 0.10414743839555976]], "expected_running_ti_keys": [["str", 1.0]], "kube_client": [["str", 0.4], ["int", 0.2]], "pod_names": [["str", 0.5731105029120176], ["app.config.Config", 0.16372488368498844], ["Optional[str]", 0.09200866285132885], ["ChainMap", 0.08795187246695498], ["Dict[str, str]", 0.08320407808471031]], "scheduler_job_id": [["Optional[str]", 0.3], ["int", 0.3], ["str", 0.19999999999999998], ["Optional[int]", 0.09999999999999999]]}}, {"docstring": {"func": "We should not adopt any tasks that were not assigned by the scheduler.", "long_descr": "This ensures that there is no contention over pod management.", "ret": null}, "fn_lc": [[882, 4], [905, 52]], "fn_var_ln": {"executor": [[888, 8], [888, 16]], "pod": [[891, 8], [891, 11]], "scheduler_job_id": [[889, 8], [889, 33]], "tis_to_flush_by_key": [[890, 8], [890, 27]]}, "fn_var_occur": {"executor": [["executor", "self", "kubernetes_executor"], ["executor", "scheduler_job_id"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"]], "pod": [["pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "labels", "annotations"], ["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"]], "scheduler_job_id": [["executor", "scheduler_job_id"]], "tis_to_flush_by_key": [["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"]]}, "name": "test_not_adopt_unassigned_task", "params": {"mock_kube_client": "", "self": ""}, "params_descr": {"mock_kube_client": "", "self": ""}, "params_occur": {"mock_kube_client": [["executor", "adopt_launched_task", "mock_kube_client", "pod", "pod", "tis_to_flush_by_key", "tis_to_flush_by_key"], ["mock_kube_client", "patch_namespaced_pod", "called"]], "self": [["executor", "self", "kubernetes_executor"]]}, "params_p": {"args": [], "kwargs": [], "mock_kube_client": [], "self": []}, "q_name": "TestKubernetesExecutor.test_not_adopt_unassigned_task", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "pod": "", "scheduler_job_id": "", "tis_to_flush_by_key": ""}, "variables_p": {"executor": [["int", 0.42106058579842565], ["str", 0.11164266610337575], ["float", 0.08900685625340694]], "pod": [["qutebrowser.utils.usertypes.Question", 0.10012155212045759]], "scheduler_job_id": [["str", 0.8309518441065099], ["int", 0.11556409045997561]], "tis_to_flush_by_key": [["bytes", 0.09071214831122702]]}}, {"docstring": {"func": "Delete any pods associated with a task stuck in queued.", "long_descr": null, "ret": null}, "fn_lc": [[909, 4], [926, 22]], "fn_var_ln": {"dag_run": [[916, 8], [916, 15]], "executor": [[911, 8], [911, 16]], "op": [[915, 12], [915, 14]], "queued_dttm": [[920, 8], [920, 22]], "retries": [[918, 8], [918, 18]], "scheduler_job_id": [[913, 8], [913, 33]], "state": [[919, 8], [919, 16]], "ti": [[917, 8], [917, 10]], "tis": [[922, 8], [922, 11]]}, "fn_var_occur": {"dag_run": [["dag_run", "dag_maker", "create_dagrun"], ["ti", "dag_run", "get_task_instance", "op", "task_id", "session"]], "executor": [["executor", "KubernetesExecutor"], ["executor", "start"], ["executor", "scheduler_job_id"], ["executor", "cleanup_stuck_queued_tasks", "tis"], ["executor", "running", "set"], ["executor", "end"]], "op": [["op", "BashOperator", "task_id", "bash_command"], ["ti", "dag_run", "get_task_instance", "op", "task_id", "session"]], "queued_dttm": [["ti", "queued_dttm", "timezone", "utcnow", "timedelta", "minutes"]], "retries": [["ti", "retries"]], "scheduler_job_id": [["executor", "scheduler_job_id"]], "state": [["ti", "state", "State", "QUEUED"]], "ti": [["ti", "dag_run", "get_task_instance", "op", "task_id", "session"], ["ti", "retries"], ["ti", "state", "State", "QUEUED"], ["ti", "queued_dttm", "timezone", "utcnow", "timedelta", "minutes"], ["ti", "refresh_from_db"], ["tis", "ti"]], "tis": [["tis", "ti"], ["executor", "cleanup_stuck_queued_tasks", "tis"]]}, "name": "test_cleanup_stuck_queued_tasks", "params": {"dag_maker": "", "mock_delete_pod": "", "mock_kube_client": "", "self": "", "session": ""}, "params_descr": {"dag_maker": "", "mock_delete_pod": "", "mock_kube_client": "", "self": "", "session": ""}, "params_occur": {"dag_maker": [["dag_maker", "dag_id"], ["dag_run", "dag_maker", "create_dagrun"]], "mock_delete_pod": [["mock_delete_pod", "assert_called_once"]], "mock_kube_client": [], "self": [], "session": [["ti", "dag_run", "get_task_instance", "op", "task_id", "session"]]}, "params_p": {"args": [], "dag_maker": [["aiohttp.test_utils.TestServer", 0.12595946540912584], ["mock.Mock", 0.11297405395300608]], "kwargs": [], "mock_delete_pod": [["mock.Mock", 0.18057055014629983]], "mock_kube_client": [["mock.MagicMock", 0.18184986559382257]], "self": [], "session": [["mock.Mock", 0.22411963525853595], ["aiohttp.test_utils.TestServer", 0.1357651031923524], ["tests.test_util.aiohttp.AiohttpClientMocker", 0.09250600843487078]]}, "q_name": "TestKubernetesExecutor.test_cleanup_stuck_queued_tasks", "ret_exprs": [], "ret_type": "", "variables": {"dag_run": "", "executor": "", "op": "", "queued_dttm": "", "retries": "", "scheduler_job_id": "", "state": "", "ti": "", "tis": ""}, "variables_p": {"dag_run": [["int", 0.3735849030931816], ["bytes", 0.1000694221171946]], "executor": [["float", 0.10219034727430173], ["str", 0.0884007030895201]], "op": [["Dict[Any, str]", 0.375617082204923], ["Dict[str, str]", 0.1531824304916311], ["dict", 0.12520569406830767], ["Pattern[Any]", 0.1123274987402723], ["int", 0.08221404064378954], ["list", 0.08123557977701674]], "queued_dttm": [["int", 0.2], ["dict", 0.1], ["List[int]", 0.1], ["List[List[int]]", 0.1], ["str", 0.1], ["datetime.timedelta", 0.1]], "retries": [["int", 0.2], ["dict", 0.1], ["List[int]", 0.1], ["List[List[int]]", 0.1], ["str", 0.1], ["datetime.timedelta", 0.1]], "scheduler_job_id": [["str", 0.8309518441065099], ["int", 0.11556409045997561]], "state": [["str", 0.7999999999999999], ["Dict[str, str]", 0.1]], "ti": [["str", 0.2894604681620575], ["int", 0.14853283220178778], ["Dict[int, str]", 0.10163211323608123], ["Dict[Any, str]", 0.09454259818776332], ["List[int]", 0.0876222065431372]], "tis": [["List[str]", 0.11814570118195425]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[937, 4], [947, 104]], "fn_var_ln": {"config": [[940, 8], [940, 14]], "executor": [[945, 12], [945, 20]]}, "fn_var_occur": {"config": [["config", "raw_multi_namespace_mode", "raw_value_namespace_list"], ["conf_vars", "config"]], "executor": [["executor", "KubernetesExecutor"], ["executor", "kube_config", "multi_namespace_mode_namespace_list", "expected_value_in_kube_config"]]}, "name": "test_kube_config_get_namespace_list", "params": {"expected_value_in_kube_config": "", "raw_multi_namespace_mode": "", "raw_value_namespace_list": "", "self": ""}, "params_descr": {"expected_value_in_kube_config": "", "raw_multi_namespace_mode": "", "raw_value_namespace_list": "", "self": ""}, "params_occur": {"expected_value_in_kube_config": [["executor", "kube_config", "multi_namespace_mode_namespace_list", "expected_value_in_kube_config"]], "raw_multi_namespace_mode": [["config", "raw_multi_namespace_mode", "raw_value_namespace_list"]], "raw_value_namespace_list": [["config", "raw_multi_namespace_mode", "raw_value_namespace_list"]], "self": []}, "params_p": {"args": [], "expected_value_in_kube_config": [["str", 0.38307474422050997], ["int", 0.20334551818667357], ["bytes", 0.09400062500313872]], "kwargs": [], "raw_multi_namespace_mode": [["str", 0.6980733788995944], ["Optional[str]", 0.2033519890944177]], "raw_value_namespace_list": [["str", 0.6980733788995944], ["Optional[str]", 0.2033519890944177]], "self": []}, "q_name": "TestKubernetesExecutor.test_kube_config_get_namespace_list", "ret_exprs": [], "ret_type": "", "variables": {"config": "", "executor": ""}, "variables_p": {"config": [["str", 0.19306745314919682], ["bool", 0.10376390224402633], ["staticmethod", 0.09905014845652563], ["List[Dict[str, str]]", 0.09683141172614247], ["List[str]", 0.09683141172614247], ["List[Tuple[int, float]]", 0.09544485448646722]], "executor": [["int", 0.3641354491795578], ["dict", 0.10254885240525353], ["List[bool]", 0.1008182506241995], ["\"OrderedDict[str, float]\"", 0.09714090095131628]]}}, {"docstring": {"func": "If a pod isn't found for a TI, reset the state to scheduled", "long_descr": null, "ret": null}, "fn_lc": [[949, 4], [980, 9]], "fn_var_ln": {"dag_run": [[955, 8], [955, 15]], "execution_date_label": [[974, 8], [974, 28]], "executor": [[962, 8], [962, 16]], "job_id": [[963, 8], [963, 23]], "kube_client": [[964, 8], [964, 28]], "mock_kube_client": [[951, 8], [951, 24]], "queued_by_job_id": [[959, 8], [959, 27]], "state": [[958, 8], [958, 16]], "ti": [[957, 8], [957, 10]]}, "fn_var_occur": {"dag_run": [["dag_run", "dag_maker", "create_dagrun"], ["ti", "dag_run", "task_instances"]], "execution_date_label": [["execution_date_label", "pod_generator", "datetime_to_label_safe_datestring", "ti", "execution_date"], ["mock_kube_client", "list_namespaced_pod", "assert_called_with", "namespace", "label_selector", "execution_date_label"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "job_id"], ["executor", "kube_client", "mock_kube_client"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]], "job_id": [["executor", "job_id"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["mock_kube_client", "list_namespaced_pod", "return_value", "k8s", "V1PodList", "items"], ["executor", "kube_client", "mock_kube_client"], ["mock_kube_client", "list_namespaced_pod", "call_count"], ["mock_kube_client", "list_namespaced_pod", "assert_any_call", "namespace", "label_selector"], ["mock_kube_client", "list_namespaced_pod", "assert_called_with", "namespace", "label_selector", "execution_date_label"]], "queued_by_job_id": [["ti", "queued_by_job_id"]], "state": [["ti", "state", "State", "QUEUED"], ["ti", "state", "State", "SCHEDULED"]], "ti": [["ti", "dag_run", "task_instances"], ["ti", "state", "State", "QUEUED"], ["ti", "queued_by_job_id"], ["ti", "refresh_from_db"], ["ti", "state", "State", "SCHEDULED"], ["execution_date_label", "pod_generator", "datetime_to_label_safe_datestring", "ti", "execution_date"]]}, "name": "test_clear_not_launched_queued_tasks_not_launched", "params": {"create_dummy_dag": "", "dag_maker": "", "self": "", "session": ""}, "params_descr": {"create_dummy_dag": "", "dag_maker": "", "self": "", "session": ""}, "params_occur": {"create_dummy_dag": [["create_dummy_dag", "dag_id", "task_id", "with_dagrun_type", "None"]], "dag_maker": [["dag_run", "dag_maker", "create_dagrun"]], "self": [["executor", "self", "kubernetes_executor"]], "session": [["session", "flush"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]]}, "params_p": {"args": [], "create_dummy_dag": [["raiden.utils.ChannelID", 0.1124584230377328], ["float", 0.10799028730887793], ["server.models.bike.Bike", 0.10799028730887793], ["server.models.Rental", 0.10799028730887793], ["metrics_backend.utils.ChannelIdentifier", 0.0963112855695745]], "dag_maker": [["Optional[str]", 0.10864242967574458], ["Callable", 0.09979654816258261], ["raiden.utils.NetworkTimeout", 0.09519796378590561], ["bool", 0.09347777261704858]], "kwargs": [], "self": [], "session": [["bool", 0.12326899425757704], ["str", 0.09733308822185817], ["zerver.models.UserProfile", 0.0961990895379916]]}, "q_name": "TestKubernetesExecutor.test_clear_not_launched_queued_tasks_not_launched", "ret_exprs": [], "ret_type": "", "variables": {"dag_run": "", "execution_date_label": "", "executor": "", "job_id": "", "kube_client": "", "mock_kube_client": "", "queued_by_job_id": "", "state": "", "ti": ""}, "variables_p": {"dag_run": [["list", 0.12473667362297597], ["float", 0.11390392783046245], ["int", 0.10733087290171416]], "execution_date_label": [["datetime.date.time.timedelta", 0.17950498411950422], ["str", 0.10448708480370376], ["datetime.timedelta", 0.1042443202355933], ["int", 0.0891961086561304], ["bool", 0.08468020282268136]], "executor": [["pandas-master.pandas.tests.io.test_common.CustomFSPath", 0.09513180716507096]], "job_id": [["str", 0.9999999999931534], ["int", 6.846667155856282e-12]], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "mock_kube_client": [["mock.Mock", 0.7564716616147951]], "queued_by_job_id": [["str", 0.6416711925023665], ["int", 0.2900578101505342], ["Pattern[Any]", 0.06827099734709928]], "state": [["str", 0.7999999999999999], ["Dict[str, str]", 0.1]], "ti": [["int", 0.5535951796474678], ["raiden.utils.PaymentID", 0.13766998432404268], ["str", 0.09638787134133761]]}}, {"docstring": {"func": "Leave the state alone if a pod already exists", "long_descr": null, "ret": null}, "fn_lc": [[990, 4], [1016, 9]], "fn_var_ln": {"dag_run": [[998, 8], [998, 15]], "executor": [[1006, 8], [1006, 16]], "job_id": [[1007, 8], [1007, 23]], "kube_client": [[1009, 8], [1009, 28]], "kubernetes_queue": [[1008, 8], [1008, 33]], "mock_kube_client": [[994, 8], [994, 24]], "queue": [[1003, 8], [1003, 16]], "queued_by_job_id": [[1002, 8], [1002, 27]], "state": [[1001, 8], [1001, 16]], "ti": [[1000, 8], [1000, 10]]}, "fn_var_occur": {"dag_run": [["dag_run", "dag_maker", "create_dagrun"], ["ti", "dag_run", "task_instances"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "job_id"], ["executor", "kubernetes_queue", "kubernetes_queue"], ["executor", "kube_client", "mock_kube_client"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]], "job_id": [["executor", "job_id"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "kubernetes_queue": [["executor", "kubernetes_queue", "kubernetes_queue"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["mock_kube_client", "list_namespaced_pod", "return_value", "k8s", "V1PodList", "items"], ["executor", "kube_client", "mock_kube_client"], ["mock_kube_client", "list_namespaced_pod", "assert_called_once_with", "namespace", "label_selector"]], "queue": [["ti", "queue", "task_queue"]], "queued_by_job_id": [["ti", "queued_by_job_id"]], "state": [["ti", "state", "State", "QUEUED"], ["ti", "state", "State", "QUEUED"]], "ti": [["ti", "dag_run", "task_instances"], ["ti", "state", "State", "QUEUED"], ["ti", "queued_by_job_id"], ["ti", "queue", "task_queue"], ["ti", "refresh_from_db"], ["ti", "state", "State", "QUEUED"]]}, "name": "test_clear_not_launched_queued_tasks_launched", "params": {"create_dummy_dag": "", "dag_maker": "", "kubernetes_queue": "", "self": "", "session": "", "task_queue": ""}, "params_descr": {"create_dummy_dag": "", "dag_maker": "", "kubernetes_queue": "", "self": "", "session": "", "task_queue": ""}, "params_occur": {"create_dummy_dag": [["create_dummy_dag", "dag_id", "task_id", "with_dagrun_type", "None"]], "dag_maker": [["dag_run", "dag_maker", "create_dagrun"]], "kubernetes_queue": [["executor", "kubernetes_queue", "kubernetes_queue"]], "self": [["executor", "self", "kubernetes_executor"]], "session": [["session", "flush"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]], "task_queue": [["ti", "queue", "task_queue"]]}, "params_p": {"args": [], "create_dummy_dag": [["float", 0.10925871759913539], ["server.models.bike.Bike", 0.10925871759913539], ["server.models.Rental", 0.10925871759913539], ["raiden.utils.ChannelID", 0.1072191968332997], ["raiden.utils.Address", 0.09736753215811003]], "dag_maker": [["tests.basilisp.helpers.CompileFn", 0.06773430851805723]], "kubernetes_queue": [["raiden.utils.List[raiden.utils.TokenAddress]", 0.1079609365659237], ["int", 0.09759170780617166]], "kwargs": [], "self": [], "session": [["Callable[[List, bool], None]", 0.6733175994210865], ["str", 0.07069663540206536]], "task_queue": [["mock.MagicMock", 0.10359562275836974], ["core.models.Recipe", 0.08915027882164493]]}, "q_name": "TestKubernetesExecutor.test_clear_not_launched_queued_tasks_launched", "ret_exprs": [], "ret_type": "", "variables": {"dag_run": "", "executor": "", "job_id": "", "kube_client": "", "kubernetes_queue": "", "mock_kube_client": "", "queue": "", "queued_by_job_id": "", "state": "", "ti": ""}, "variables_p": {"dag_run": [["list", 0.12473667362297597], ["float", 0.11390392783046245], ["int", 0.10733087290171416]], "executor": [["Dict[str, Any]", 0.10001332968190353]], "job_id": [["str", 0.9999999999931534], ["int", 6.846667155856282e-12]], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "kubernetes_queue": [["str", 0.19072059490690046], ["Dict[str, str]", 0.15266195492754453], ["Type[Dict[Any, Any]]", 0.0981159540486931], ["bool", 0.09413310605145138], ["cincoconfig.config.Schema", 0.09413310605145138], ["Dict[Union[bool, str], Any]", 0.09303305405221306]], "mock_kube_client": [["mock.Mock", 0.7564716616147951]], "queue": [["int", 0.40606835171693134], ["str", 0.20142967799816824], ["Tuple[str, str, str, str, str, str, str, str, str, str]", 0.11200260905559]], "queued_by_job_id": [["str", 0.6416711925023665], ["int", 0.2900578101505342], ["Pattern[Any]", 0.06827099734709928]], "state": [["str", 0.7999999999999999], ["Dict[str, str]", 0.1]], "ti": [["int", 0.57973502344617], ["raiden.utils.PaymentID", 0.12271172266957124], ["str", 0.09275077288114172], ["Mapping", 0.09275077288114172]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1021, 8], [1025, 46]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "list_namespaced_pod", "params": {"args": "", "kwargs": ""}, "params_descr": {"args": "", "kwargs": ""}, "params_occur": {"args": [], "kwargs": []}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesExecutor.test_clear_not_launched_queued_tasks_mapped_task.<locals>.list_namespaced_pod", "ret_exprs": ["return k8s.V1PodList(items=[\"something\"])", "return k8s.V1PodList(items=[])"], "ret_type": "", "ret_type_p": [["List[str]", 0.24752377487116578], ["Optional[float]", 0.17672085964700304], ["int", 0.1272687733321658]], "variables": {}, "variables_p": {}}, {"docstring": {"func": "One mapped task has a launched pod - other does not.", "long_descr": null, "ret": null}, "fn_lc": [[1018, 4], [1073, 9]], "fn_var_ln": {"dag_run": [[1033, 8], [1033, 15]], "execution_date_label": [[1055, 8], [1055, 28]], "executor": [[1044, 8], [1044, 16]], "job_id": [[1045, 8], [1045, 23]], "kube_client": [[1046, 8], [1046, 28]], "mock_kube_client": [[1027, 8], [1027, 24]], "op": [[1031, 12], [1031, 14]], "queued_by_job_id": [[1040, 8], [1040, 28]], "state": [[1039, 8], [1039, 17]], "ti0": [[1034, 8], [1034, 11]], "ti1": [[1038, 8], [1038, 11]]}, "fn_var_occur": {"dag_run": [["dag_run", "dag_maker", "create_dagrun"], ["ti0", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"], ["ti1", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"], ["execution_date_label", "pod_generator", "datetime_to_label_safe_datestring", "dag_run", "execution_date"]], "execution_date_label": [["execution_date_label", "pod_generator", "datetime_to_label_safe_datestring", "dag_run", "execution_date"], ["mock_kube_client", "list_namespaced_pod", "assert_has_calls", "mock", "call", "namespace", "label_selector", "mock", "call", "namespace", "label_selector", "mock", "call", "namespace", "label_selector", "execution_date_label", "any_order", "True"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "job_id"], ["executor", "kube_client", "mock_kube_client"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]], "job_id": [["executor", "job_id"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["mock_kube_client", "list_namespaced_pod", "side_effect", "list_namespaced_pod"], ["executor", "kube_client", "mock_kube_client"], ["mock_kube_client", "list_namespaced_pod", "call_count"], ["mock_kube_client", "list_namespaced_pod", "assert_has_calls", "mock", "call", "namespace", "label_selector", "mock", "call", "namespace", "label_selector", "mock", "call", "namespace", "label_selector", "execution_date_label", "any_order", "True"]], "op": [["op", "BashOperator", "partial", "task_id", "expand", "bash_command"], ["ti0", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"], ["ti1", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"]], "queued_by_job_id": [["ti0", "queued_by_job_id"], ["ti1", "queued_by_job_id"]], "state": [["ti0", "state", "State", "QUEUED"], ["ti1", "state", "State", "QUEUED"], ["ti0", "state", "State", "QUEUED"], ["ti1", "state", "State", "SCHEDULED"]], "ti0": [["ti0", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"], ["ti0", "state", "State", "QUEUED"], ["ti0", "queued_by_job_id"], ["ti0", "refresh_from_db"], ["ti0", "state", "State", "QUEUED"]], "ti1": [["ti1", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"], ["ti1", "state", "State", "QUEUED"], ["ti1", "queued_by_job_id"], ["ti1", "refresh_from_db"], ["ti1", "state", "State", "SCHEDULED"]]}, "name": "test_clear_not_launched_queued_tasks_mapped_task", "params": {"dag_maker": "", "self": "", "session": ""}, "params_descr": {"dag_maker": "", "self": "", "session": ""}, "params_occur": {"dag_maker": [["dag_maker", "dag_id"], ["dag_run", "dag_maker", "create_dagrun"]], "self": [["executor", "self", "kubernetes_executor"]], "session": [["ti0", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"], ["ti1", "dag_run", "get_task_instance", "op", "task_id", "session", "map_index"], ["session", "flush"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]]}, "params_p": {"args": [], "dag_maker": [["raiden.utils.List[raiden.raiden_service.RaidenService]", 0.1189334694880939], ["int", 0.1020626804384007]], "kwargs": [], "self": [], "session": [["str", 0.3963292661124203], ["dict", 0.0918688211466481]]}, "q_name": "TestKubernetesExecutor.test_clear_not_launched_queued_tasks_mapped_task", "ret_exprs": [], "ret_type": "", "variables": {"dag_run": "", "execution_date_label": "", "executor": "", "job_id": "", "kube_client": "", "mock_kube_client": "", "op": "", "queued_by_job_id": "", "state": "", "ti0": "", "ti1": ""}, "variables_p": {"dag_run": [["int", 0.1849037423202071], ["bytes", 0.10426232937396425]], "execution_date_label": [["datetime.date.time.timedelta", 0.18704012595420003], ["datetime.timedelta", 0.11603744637573639], ["str", 0.10339002731927713], ["int", 0.08903807735927027], ["Pattern[str]", 0.08299519505215348]], "executor": [["pandas-master.pandas.tests.io.test_common.CustomFSPath", 0.09513180716507096]], "job_id": [["str", 0.9999999999931534], ["int", 6.846667155856282e-12]], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "mock_kube_client": [["mock.Mock", 0.34876565640959906]], "op": [["int", 0.46590091344450085], ["Dict[str, Union[Any, Any]]", 0.10204773552236754], ["Dict[str, str]", 0.10173932688724648]], "queued_by_job_id": [["str", 0.6481854848564672], ["int", 0.17133760663109238], ["list", 0.08143895314393021]], "state": [["str", 0.7999999999999999], ["Dict[str, str]", 0.1]], "ti0": [["int", 0.1710303982839423], ["geode.models.common.Address", 0.14024318023295287], ["List[str]", 0.09847959091612014], ["str", 0.09437611070025621]], "ti1": [["int", 0.1710303982839423], ["geode.models.common.Address", 0.14024318023295287], ["List[str]", 0.09847959091612014], ["str", 0.09437611070025621]]}}, {"docstring": {"func": "Queued TI has no pod, but it is not queued for the k8s executor", "long_descr": null, "ret": null}, "fn_lc": [[1075, 4], [1099, 67]], "fn_var_ln": {"dag_run": [[1083, 8], [1083, 15]], "executor": [[1090, 8], [1090, 16]], "job_id": [[1091, 8], [1091, 23]], "kube_client": [[1094, 8], [1094, 28]], "kubernetes_queue": [[1092, 8], [1092, 33]], "mock_kube_client": [[1079, 8], [1079, 24]], "queued_by_job_id": [[1087, 8], [1087, 27]], "state": [[1086, 8], [1086, 16]], "ti": [[1085, 8], [1085, 10]]}, "fn_var_occur": {"dag_run": [["dag_run", "dag_maker", "create_dagrun"], ["ti", "dag_run", "task_instances"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "job_id"], ["executor", "kubernetes_queue"], ["executor", "kube_client", "mock_kube_client"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]], "job_id": [["executor", "job_id"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "kubernetes_queue": [["executor", "kubernetes_queue"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["mock_kube_client", "list_namespaced_pod", "return_value", "k8s", "V1PodList", "items"], ["executor", "kube_client", "mock_kube_client"], ["mock_kube_client", "list_namespaced_pod", "call_count"]], "queued_by_job_id": [["ti", "queued_by_job_id"]], "state": [["ti", "state", "State", "QUEUED"], ["ti", "state", "State", "QUEUED"]], "ti": [["ti", "dag_run", "task_instances"], ["ti", "state", "State", "QUEUED"], ["ti", "queued_by_job_id"], ["ti", "refresh_from_db"], ["ti", "state", "State", "QUEUED"]]}, "name": "test_clear_not_launched_queued_tasks_not_launched_other_queue", "params": {"create_dummy_dag": "", "dag_maker": "", "self": "", "session": ""}, "params_descr": {"create_dummy_dag": "", "dag_maker": "", "self": "", "session": ""}, "params_occur": {"create_dummy_dag": [["create_dummy_dag", "dag_id", "task_id", "with_dagrun_type", "None"]], "dag_maker": [["dag_run", "dag_maker", "create_dagrun"]], "self": [["executor", "self", "kubernetes_executor"]], "session": [["session", "flush"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]]}, "params_p": {"args": [], "create_dummy_dag": [["raiden.utils.ChannelID", 0.11194872093971199], ["float", 0.10701663111780046], ["server.models.bike.Bike", 0.10701663111780046], ["server.models.Rental", 0.10701663111780046], ["metrics_backend.utils.ChannelIdentifier", 0.09782304016007559]], "dag_maker": [["Optional[str]", 0.10852327842579408], ["Callable", 0.1002609192917299], ["raiden.utils.NetworkTimeout", 0.09500418614139877], ["bool", 0.09348703936287507]], "kwargs": [], "self": [], "session": [["bool", 0.12254298095601325], ["zerver.models.UserProfile", 0.09664879176186152]]}, "q_name": "TestKubernetesExecutor.test_clear_not_launched_queued_tasks_not_launched_other_queue", "ret_exprs": [], "ret_type": "", "variables": {"dag_run": "", "executor": "", "job_id": "", "kube_client": "", "kubernetes_queue": "", "mock_kube_client": "", "queued_by_job_id": "", "state": "", "ti": ""}, "variables_p": {"dag_run": [["list", 0.12473667362297597], ["float", 0.11390392783046245], ["int", 0.10733087290171416]], "executor": [], "job_id": [["str", 0.9999999999931534], ["int", 6.846667155856282e-12]], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "kubernetes_queue": [["int", 0.2], ["dict", 0.1], ["List[int]", 0.1], ["List[List[int]]", 0.1], ["str", 0.1], ["datetime.timedelta", 0.1]], "mock_kube_client": [["mock.Mock", 0.7564716616147951]], "queued_by_job_id": [["str", 0.6416711925023665], ["int", 0.2900578101505342], ["Pattern[Any]", 0.06827099734709928]], "state": [["str", 0.7999999999999999], ["Dict[str, str]", 0.1]], "ti": [["int", 0.5535951796474678], ["raiden.utils.PaymentID", 0.13766998432404268], ["str", 0.09638787134133761]]}}, {"docstring": {"func": "clear only not launched queued  tasks which are queued by the same executor job", "long_descr": null, "ret": null}, "fn_lc": [[1101, 4], [1130, 40]], "fn_var_ln": {"dag_run": [[1115, 8], [1115, 15]], "executor": [[1122, 8], [1122, 16]], "job_id": [[1123, 8], [1123, 23]], "kube_client": [[1124, 8], [1124, 28]], "mock_kube_client": [[1103, 8], [1103, 24]], "queued_by_job_id": [[1119, 8], [1119, 28]], "state": [[1118, 8], [1118, 17]], "ti0": [[1109, 8], [1109, 11]], "ti1": [[1117, 8], [1117, 11]]}, "fn_var_occur": {"dag_run": [["dag_run", "dag_maker", "create_dagrun"], ["ti0", "dag_run", "task_instances"], ["dag_run", "dag_maker", "create_dagrun"], ["ti1", "dag_run", "task_instances"]], "executor": [["executor", "self", "kubernetes_executor"], ["executor", "job_id"], ["executor", "kube_client", "mock_kube_client"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]], "job_id": [["executor", "job_id"]], "kube_client": [["executor", "kube_client", "mock_kube_client"]], "mock_kube_client": [["mock_kube_client", "mock", "MagicMock"], ["mock_kube_client", "list_namespaced_pod", "return_value", "k8s", "V1PodList", "items"], ["executor", "kube_client", "mock_kube_client"]], "queued_by_job_id": [["ti0", "queued_by_job_id"], ["ti1", "queued_by_job_id"]], "state": [["ti0", "state", "State", "QUEUED"], ["ti1", "state", "State", "QUEUED"], ["ti0", "state", "State", "SCHEDULED"], ["ti1", "state", "State", "QUEUED"]], "ti0": [["ti0", "dag_run", "task_instances"], ["ti0", "state", "State", "QUEUED"], ["ti0", "queued_by_job_id"], ["ti0", "refresh_from_db"], ["ti0", "state", "State", "SCHEDULED"]], "ti1": [["ti1", "dag_run", "task_instances"], ["ti1", "state", "State", "QUEUED"], ["ti1", "queued_by_job_id"], ["ti1", "refresh_from_db"], ["ti1", "state", "State", "QUEUED"]]}, "name": "test_clear_not_launched_queued_tasks_clear_only_by_job_id", "params": {"create_dummy_dag": "", "dag_maker": "", "self": "", "session": ""}, "params_descr": {"create_dummy_dag": "", "dag_maker": "", "self": "", "session": ""}, "params_occur": {"create_dummy_dag": [["create_dummy_dag", "dag_id", "task_id", "with_dagrun_type", "None"], ["create_dummy_dag", "dag_id", "task_id", "with_dagrun_type", "None"]], "dag_maker": [["dag_run", "dag_maker", "create_dagrun"], ["dag_run", "dag_maker", "create_dagrun"]], "self": [["executor", "self", "kubernetes_executor"]], "session": [["session", "flush"], ["session", "flush"], ["executor", "clear_not_launched_queued_tasks", "session", "session"]]}, "params_p": {"args": [], "create_dummy_dag": [["raiden.utils.ChannelID", 0.1074623238558105], ["float", 0.10724229164556309], ["server.models.bike.Bike", 0.10724229164556309], ["server.models.Rental", 0.10724229164556309], ["zerver.models.PreregistrationUser", 0.08813440608834762]], "dag_maker": [["raiden.utils.Callable", 0.11901875225046396], ["excars.models.user.User", 0.10363038159386226], ["bool", 0.09493798527546839]], "kwargs": [], "self": [], "session": [["zerver.models.Attachment", 0.10346700676886345], ["zerver.models.UserProfile", 0.09338918812049475]]}, "q_name": "TestKubernetesExecutor.test_clear_not_launched_queued_tasks_clear_only_by_job_id", "ret_exprs": [], "ret_type": "", "variables": {"dag_run": "", "executor": "", "job_id": "", "kube_client": "", "mock_kube_client": "", "queued_by_job_id": "", "state": "", "ti0": "", "ti1": ""}, "variables_p": {"dag_run": [["int", 0.2130340213809631], ["List[str]", 0.10218917123553493], ["List[Tuple[Any, Any]]", 0.10004301976941747]], "executor": [["pandas-master.pandas.tests.io.test_common.CustomFSPath", 0.09513180716507096]], "job_id": [["str", 0.9999999999931534], ["int", 6.846667155856282e-12]], "kube_client": [["tests.unitest_app.FakeClient", 0.42882919558994487]], "mock_kube_client": [["mock.Mock", 0.7564716616147951]], "queued_by_job_id": [["str", 0.6481854848564672], ["int", 0.17133760663109238], ["list", 0.08143895314393021]], "state": [["str", 0.7999999999999999], ["Dict[str, str]", 0.1]], "ti0": [["int", 0.5535951796474678], ["raiden.utils.PaymentID", 0.13766998432404268], ["str", 0.09638787134133761]], "ti1": [["int", 0.5535951796474678], ["raiden.utils.PaymentID", 0.13766998432404268], ["str", 0.09638787134133761]]}}, {"docstring": {"func": "fetch task log from pod", "long_descr": null, "ret": null}, "fn_lc": [[1133, 4], [1161, 9]], "fn_var_ln": {"executor": [[1143, 8], [1143, 16]], "logs": [[1156, 18], [1156, 22]], "messages": [[1156, 8], [1156, 16]], "mock_kube_client": [[1135, 8], [1135, 24]], "mock_pod": [[1138, 8], [1138, 16]], "ti": [[1141, 8], [1141, 10]]}, "fn_var_occur": {"executor": [["executor", "KubernetesExecutor"], ["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"], ["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"]], "logs": [["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"], ["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"]], "messages": [["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"], ["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"]], "mock_kube_client": [["mock_kube_client", "mock_get_kube_client", "return_value"], ["mock_kube_client", "read_namespaced_pod_log", "return_value"], ["mock_kube_client", "list_namespaced_pod", "return_value", "items", "mock_pod"], ["mock_kube_client", "read_namespaced_pod_log", "assert_called_once"], ["mock_kube_client", "reset_mock"], ["mock_kube_client", "read_namespaced_pod_log", "side_effect", "Exception"]], "mock_pod": [["mock_pod", "mock", "Mock"], ["mock_pod", "metadata", "name"], ["mock_kube_client", "list_namespaced_pod", "return_value", "items", "mock_pod"]], "ti": [["ti", "create_task_instance_of_operator", "EmptyOperator", "dag_id", "task_id"], ["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"], ["messages", "logs", "executor", "get_task_log", "ti", "ti", "try_number"]]}, "name": "test_get_task_log", "params": {"create_task_instance_of_operator": "", "mock_get_kube_client": "", "self": ""}, "params_descr": {"create_task_instance_of_operator": "", "mock_get_kube_client": "", "self": ""}, "params_occur": {"create_task_instance_of_operator": [["ti", "create_task_instance_of_operator", "EmptyOperator", "dag_id", "task_id"]], "mock_get_kube_client": [["mock_kube_client", "mock_get_kube_client", "return_value"]], "self": []}, "params_p": {"args": [], "create_task_instance_of_operator": [["tracim.models.data.ContentRevisionRO", 0.122911017658393], ["aiohttp.test_utils.TestServer", 0.09805301601224638]], "kwargs": [], "mock_get_kube_client": [["kubernetes.clienCustomObjectsApi", 0.30283142102636496], ["tests.test_util.aiohttp.AiohttpClientMocker", 0.29108839545148824]], "self": []}, "q_name": "TestKubernetesExecutor.test_get_task_log", "ret_exprs": [], "ret_type": "", "variables": {"executor": "", "logs": "", "messages": "", "mock_kube_client": "", "mock_pod": "", "ti": ""}, "variables_p": {"executor": [["str", 0.25311287580928316], ["dss.config.Replica", 0.08205132137621267], ["speedwagon.config.AbsConfig", 0.0813386684790747]], "logs": [], "messages": [], "mock_kube_client": [["tests.utils.PicklableMock", 0.44182967099246123], ["Dict[str, Union[int, str]]", 0.11297557414997778], ["flask.config.Config", 0.08370659828670583]], "mock_pod": [["tests.conftesConfluentAvroConsumerMock", 0.10014939983220837], ["str", 0.0902758720856515]], "ti": [["bytes", 0.10363869890444363], ["dict", 0.09582128464680027], ["bytearray", 0.09565924360435445], ["str", 0.09563868759041329]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1163, 4], [1164, 51]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_supports_pickling", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": []}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesExecutor.test_supports_pickling", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1166, 4], [1167, 53]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_supports_sentry", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": []}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesExecutor.test_supports_sentry", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1169, 4], [1186, 44]], "fn_var_ln": {"annotations_actual": [[1184, 12], [1184, 30]], "annotations_test": [[1170, 8], [1170, 24]], "expected_annotations": [[1178, 12], [1178, 32]]}, "fn_var_occur": {"annotations_actual": [["annotations_actual", "annotations_for_logging_task_metadata", "annotations_test"], ["annotations_actual", "expected_annotations"]], "annotations_test": [["annotations_actual", "annotations_for_logging_task_metadata", "annotations_test"]], "expected_annotations": [["annotations_actual", "expected_annotations"]]}, "name": "test_annotations_for_logging_task_metadata", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": []}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesExecutor.test_annotations_for_logging_task_metadata", "ret_exprs": [], "ret_type": "", "variables": {"annotations_actual": "", "annotations_test": "", "expected_annotations": ""}, "variables_p": {"annotations_actual": [], "annotations_test": [["bool", 0.19626543615393857], ["Dict[str, Any]", 0.14365893694633977], ["Set[str]", 0.12441478806847776], ["List[bool]", 0.10723898255145814], ["bytes", 0.09458965670826334], ["List[str]", 0.08804509524701018], ["Dict[str, Union[Any, Any]]", 0.08234592112211536], ["str", 0.07926673264743475]], "expected_annotations": [["List[Dict[str, Any]]", 0.3333333333116212], ["Dict[int, List[str]]", 0.33333333330759557], ["float", 0.33333333330759557], ["int", 2.029907526534985e-11], ["Dict[str, Any]", 1.6273447660581563e-11], ["str", 1.6273447660581563e-11], ["List[str]", 1.6273447660581563e-11], ["Dict[str, Union[bool, str]]", 4.0682393902277804e-12]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1188, 4], [1200, 44]], "fn_var_ln": {"annotations_actual": [[1198, 12], [1198, 30]], "annotations_test": [[1189, 8], [1189, 24]], "expected_annotations": [[1197, 12], [1197, 32]]}, "fn_var_occur": {"annotations_actual": [["annotations_actual", "annotations_for_logging_task_metadata", "annotations_test"], ["annotations_actual", "expected_annotations"]], "annotations_test": [["annotations_actual", "annotations_for_logging_task_metadata", "annotations_test"]], "expected_annotations": [["annotations_actual", "expected_annotations"]]}, "name": "test_annotations_for_logging_task_metadata_fallback", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": []}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesExecutor.test_annotations_for_logging_task_metadata_fallback", "ret_exprs": [], "ret_type": "", "variables": {"annotations_actual": "", "annotations_test": "", "expected_annotations": ""}, "variables_p": {"annotations_actual": [], "annotations_test": [["bool", 0.19626543615393857], ["Dict[str, Any]", 0.14365893694633977], ["Set[str]", 0.12441478806847776], ["List[bool]", 0.10723898255145814], ["bytes", 0.09458965670826334], ["List[str]", 0.08804509524701018], ["Dict[str, Union[Any, Any]]", 0.08234592112211536], ["str", 0.07926673264743475]], "expected_annotations": [["List[Dict[str, Any]]", 0.3333333333116212], ["Dict[int, List[str]]", 0.33333333330759557], ["float", 0.33333333330759557], ["int", 2.029907526534985e-11], ["Dict[str, Any]", 1.6273447660581563e-11], ["str", 1.6273447660581563e-11], ["List[str]", 1.6273447660581563e-11], ["Dict[str, Union[bool, str]]", 4.0682393902277804e-12]]}}], "name": "TestKubernetesExecutor", "q_name": "TestKubernetesExecutor", "variables": {}, "variables_p": {}}, {"cls_lc": [[1203, 0], [1384, 90]], "cls_var_ln": {"test_namespace": [[1204, 4], [1204, 18]]}, "cls_var_occur": {"test_namespace": []}, "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1206, 4], [1232, 24]], "fn_var_ln": {"core_annotations": [[1215, 8], [1215, 29]], "events": [[1232, 8], [1232, 19]], "kube_client": [[1214, 8], [1214, 24]], "pod": [[1222, 8], [1222, 16]], "watcher": [[1207, 8], [1207, 20]]}, "fn_var_occur": {"core_annotations": [["self", "core_annotations", "None"], ["self", "pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "annotations", "self", "core_annotations", "namespace", "resource_version", "labels", "status", "k8s", "V1PodStatus", "phase"]], "events": [["self", "events"]], "kube_client": [["self", "kube_client", "mock", "MagicMock"]], "pod": [["self", "pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "annotations", "self", "core_annotations", "namespace", "resource_version", "labels", "status", "k8s", "V1PodStatus", "phase"]], "watcher": [["self", "watcher", "KubernetesJobWatcher", "namespace", "self", "test_namespace", "watcher_queue", "mock", "MagicMock", "resource_version", "scheduler_job_id", "kube_config", "mock", "MagicMock"]]}, "name": "setup_method", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "watcher", "KubernetesJobWatcher", "namespace", "self", "test_namespace", "watcher_queue", "mock", "MagicMock", "resource_version", "scheduler_job_id", "kube_config", "mock", "MagicMock"], ["self", "kube_client", "mock", "MagicMock"], ["self", "core_annotations", "None"], ["self", "pod", "k8s", "V1Pod", "metadata", "k8s", "V1ObjectMeta", "name", "annotations", "self", "core_annotations", "namespace", "resource_version", "labels", "status", "k8s", "V1PodStatus", "phase"], ["self", "events"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.setup_method", "ret_exprs": [], "ret_type": "", "variables": {"core_annotations": "", "events": "", "kube_client": "", "pod": "", "watcher": ""}, "variables_p": {"core_annotations": [["float", 0.21773719225927723], ["str", 0.18929900576094622], ["int", 0.1834899562394513], ["list", 0.10880895535984318], ["datetime.datetime.timedelta", 0.10434710083434318]], "events": [["Counter", 0.10319732803434611], ["int", 0.024970859137699808], ["str", 0.023510029691160606]], "kube_client": [], "pod": [["int", 0.22647698414391548], ["Dict[Any, int]", 0.09737601742782913], ["dict", 0.09737601742782913], ["float", 0.09277981210340677]], "watcher": []}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1234, 4], [1243, 80]], "fn_var_ln": {"latest_resource_version": [[1237, 12], [1237, 35]]}, "fn_var_occur": {"latest_resource_version": [["latest_resource_version", "self", "watcher", "_run", "self", "kube_client", "self", "watcher", "resource_version", "self", "watcher", "scheduler_job_id", "self", "watcher", "kube_config"], ["self", "pod", "metadata", "resource_version", "latest_resource_version"]]}, "name": "_run", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["mock_watch", "Watch", "return_value", "stream", "return_value", "self", "events"], ["latest_resource_version", "self", "watcher", "_run", "self", "kube_client", "self", "watcher", "resource_version", "self", "watcher", "scheduler_job_id", "self", "watcher", "kube_config"], ["self", "pod", "metadata", "resource_version", "latest_resource_version"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher._run", "ret_exprs": [], "ret_type": "", "variables": {"latest_resource_version": ""}, "variables_p": {"latest_resource_version": [["str", 0.4166432490441858], ["int", 0.19346980338078246]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1245, 4], [1254, 9]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "assert_watcher_queue_called_once_with_state", "params": {"self": "", "state": ""}, "params_descr": {"self": "", "state": ""}, "params_occur": {"self": [["self", "watcher", "watcher_queue", "put", "assert_called_once_with", "self", "pod", "metadata", "name", "self", "watcher", "namespace", "state", "self", "core_annotations", "self", "pod", "metadata", "resource_version"]], "state": [["self", "watcher", "watcher_queue", "put", "assert_called_once_with", "self", "pod", "metadata", "name", "self", "watcher", "namespace", "state", "self", "core_annotations", "self", "pod", "metadata", "resource_version"]]}, "params_p": {"args": [], "kwargs": [], "self": [], "state": [["dict", 0.19863989041382973], ["bool", 0.18488214575964823], ["prefecengine.state.State", 0.09705385776224086]]}, "q_name": "TestKubernetesJobWatcher.assert_watcher_queue_called_once_with_state", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1256, 4], [1260, 58]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_pending", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "watcher", "watcher_queue", "put", "assert_not_called"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_pending", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1262, 4], [1267, 70]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_pending_deleted", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "events", "append", "self", "pod"], ["self", "pod", "metadata", "deletion_timestamp", "datetime", "utcnow"], ["self", "_run"], ["self", "assert_watcher_queue_called_once_with_state", "State", "FAILED"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_pending_deleted", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1269, 4], [1274, 70]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_failed", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "assert_watcher_queue_called_once_with_state", "State", "FAILED"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_failed", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1276, 4], [1282, 62]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_succeeded", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "assert_watcher_queue_called_once_with_state", "None"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_succeeded", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1284, 4], [1290, 58]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_succeeded_dedup_label", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "pod", "metadata", "labels", "POD_EXECUTOR_DONE_KEY"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "watcher", "watcher_queue", "put", "assert_not_called"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_succeeded_dedup_label", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1292, 4], [1298, 58]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_succeeded_dedup_timestamp", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "pod", "metadata", "deletion_timestamp", "datetime", "utcnow"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "watcher", "watcher_queue", "put", "assert_not_called"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_succeeded_dedup_timestamp", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1300, 4], [1305, 58]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_succeeded_type_delete", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "watcher", "watcher_queue", "put", "assert_not_called"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_succeeded_type_delete", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1307, 4], [1313, 70]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_running_deleted", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "pod", "metadata", "deletion_timestamp", "datetime", "utcnow"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "assert_watcher_queue_called_once_with_state", "State", "FAILED"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_running_deleted", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1315, 4], [1320, 58]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_running", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "watcher", "watcher_queue", "put", "assert_not_called"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_running", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1322, 4], [1327, 58]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_process_status_catchall", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "events", "append", "self", "pod"], ["self", "_run"], ["self", "watcher", "watcher_queue", "put", "assert_not_called"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_status_catchall", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1330, 4], [1338, 66]], "fn_var_ln": {"message": [[1331, 8], [1331, 15]], "raw_object": [[1335, 8], [1335, 18]], "return_value": [[1334, 8], [1334, 39]]}, "fn_var_occur": {"message": [["raw_object", "message"]], "raw_object": [["raw_object", "message"], ["self", "events", "append", "self", "pod", "raw_object"]], "return_value": [["mock_process_error", "return_value"]]}, "name": "test_process_error_event_for_410", "params": {"mock_process_error": "", "self": ""}, "params_descr": {"mock_process_error": "", "self": ""}, "params_occur": {"mock_process_error": [["mock_process_error", "return_value"], ["mock_process_error", "assert_called_once_with", "self", "events"]], "self": [["self", "pod", "status", "phase"], ["self", "pod", "metadata", "resource_version"], ["self", "events", "append", "self", "pod", "raw_object"], ["self", "_run"], ["mock_process_error", "assert_called_once_with", "self", "events"]]}, "params_p": {"args": [], "kwargs": [], "mock_process_error": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_error_event_for_410", "ret_exprs": [], "ret_type": "", "variables": {"message": "", "raw_object": "", "return_value": ""}, "variables_p": {"message": [["List[str]", 0.3932809302856162], ["int", 0.1071533082409513], ["Dict[int, str]", 0.10045464950614941]], "raw_object": [["str", 0.2704067387124368], ["list", 0.11479921995741117], ["Set[str]", 0.11326333236502921], ["int", 0.10305783957301984], ["dict", 0.09951365526909615], ["List[Dict[str, str]]", 0.088512035162944]], "return_value": [["Dict[str, Union[int, str]]", 0.26706289672531636], ["List[Tuple[str, str]]", 0.11853411624592262], ["tests.utils.MockCoroutine", 0.09723178854711889], ["str", 0.09655871491789143], ["int", 0.09514683914250242], ["List[Tuple[str, str, bytes]]", 0.0891107086590052]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1340, 4], [1350, 23]], "fn_var_ln": {"error_message": [[1345, 8], [1345, 21]], "message": [[1341, 8], [1341, 15]], "raw_object": [[1343, 8], [1343, 18]]}, "fn_var_occur": {"error_message": [["error_message", "raw_object", "raw_object", "raw_object"], ["pytest", "raises", "AirflowException", "match", "error_message"]], "message": [["raw_object", "message"]], "raw_object": [["raw_object", "message"], ["self", "events", "append", "self", "pod", "raw_object"], ["error_message", "raw_object", "raw_object", "raw_object"]]}, "name": "test_process_error_event_for_raise_if_not_410", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "pod", "status", "phase"], ["self", "events", "append", "self", "pod", "raw_object"], ["self", "_run"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_process_error_event_for_raise_if_not_410", "ret_exprs": [], "ret_type": "", "variables": {"error_message": "", "message": "", "raw_object": ""}, "variables_p": {"error_message": [["str", 0.5022604679218681], ["int", 0.18121847756370468], ["dict", 0.13814432881098218], ["Tuple[Literal, None]", 0.09223664152997058], ["Dict[str, Union[Any, Any]]", 0.08614008417347453]], "message": [["List[str]", 0.3932809302856162], ["int", 0.1071533082409513], ["Dict[int, str]", 0.10045464950614941]], "raw_object": [["str", 0.30762504465161683], ["int", 0.17769995246538123], ["dict", 0.14641012048519986]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1356, 8], [1359, 43]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "effect", "params": {}, "params_descr": {}, "params_occur": {}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_recover_from_resource_too_old.<locals>.effect", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[1352, 4], [1384, 90]], "fn_var_ln": {"mock_underscore_run": [[1354, 8], [1354, 27]], "side_effect": [[1361, 8], [1361, 39]]}, "fn_var_occur": {"mock_underscore_run": [["mock_underscore_run", "side_effect", "effect"], ["self", "watcher", "_run", "mock_underscore_run"], ["mock_underscore_run", "reset_mock"], ["mock_underscore_run", "assert_called_once_with", "mock", "ANY", "mock", "ANY", "mock", "ANY"]], "side_effect": [["mock_underscore_run", "side_effect", "effect"]]}, "name": "test_recover_from_resource_too_old", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "watcher", "_run", "mock_underscore_run"], ["self", "watcher", "run"], ["self", "watcher", "resource_version"], ["ResourceVersion", "resource_version", "self", "test_namespace"], ["self", "watcher", "run"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestKubernetesJobWatcher.test_recover_from_resource_too_old", "ret_exprs": [], "ret_type": "", "variables": {"mock_underscore_run": "", "side_effect": ""}, "variables_p": {"mock_underscore_run": [["tests.utils.MockProvider", 0.1785036257458053], ["Tuple[Literal, Literal]", 0.17510334332538205], ["int", 0.1525732663504722], ["str", 0.09483170932095022]], "side_effect": [["str", 0.46146968833119484], ["List[Dict[str, float]]", 0.10543346334745063], ["Dict[str, Dict[str, str]]", 0.0831681400737581]]}}], "name": "TestKubernetesJobWatcher", "q_name": "TestKubernetesJobWatcher", "variables": {"test_namespace": ""}, "variables_p": {"test_namespace": [["List[Union[Any, Any]]", 0.39999999999999997], ["Dict[str, Any]", 0.19999999999999998], ["List[Dict[str, Any]]", 0.09999999999999999], ["str", 0.09999999999999999], ["List[Union[Any, Any, Any]]", 0.09999999999999999], ["bool", 0.09999999999999999]]}}], "funcs": [], "imports": ["__future__", "annotations", "pathlib", "random", "re", "string", "sys", "datetime", "datetime", "timedelta", "unittest", "mock", "pytest", "yaml", "kubernetes", "client", "models", "k8s", "kubernetes", "client", "rest", "ApiException", "urllib3", "HTTPResponse", "airflow", "AirflowException", "airflow", "exceptions", "PodReconciliationError", "airflow", "models", "taskinstancekey", "TaskInstanceKey", "airflow", "operators", "bash", "BashOperator", "airflow", "operators", "empty", "EmptyOperator", "airflow", "utils", "timezone", "airflow", "utils", "state", "State", "TaskInstanceState", "tests", "test_utils", "config", "conf_vars", "airflow", "executors", "kubernetes_executor", "POD_EXECUTOR_DONE_KEY", "AirflowKubernetesScheduler", "KubernetesExecutor", "KubernetesJobWatcher", "ResourceVersion", "create_pod_id", "get_base_pod_from_template", "airflow", "kubernetes", "pod_generator", "airflow", "kubernetes", "kubernetes_helper_functions", "annotations_for_logging_task_metadata", "annotations_to_key", "get_logs_task_metadata", "airflow", "kubernetes", "pod_generator", "PodGenerator"], "mod_var_ln": {"AirflowKubernetesScheduler": [[60, 4], [60, 30]]}, "mod_var_occur": {"AirflowKubernetesScheduler": []}, "no_types_annot": {"D": 1, "I": 0, "U": 379}, "session_id": "jXSL1KyBfD9eV_0VnREs84f3_gjVYYN5la-oYDHuM8Y", "set": null, "tc": [false, null], "type_annot_cove": 0.0, "typed_seq": "", "untyped_seq": "", "variables": {"AirflowKubernetesScheduler": ""}, "variables_p": {"AirflowKubernetesScheduler": [["str", 0.4], ["List[str]", 0.1], ["int", 0.1], ["raiden.utils.WithdrawAmount", 0.1], ["Dict[str, List[Any]]", 0.1], ["Tuple[str, str, str, str, str, str, str, str]", 0.1]]}}}