{"error": null, "response": {"classes": [{"cls_lc": [[46, 0], [258, 95]], "cls_var_ln": {}, "cls_var_occur": {}, "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[49, 4], [88, 68]], "fn_var_ln": {"conn": [[73, 8], [73, 17]], "dag": [[60, 8], [60, 16]], "dag_run": [[62, 8], [62, 15]], "date": [[59, 8], [59, 12]], "local_log_location": [[53, 8], [53, 31]], "remote_log_base": [[50, 8], [50, 28]], "remote_log_key": [[52, 8], [52, 27]], "remote_log_location": [[51, 8], [51, 32]], "s3_task_handler": [[55, 8], [55, 28]], "task": [[61, 8], [61, 12]], "ti": [[68, 8], [68, 15]]}, "fn_var_occur": {"conn": [["self", "conn", "boto3", "client"], ["self", "conn", "create_bucket", "Bucket"]], "dag": [["self", "dag", "DAG", "start_date", "date"], ["task", "EmptyOperator", "task_id", "dag", "self", "dag"], ["dag_run", "DagRun", "dag_id", "self", "dag", "dag_id", "execution_date", "date", "run_id", "run_type"], ["self", "dag", "clear"]], "dag_run": [["dag_run", "DagRun", "dag_id", "self", "dag", "dag_id", "execution_date", "date", "run_id", "run_type"], ["session", "add", "dag_run"], ["session", "refresh", "dag_run"], ["self", "ti", "TaskInstance", "task", "task", "run_id", "dag_run", "run_id"], ["self", "ti", "dag_run", "dag_run"]], "date": [["date", "datetime"], ["self", "dag", "DAG", "start_date", "date"], ["dag_run", "DagRun", "dag_id", "self", "dag", "dag_id", "execution_date", "date", "run_id", "run_type"]], "local_log_location": [["self", "local_log_location", "str", "tmp_path_factory", "mktemp"], ["self", "s3_task_handler", "S3TaskHandler", "self", "local_log_location", "self", "remote_log_base"]], "remote_log_base": [["self", "remote_log_base"], ["self", "s3_task_handler", "S3TaskHandler", "self", "local_log_location", "self", "remote_log_base"]], "remote_log_key": [["self", "remote_log_key"]], "remote_log_location": [["self", "remote_log_location"]], "s3_task_handler": [["self", "s3_task_handler", "S3TaskHandler", "self", "local_log_location", "self", "remote_log_base"], ["self", "s3_task_handler", "hook", "None"], ["self", "s3_task_handler", "handler"], ["os", "remove", "self", "s3_task_handler", "handler", "baseFilename"]], "task": [["task", "EmptyOperator", "task_id", "dag", "self", "dag"], ["self", "ti", "TaskInstance", "task", "task", "run_id", "dag_run", "run_id"]], "ti": [["self", "ti", "TaskInstance", "task", "task", "run_id", "dag_run", "run_id"], ["self", "ti", "dag_run", "dag_run"], ["self", "ti", "try_number"], ["self", "ti", "state", "State", "RUNNING"]]}, "name": "setup_tests", "params": {"create_log_template": "", "self": "", "tmp_path_factory": ""}, "params_descr": {"create_log_template": "", "self": "", "tmp_path_factory": ""}, "params_occur": {"create_log_template": [], "self": [["self", "remote_log_base"], ["self", "remote_log_location"], ["self", "remote_log_key"], ["self", "local_log_location", "str", "tmp_path_factory", "mktemp"], ["self", "s3_task_handler", "S3TaskHandler", "self", "local_log_location", "self", "remote_log_base"], ["self", "s3_task_handler", "hook", "None"], ["self", "dag", "DAG", "start_date", "date"], ["task", "EmptyOperator", "task_id", "dag", "self", "dag"], ["dag_run", "DagRun", "dag_id", "self", "dag", "dag_id", "execution_date", "date", "run_id", "run_type"], ["self", "ti", "TaskInstance", "task", "task", "run_id", "dag_run", "run_id"], ["self", "ti", "dag_run", "dag_run"], ["self", "ti", "try_number"], ["self", "ti", "state", "State", "RUNNING"], ["self", "conn", "boto3", "client"], ["self", "conn", "create_bucket", "Bucket"], ["self", "dag", "clear"], ["self", "s3_task_handler", "handler"], ["os", "remove", "self", "s3_task_handler", "handler", "baseFilename"]], "tmp_path_factory": [["self", "local_log_location", "str", "tmp_path_factory", "mktemp"]]}, "params_p": {"args": [], "create_log_template": [["str", 0.5549999124785047], ["bool", 0.09678252265004166], ["List[str]", 0.08001984721336065], ["Optional[Tuple[str, ...]]", 0.07766051478097982], ["bytes", 0.07549451331881774]], "kwargs": [], "self": [], "tmp_path_factory": [["str", 0.798258780736598], ["List[str]", 0.201741219263402]]}, "q_name": "TestS3TaskHandler.setup_tests", "ret_exprs": [], "ret_type": "", "variables": {"conn": "", "dag": "", "dag_run": "", "date": "", "local_log_location": "", "remote_log_base": "", "remote_log_key": "", "remote_log_location": "", "s3_task_handler": "", "task": "", "ti": ""}, "variables_p": {"conn": [["int", 0.8146775515717566], ["str", 0.0960422049697901]], "dag": [["int", 0.43336653706739314], ["float", 0.09281147840516152], ["List[int]", 0.0916062251960066], ["tests.factories.model.TaskPayment", 0.09128266277990112]], "dag_run": [["magic.models.card.Card", 0.10966201852283676], ["Dict[str, dict]", 0.09876380795059767]], "date": [["datetime.datetime", 0.7462474464970265], ["datetime.datetime.timedelta", 0.1731578064261678], ["datetime.datetime.datetime", 0.08059474707680588]], "local_log_location": [["RuntimeError", 0.2703273004380602], ["Dict[str, Union[int, str]]", 0.13282895701123054], ["Dict[str, List[Any]]", 0.11070161307910173], ["os.stat_result", 0.10737327699915916], ["dict", 0.09893108557969696], ["Dict[str, Union[Any, Any]]", 0.09707706115342017], ["List[Dict[str, str]]", 0.09044493692566441]], "remote_log_base": [["int", 0.25751344384605446], ["str", 0.1884136248451425], ["Dict[int, str]", 0.14713126263124768], ["float", 0.14658786369094975], ["List[str]", 0.09128548293461114], ["dict", 0.08855878621324131], ["Dict[Any, str]", 0.0805095358387531]], "remote_log_key": [["str", 0.18057496538211526], ["int", 0.10485216029234666], ["Union[str, int]", 0.09434187667211921]], "remote_log_location": [["int", 0.38440615525652544], ["bool", 0.30198830044738745]], "s3_task_handler": [["int", 0.39947569223108936], ["str", 0.22141011408260688], ["List[str]", 0.09440691935001796]], "task": [["Dict[str, Dict[str, int]]", 0.08264687264782108]], "ti": [["int", 0.3730574849468627], ["List[str]", 0.3298147029485696], ["Dict[Any, str]", 0.07839207421902476]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[90, 4], [92, 77]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_hook", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["isinstance", "self", "s3_task_handler", "hook", "S3Hook"], ["self", "s3_task_handler", "hook", "transfer_config", "use_threads", "False"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_hook", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[94, 4], [96, 75]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_log_exists", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "conn", "put_object", "Bucket", "Key", "self", "remote_log_key", "Body"], ["self", "s3_task_handler", "s3_log_exists", "self", "remote_log_location"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_log_exists", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[98, 4], [99, 79]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_log_exists_none", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "s3_task_handler", "s3_log_exists", "self", "remote_log_location"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_log_exists_none", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[101, 4], [102, 83]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_log_exists_raises", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "s3_task_handler", "s3_log_exists"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_log_exists_raises", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[104, 4], [108, 76]], "fn_var_ln": {"side_effect": [[106, 12], [106, 33]]}, "fn_var_occur": {"side_effect": [["mock_hook", "side_effect", "Exception"]]}, "name": "test_log_exists_no_hook", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "s3_task_handler", "s3_log_exists", "self", "remote_log_location"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_log_exists_no_hook", "ret_exprs": [], "ret_type": "", "variables": {"side_effect": ""}, "variables_p": {"side_effect": [["str", 0.46146968833119484], ["List[Dict[str, float]]", 0.10543346334745063], ["Dict[str, Dict[str, str]]", 0.0831681400737581]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[110, 4], [117, 37]], "fn_var_ln": {"mock_open": [[112, 8], [112, 17]]}, "fn_var_occur": {"mock_open": [["mock_open", "mock", "mock_open"], ["mock", "patch", "mock_open"], ["mock_open", "assert_not_called"]]}, "name": "test_set_context_raw", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "ti", "raw", "True"], ["self", "s3_task_handler", "set_context", "self", "ti"], ["self", "s3_task_handler", "upload_on_close"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_set_context_raw", "ret_exprs": [], "ret_type": "", "variables": {"mock_open": ""}, "variables_p": {"mock_open": [["tests.utils.MockCoroutine", 0.0923184548041816]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[119, 4], [126, 45]], "fn_var_ln": {"mock_open": [[120, 8], [120, 17]]}, "fn_var_occur": {"mock_open": [["mock_open", "mock", "mock_open"], ["mock", "patch", "mock_open"], ["mock_open", "assert_called_once_with", "os", "path", "join", "self", "local_log_location"], ["mock_open", "write", "assert_not_called"]]}, "name": "test_set_context_not_raw", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "s3_task_handler", "set_context", "self", "ti"], ["self", "s3_task_handler", "upload_on_close"], ["mock_open", "assert_called_once_with", "os", "path", "join", "self", "local_log_location"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_set_context_not_raw", "ret_exprs": [], "ret_type": "", "variables": {"mock_open": ""}, "variables_p": {"mock_open": [["tests.utils.MockCoroutine", 0.1059867904884585], ["List[int]", 0.0958309717079926], ["Dict[str, int]", 0.09202246751022204], ["Dict[str, Union[int, str]]", 0.08894403030258119]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[128, 4], [136, 63]], "fn_var_ln": {"actual": [[133, 8], [133, 14]], "expected": [[134, 8], [134, 16]], "log": [[132, 8], [132, 11]], "metadata": [[132, 13], [132, 21]], "state": [[131, 8], [131, 16]], "ti": [[130, 8], [130, 10]]}, "fn_var_occur": {"actual": [["actual", "log"], ["actual", "expected"]], "expected": [["actual", "expected"]], "log": [["log", "metadata", "self", "s3_task_handler", "read", "ti"], ["actual", "log"]], "metadata": [["log", "metadata", "self", "s3_task_handler", "read", "ti"], ["metadata", "True"]], "state": [["ti", "state", "TaskInstanceState", "SUCCESS"]], "ti": [["ti", "copy", "copy", "self", "ti"], ["ti", "state", "TaskInstanceState", "SUCCESS"], ["log", "metadata", "self", "s3_task_handler", "read", "ti"]]}, "name": "test_read", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "conn", "put_object", "Bucket", "Key", "self", "remote_log_key", "Body"], ["ti", "copy", "copy", "self", "ti"], ["log", "metadata", "self", "s3_task_handler", "read", "ti"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_read", "ret_exprs": [], "ret_type": "", "variables": {"actual": "", "expected": "", "log": "", "metadata": "", "state": "", "ti": ""}, "variables_p": {"actual": [["str", 0.7499999999847125], ["int", 0.2500000000030807], ["Optional[str]", 7.946011074674636e-12]], "expected": [["str", 0.4], ["Dict[int, List[Any]]", 0.1], ["List[Union[int, str]]", 0.1], ["List[str]", 0.1]], "log": [], "metadata": [["int", 0.45928394936699013], ["datetime.timedelta", 0.19494997359851135], ["dict", 0.15488014514291665], ["str", 0.11165014301660708], ["List[str]", 0.07923578887497475]], "state": [["grpy.core.models.GroupingState", 0.2929065693635843], ["alerta.models.user.User", 0.18660478735256608], ["Dict[str, str]", 0.1019191404207408]], "ti": [["list", 0.31788904882373636], ["int", 0.12193034619705642], ["str", 0.10346197226861918], ["Any[Any]", 0.10166719134905788], ["set", 0.08532880512579058], ["List[int]", 0.08477296085861911]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[138, 4], [148, 64]], "fn_var_ln": {"actual": [[145, 8], [145, 14]], "expected": [[146, 8], [146, 16]], "log": [[142, 8], [142, 11]], "metadata": [[142, 13], [142, 21]], "state": [[140, 8], [140, 16]], "ti": [[139, 8], [139, 10]]}, "fn_var_occur": {"actual": [["actual", "log"], ["actual", "expected"]], "expected": [["actual", "expected"]], "log": [["log", "metadata", "self", "s3_task_handler", "read", "ti"], ["len", "log"], ["len", "log", "len", "metadata"], ["actual", "log"]], "metadata": [["log", "metadata", "self", "s3_task_handler", "read", "ti"], ["len", "log", "len", "metadata"], ["True", "metadata"]], "state": [["ti", "state", "TaskInstanceState", "SUCCESS"]], "ti": [["ti", "copy", "copy", "self", "ti"], ["ti", "state", "TaskInstanceState", "SUCCESS"], ["log", "metadata", "self", "s3_task_handler", "read", "ti"]]}, "name": "test_read_when_s3_log_missing", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["ti", "copy", "copy", "self", "ti"], ["self", "s3_task_handler", "_read_from_logs_server", "mock", "Mock", "return_value"], ["log", "metadata", "self", "s3_task_handler", "read", "ti"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_read_when_s3_log_missing", "ret_exprs": [], "ret_type": "", "variables": {"actual": "", "expected": "", "log": "", "metadata": "", "state": "", "ti": ""}, "variables_p": {"actual": [["str", 0.7499999999847125], ["int", 0.2500000000030807], ["Optional[str]", 7.946011074674636e-12]], "expected": [["str", 0.4], ["Dict[int, List[Any]]", 0.1], ["List[Union[int, str]]", 0.1], ["List[str]", 0.1]], "log": [], "metadata": [["int", 0.3850622435207297], ["str", 0.10100211339694397], ["dict", 0.09900975696172677], ["bool", 0.08827475020298943]], "state": [["grpy.core.models.GroupingState", 0.2929065693635843], ["alerta.models.user.User", 0.18660478735256608], ["Dict[str, str]", 0.1019191404207408]], "ti": [["list", 0.31788904882373636], ["int", 0.12193034619705642], ["str", 0.10346197226861918], ["Any[Any]", 0.10166719134905788], ["set", 0.08532880512579058], ["List[int]", 0.08477296085861911]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[150, 4], [157, 72]], "fn_var_ln": {"log": [[155, 12], [155, 15]], "metadata": [[155, 17], [155, 25]], "state": [[152, 8], [152, 16]], "ti": [[151, 8], [151, 10]]}, "fn_var_occur": {"log": [["log", "metadata", "self", "s3_task_handler", "read", "ti"], ["len", "log"], ["log", "startswith"]], "metadata": [["log", "metadata", "self", "s3_task_handler", "read", "ti"]], "state": [["ti", "state", "TaskInstanceState", "SUCCESS"]], "ti": [["ti", "copy", "copy", "self", "ti"], ["ti", "state", "TaskInstanceState", "SUCCESS"], ["log", "metadata", "self", "s3_task_handler", "read", "ti"]]}, "name": "test_read_when_s3_log_missing_and_log_pos_missing_pre_26", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["ti", "copy", "copy", "self", "ti"], ["log", "metadata", "self", "s3_task_handler", "read", "ti"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_read_when_s3_log_missing_and_log_pos_missing_pre_26", "ret_exprs": [], "ret_type": "", "variables": {"log": "", "metadata": "", "state": "", "ti": ""}, "variables_p": {"log": [], "metadata": [["int", 0.6885983419515694], ["float", 0.11083442778656366], ["dict", 0.10817446588840952], ["Dict[str, List[str]]", 0.09239276437345731]], "state": [["grpy.core.models.GroupingState", 0.2929065693635843], ["alerta.models.user.User", 0.18660478735256608], ["Dict[str, str]", 0.1019191404207408]], "ti": [["list", 0.31788904882373636], ["int", 0.12193034619705642], ["str", 0.10346197226861918], ["Any[Any]", 0.10166719134905788], ["set", 0.08532880512579058], ["List[int]", 0.08477296085861911]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[159, 4], [166, 72]], "fn_var_ln": {"log": [[164, 12], [164, 15]], "metadata": [[164, 17], [164, 25]], "state": [[161, 8], [161, 16]], "ti": [[160, 8], [160, 10]]}, "fn_var_occur": {"log": [["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"], ["len", "log"], ["log", "startswith"]], "metadata": [["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"]], "state": [["ti", "state", "TaskInstanceState", "SUCCESS"]], "ti": [["ti", "copy", "copy", "self", "ti"], ["ti", "state", "TaskInstanceState", "SUCCESS"], ["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"]]}, "name": "test_read_when_s3_log_missing_and_log_pos_zero_pre_26", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["ti", "copy", "copy", "self", "ti"], ["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_read_when_s3_log_missing_and_log_pos_zero_pre_26", "ret_exprs": [], "ret_type": "", "variables": {"log": "", "metadata": "", "state": "", "ti": ""}, "variables_p": {"log": [], "metadata": [["int", 0.6885983419515694], ["float", 0.11083442778656366], ["dict", 0.10817446588840952], ["Dict[str, List[str]]", 0.09239276437345731]], "state": [["grpy.core.models.GroupingState", 0.2929065693635843], ["alerta.models.user.User", 0.18660478735256608], ["Dict[str, str]", 0.1019191404207408]], "ti": [["list", 0.31788904882373636], ["int", 0.12193034619705642], ["str", 0.10346197226861918], ["Any[Any]", 0.10166719134905788], ["set", 0.08532880512579058], ["List[int]", 0.08477296085861911]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[168, 4], [175, 76]], "fn_var_ln": {"log": [[173, 12], [173, 15]], "metadata": [[173, 17], [173, 25]], "state": [[170, 8], [170, 16]], "ti": [[169, 8], [169, 10]]}, "fn_var_occur": {"log": [["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"], ["len", "log"], ["log", "startswith"]], "metadata": [["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"]], "state": [["ti", "state", "TaskInstanceState", "SUCCESS"]], "ti": [["ti", "copy", "copy", "self", "ti"], ["ti", "state", "TaskInstanceState", "SUCCESS"], ["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"]]}, "name": "test_read_when_s3_log_missing_and_log_pos_over_zero_pre_26", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["ti", "copy", "copy", "self", "ti"], ["log", "metadata", "self", "s3_task_handler", "read", "ti", "metadata"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_read_when_s3_log_missing_and_log_pos_over_zero_pre_26", "ret_exprs": [], "ret_type": "", "variables": {"log": "", "metadata": "", "state": "", "ti": ""}, "variables_p": {"log": [], "metadata": [["int", 0.6885983419515694], ["float", 0.11083442778656366], ["dict", 0.10817446588840952], ["Dict[str, List[str]]", 0.09239276437345731]], "state": [["grpy.core.models.GroupingState", 0.2929065693635843], ["alerta.models.user.User", 0.18660478735256608], ["Dict[str, str]", 0.1019191404207408]], "ti": [["list", 0.31788904882373636], ["int", 0.12193034619705642], ["str", 0.10346197226861918], ["Any[Any]", 0.10166719134905788], ["set", 0.08532880512579058], ["List[int]", 0.08477296085861911]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[177, 4], [187, 66]], "fn_var_ln": {"handler": [[178, 8], [178, 15]], "msg": [[182, 12], [182, 15]], "result": [[181, 12], [181, 18]], "url": [[179, 8], [179, 11]]}, "fn_var_occur": {"handler": [["handler", "self", "s3_task_handler"], ["mock", "patch", "object", "handler", "log", "mock_error"], ["result", "handler", "s3_read", "url", "return_error", "True"]], "msg": [["msg", "url"], ["result", "msg"], ["mock_error", "assert_called_once_with", "msg", "exc_info", "True"]], "result": [["result", "handler", "s3_read", "url", "return_error", "True"], ["result", "msg"]], "url": [["result", "handler", "s3_read", "url", "return_error", "True"], ["msg", "url"]]}, "name": "test_s3_read_when_log_missing", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["handler", "self", "s3_task_handler"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_s3_read_when_log_missing", "ret_exprs": [], "ret_type": "", "variables": {"handler": "", "msg": "", "result": "", "url": ""}, "variables_p": {"handler": [["guillotina.tests.mocks.MockTransactionManager", 0.30537626807826207], ["str", 0.1032957332727266], ["python3.tests.lib.test_line.MockFile", 0.0972185684913887], ["kippo.tasks.tests.test_task_functions.IssueMock", 0.0958989133657918], ["libsoundtouch.tests.test_libsoundtouch.MockDevice", 0.08862310860265073]], "msg": [["str", 0.47461407569489944], ["Dict[str, Dict[str, Any]]", 0.3425675587350388], ["List[str]", 0.09527436997244051], ["Dict[str, str]", 0.0875439955976212]], "result": [["Dict[str, Dict[str, Any]]", 0.11104907565758207], ["list", 0.10541931067262172], ["str", 0.10536266867577478], ["dict", 0.09608552866762606], ["Dict[str, Any]", 0.09472521816501087]], "url": [["str", 0.3063562102165828], ["dict", 0.10954256246683196], ["List[Dict[str, Any]]", 0.09189275658323269]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[189, 4], [199, 66]], "fn_var_ln": {"handler": [[190, 8], [190, 15]], "msg": [[194, 12], [194, 15]], "result": [[193, 12], [193, 18]], "url": [[191, 8], [191, 11]]}, "fn_var_occur": {"handler": [["handler", "self", "s3_task_handler"], ["mock", "patch", "object", "handler", "log", "mock_error"], ["result", "handler", "s3_read", "url", "return_error", "True"]], "msg": [["msg", "url"], ["result", "msg"], ["mock_error", "assert_called_once_with", "msg", "exc_info", "True"]], "result": [["result", "handler", "s3_read", "url", "return_error", "True"], ["result", "msg"]], "url": [["result", "handler", "s3_read", "url", "return_error", "True"], ["msg", "url"]]}, "name": "test_read_raises_return_error", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["handler", "self", "s3_task_handler"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_read_raises_return_error", "ret_exprs": [], "ret_type": "", "variables": {"handler": "", "msg": "", "result": "", "url": ""}, "variables_p": {"handler": [["guillotina.tests.mocks.MockTransactionManager", 0.30537626807826207], ["str", 0.1032957332727266], ["python3.tests.lib.test_line.MockFile", 0.0972185684913887], ["kippo.tasks.tests.test_task_functions.IssueMock", 0.0958989133657918], ["libsoundtouch.tests.test_libsoundtouch.MockDevice", 0.08862310860265073]], "msg": [["str", 0.47461407569489944], ["Dict[str, Dict[str, Any]]", 0.3425675587350388], ["List[str]", 0.09527436997244051], ["Dict[str, str]", 0.0875439955976212]], "result": [["Dict[str, Dict[str, Any]]", 0.11104907565758207], ["list", 0.10541931067262172], ["str", 0.10536266867577478], ["dict", 0.09608552866762606], ["Dict[str, Any]", 0.09472521816501087]], "url": [["str", 0.3063562102165828], ["dict", 0.10954256246683196], ["List[Dict[str, Any]]", 0.09189275658323269]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[201, 4], [208, 30]], "fn_var_ln": {"body": [[206, 8], [206, 12]]}, "fn_var_occur": {"body": [["body", "boto3", "resource", "Object", "self", "remote_log_key", "get", "read"]]}, "name": "test_write", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["mock", "patch", "object", "self", "s3_task_handler", "log", "mock_error"], ["self", "s3_task_handler", "s3_write", "self", "remote_log_location"], ["body", "boto3", "resource", "Object", "self", "remote_log_key", "get", "read"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_write", "ret_exprs": [], "ret_type": "", "variables": {"body": ""}, "variables_p": {"body": [["dict", 0.43895805377395286], ["str", 0.285384728539267], ["telegram.utils.AsyncResult", 0.09274732507766816], ["List[Dict[str, str]]", 0.09078382802928847]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[210, 4], [215, 41]], "fn_var_ln": {"body": [[213, 8], [213, 12]]}, "fn_var_occur": {"body": [["body", "boto3", "resource", "Object", "self", "remote_log_key", "get", "read"]]}, "name": "test_write_existing", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "conn", "put_object", "Bucket", "Key", "self", "remote_log_key", "Body"], ["self", "s3_task_handler", "s3_write", "self", "remote_log_location"], ["body", "boto3", "resource", "Object", "self", "remote_log_key", "get", "read"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_write_existing", "ret_exprs": [], "ret_type": "", "variables": {"body": ""}, "variables_p": {"body": [["dict", 0.43895805377395286], ["str", 0.285384728539267], ["telegram.utils.AsyncResult", 0.09274732507766816], ["List[Dict[str, str]]", 0.09078382802928847]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[217, 4], [222, 96]], "fn_var_ln": {"handler": [[218, 8], [218, 15]], "url": [[219, 8], [219, 11]]}, "fn_var_occur": {"handler": [["handler", "self", "s3_task_handler"], ["mock", "patch", "object", "handler", "log", "mock_error"], ["handler", "s3_write", "url"]], "url": [["handler", "s3_write", "url"], ["mock_error", "assert_called_once_with", "url", "exc_info", "True"]]}, "name": "test_write_raises", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["handler", "self", "s3_task_handler"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_write_raises", "ret_exprs": [], "ret_type": "", "variables": {"handler": "", "url": ""}, "variables_p": {"handler": [["str", 0.2033195363184164], ["app.providers.Provider", 0.1115705922216111], ["Dict[str, Union[int, str]]", 0.09891733883733979], ["List[str]", 0.09132947098087982], ["guillotina.tests.mocks.MockTransactionManager", 0.08948183600201992]], "url": [["str", 0.8720993184798947], ["Optional[str]", 0.12790068152010525]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[224, 4], [230, 72]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_close", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "s3_task_handler", "set_context", "self", "ti"], ["self", "s3_task_handler", "upload_on_close"], ["self", "s3_task_handler", "close"], ["boto3", "resource", "Object", "self", "remote_log_key", "get"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_close", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[232, 4], [239, 76]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "test_close_no_upload", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "ti", "raw", "True"], ["self", "s3_task_handler", "set_context", "self", "ti"], ["self", "s3_task_handler", "upload_on_close"], ["self", "s3_task_handler", "close"], ["boto3", "resource", "Object", "self", "remote_log_key", "get"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_close_no_upload", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[245, 4], [258, 95]], "fn_var_ln": {"handler": [[251, 12], [251, 19]]}, "fn_var_occur": {"handler": [["handler", "S3TaskHandler", "self", "local_log_location", "self", "remote_log_base"], ["handler", "log", "info"], ["handler", "set_context", "self", "ti"], ["handler", "upload_on_close"], ["handler", "close"], ["os", "path", "exists", "handler", "handler", "baseFilename", "expected_existence_of_local_copy"]]}, "name": "test_close_with_delete_local_logs_conf", "params": {"airflow_version": "", "delete_local_copy": "", "expected_existence_of_local_copy": "", "self": ""}, "params_descr": {"airflow_version": "", "delete_local_copy": "", "expected_existence_of_local_copy": "", "self": ""}, "params_occur": {"airflow_version": [], "delete_local_copy": [["conf_vars", "str", "delete_local_copy"]], "expected_existence_of_local_copy": [["os", "path", "exists", "handler", "handler", "baseFilename", "expected_existence_of_local_copy"]], "self": [["handler", "S3TaskHandler", "self", "local_log_location", "self", "remote_log_base"], ["handler", "set_context", "self", "ti"]]}, "params_p": {"airflow_version": [], "args": [], "delete_local_copy": [["int", 0.4799348182402944], ["str", 0.31480402554866194], ["Optional[int]", 0.11267056525045391], ["BinaryIO", 0.0925905909605898]], "expected_existence_of_local_copy": [["str", 0.6910847594921675], ["Optional[bool]", 0.11449399261634109]], "kwargs": [], "self": []}, "q_name": "TestS3TaskHandler.test_close_with_delete_local_logs_conf", "ret_exprs": [], "ret_type": "", "variables": {"handler": ""}, "variables_p": {"handler": [["str", 0.25426872013212953], ["int", 0.2143670534956983], ["datetime.timedelta", 0.09630363831070556], ["datetime.datetime.datetime", 0.07768897247721211]]}}], "name": "TestS3TaskHandler", "q_name": "TestS3TaskHandler", "variables": {}, "variables_p": {}}], "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[41, 0], [43, 13]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "s3mock", "params": {}, "params_descr": {}, "params_occur": {}, "params_p": {"args": [], "kwargs": []}, "q_name": "s3mock", "ret_exprs": [], "ret_type": "", "variables": {}, "variables_p": {}}], "imports": ["__future__", "annotations", "contextlib", "copy", "os", "unittest", "mock", "boto3", "moto", "pytest", "botocore", "exceptions", "ClientError", "airflow", "models", "DAG", "DagRun", "TaskInstance", "airflow", "operators", "empty", "EmptyOperator", "airflow", "providers", "amazon", "aws", "hooks", "s3", "S3Hook", "airflow", "providers", "amazon", "aws", "log", "s3_task_handler", "S3TaskHandler", "airflow", "utils", "session", "create_session", "airflow", "utils", "state", "State", "TaskInstanceState", "airflow", "utils", "timezone", "datetime", "tests", "test_utils", "config", "conf_vars"], "mod_var_ln": {}, "mod_var_occur": {}, "no_types_annot": {"D": 0, "I": 0, "U": 78}, "session_id": "KkUAENy1eF8y8ZnnjuNwNr7u_mREtlSA1yzIpjVK7XE", "set": null, "tc": [false, null], "type_annot_cove": 0.0, "typed_seq": "", "untyped_seq": "", "variables": {}, "variables_p": {}}}