{"error": null, "response": {"classes": [{"cls_lc": [[29, 0], [31, 28]], "cls_var_ln": {"argument": [[30, 4], [30, 12]], "default": [[31, 4], [31, 11]]}, "cls_var_occur": {"argument": [], "default": []}, "funcs": [], "name": "_SessionArgument", "q_name": "_SessionArgument", "variables": {"argument": "ast.arg", "default": "ast.expr | None"}, "variables_p": {"argument": [["str", 0.4], ["List[str]", 0.1], ["int", 0.1], ["Dict[str, List[Any]]", 0.1], ["Tuple[str, str, str, str, str, str, str, str]", 0.1]], "default": [["str", 0.4], ["int", 0.30000000000000004], ["List[Tuple[str, int]]", 0.1]]}}, {"cls_lc": [[46, 0], [48, 31]], "cls_var_ln": {"new_session": [[48, 4], [48, 15]], "none": [[47, 4], [47, 8]]}, "cls_var_occur": {"new_session": [], "none": []}, "funcs": [], "name": "_SessionDefault", "q_name": "_SessionDefault", "variables": {"new_session": "", "none": ""}, "variables_p": {"new_session": [["Dict[int, Set[str]]", 0.7971178403386939], ["int", 0.1038911786919065], ["Dict[str, Any]", 0.09899098096939941]], "none": [["str", 0.7], ["int", 0.3]]}}], "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[34, 0], [43, 15]], "fn_var_ln": {"arguments": [[35, 4], [35, 13]], "defaults": [[36, 4], [36, 12]]}, "fn_var_occur": {"arguments": [["arguments", "reversed", "args", "args", "args", "kwonlyargs"], ["itertools", "zip_longest", "arguments", "defaults", "fillvalue", "None"]], "defaults": [["defaults", "reversed", "args", "defaults", "args", "kw_defaults"], ["itertools", "zip_longest", "arguments", "defaults", "fillvalue", "None"]]}, "name": "_get_session_arg_and_default", "params": {"args": "ast.arguments"}, "params_descr": {"args": ""}, "params_occur": {"args": [["arguments", "reversed", "args", "args", "args", "kwonlyargs"], ["defaults", "reversed", "args", "defaults", "args", "kw_defaults"]]}, "params_p": {"args": [], "kwargs": []}, "q_name": "_get_session_arg_and_default", "ret_exprs": ["return _SessionArgument(argument, default)", "return None"], "ret_type": "_SessionArgument | None", "ret_type_p": [["str", 0.32048752660050545], ["bool", 0.20431732268969438], ["Dict[str, Any]", 0.09711823006430814], ["Dict[str, Dict[str, Any]]", 0.08955576397870782]], "variables": {"arguments": "", "defaults": ""}, "variables_p": {"arguments": [["str", 0.1947566419771437], ["List[None]", 0.10909702309225544], ["Union[Literal, Literal]", 0.09301200044212608], ["int", 0.08973919196540855], ["Set[str]", 0.08735485435667277]], "defaults": [["int", 0.35657542024624955], ["str", 0.2923188675153114], ["list", 0.10430714269350799], ["float", 0.08177330832560545], ["Pattern[str]", 0.08171394540197172]]}}, {"docstring": {"func": "Whether an expression is NEW_SESSION.", "long_descr": "Old code written before the introduction of NEW_SESSION (and even some new\nif the contributor wasn't made aware of the addition) generally uses None\nas the default value, so we add that to the check as well.", "ret": null}, "fn_lc": [[51, 0], [64, 15]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "_is_new_session_or_none", "params": {"value": "ast.expr"}, "params_descr": {"value": ""}, "params_occur": {"value": [["isinstance", "value", "ast", "Constant", "value", "value", "None"], ["isinstance", "value", "ast", "Name", "value", "id"]]}, "params_p": {"args": [], "kwargs": [], "value": [["float", 0.2952376723160671], ["Optional[str]", 0.07996862726619046], ["Optional[int]", 0.07287191271960793], ["str", 0.06750776080872672]]}, "q_name": "_is_new_session_or_none", "ret_exprs": ["return _SessionDefault.none", "return _SessionDefault.new_session", "return None"], "ret_type": "_SessionDefault | None", "ret_type_p": [["dict", 0.30187873126268433], ["Dict[str, Any]", 0.20264041853305115], ["Iterable[str]", 0.0967760168206539]], "variables": {}, "variables_p": {}}, {"docstring": {"func": "Whether expected decorators are provided.", "long_descr": "Three decorators would allow NEW_SESSION usages:\n\n* ``@provide_session``: The canonical case.\n* ``@overload``: A typing overload and not something to actually execute.\n* ``@abstractmethod``: This will be overridden in a subclass anyway.", "ret": null}, "fn_lc": [[70, 0], [80, 100]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "_is_decorated_correctly", "params": {"nodes": "builtins.list[ast.expr]"}, "params_descr": {"nodes": ""}, "params_occur": {"nodes": [["any", "isinstance", "node", "ast", "Name", "node", "id", "_ALLOWED_DECORATOR_NAMES", "node", "nodes"]]}, "params_p": {"args": [], "kwargs": [], "nodes": [["int", 0.09576085732549422]]}, "q_name": "_is_decorated_correctly", "ret_exprs": ["return any(isinstance(node, ast.Name) and node.id in _ALLOWED_DECORATOR_NAMES for node in nodes)"], "ret_type": "builtins.bool", "ret_type_p": [["bool", 0.08095405119046198]], "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[83, 0], [90, 16]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "_annotation_has_none", "params": {"value": "ast.expr | None"}, "params_descr": {"value": ""}, "params_occur": {"value": [["value", "None"], ["isinstance", "value", "ast", "Constant", "value", "value", "None"], ["isinstance", "value", "ast", "BinOp", "isinstance", "value", "op", "ast", "BitOr"], ["_annotation_has_none", "value", "left", "_annotation_has_none", "value", "right"]]}, "params_p": {"args": [], "kwargs": [], "value": [["T", 0.19991669550320953], ["Optional[object]", 0.1411501597789447], ["float", 0.08861449612713107], ["Union[type, Tuple[type, ...]]", 0.06648612605437453], ["Optional[Any]", 0.062387782192562385], ["Hashable", 0.061640837393542626]]}, "q_name": "_annotation_has_none", "ret_exprs": ["return False", "return True", "return _annotation_has_none(value.left) or _annotation_has_none(value.right)", "return False"], "ret_type": "builtins.bool", "ret_type_p": [["bool", 1.0]], "variables": {}, "variables_p": {}}, {"docstring": {"func": "Check NEW_SESSION usages outside functions decorated with provide_session.", "long_descr": null, "ret": null}, "fn_lc": [[93, 0], [108, 18]], "fn_var_ln": {"default_kind": [[103, 8], [103, 20]], "session": [[98, 8], [98, 15]]}, "fn_var_occur": {"default_kind": [["default_kind", "_is_new_session_or_none", "session", "default"], ["default_kind", "None"], ["default_kind", "_SessionDefault", "none", "_annotation_has_none", "session", "argument", "annotation"]], "session": [["session", "_get_session_arg_and_default", "node", "args"], ["session", "None", "session", "default", "None"], ["default_kind", "_is_new_session_or_none", "session", "default"], ["default_kind", "_SessionDefault", "none", "_annotation_has_none", "session", "argument", "annotation"]]}, "name": "_iter_incorrect_new_session_usages", "params": {"path": "pathlib.Path"}, "params_descr": {"path": ""}, "params_occur": {"path": [["ast", "walk", "ast", "parse", "path", "read_text", "str", "path"]]}, "params_p": {"args": [], "kwargs": [], "path": [["pathlib.Path", 0.6088072768522574], ["str", 0.09654825654843359], ["bool", 0.08109069750503785]]}, "q_name": "_iter_incorrect_new_session_usages", "ret_exprs": [], "ret_type": "typing.Iterator[ast.FunctionDef]", "variables": {"default_kind": "", "session": ""}, "variables_p": {"default_kind": [["int", 0.18274194183722797], ["bool", 0.09512166355792599], ["dict", 0.08852149458307436], ["Optional[str]", 0.08747110168862253], ["Optional[int]", 0.08737743820134451]], "session": []}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[111, 0], [121, 22]], "fn_var_ln": {"errors": [[113, 4], [113, 10]], "paths": [[112, 4], [112, 9]]}, "fn_var_occur": {"errors": [["errors", "path", "error", "path", "paths", "error", "_iter_incorrect_new_session_usages", "path"], ["len", "errors"]], "paths": [["paths", "pathlib", "Path", "filename", "filename", "argv"], ["errors", "path", "error", "path", "paths", "error", "_iter_incorrect_new_session_usages", "path"]]}, "name": "main", "params": {"argv": "builtins.list[builtins.str]"}, "params_descr": {"argv": ""}, "params_occur": {"argv": [["paths", "pathlib", "Path", "filename", "filename", "argv"]]}, "params_p": {"args": [], "argv": [["str", 0.47842664097782284], ["pathlib.Path", 0.4260307786091669], ["Union[str, pathlib.Path]", 0.09554258041301042]], "kwargs": []}, "q_name": "main", "ret_exprs": ["return len(errors)"], "ret_type": "builtins.int", "ret_type_p": [["bool", 0.2977186102353338], ["List[str]", 0.2922100000178341], ["Tuple[str]", 0.11744320938047745], ["int", 0.10018980623194572], ["list", 0.09488384557883685]], "variables": {"errors": "", "paths": ""}, "variables_p": {"errors": [["str", 0.6762291817527827], ["List[str]", 0.143868830983446], ["int", 0.09065605178927195], ["pathlib.Path", 0.08924593547449926]], "paths": [["pathlib.Path", 1.0000000000000002]]}}], "imports": ["__future__", "annotations", "ast", "enum", "itertools", "pathlib", "sys", "typing"], "mod_var_ln": {"_ALLOWED_DECORATOR_NAMES": [[67, 0], [67, 24]]}, "mod_var_occur": {"_ALLOWED_DECORATOR_NAMES": [["any", "isinstance", "node", "ast", "Name", "node", "id", "_ALLOWED_DECORATOR_NAMES", "node", "nodes"]]}, "no_types_annot": {"D": 14, "I": 0, "U": 9}, "session_id": "nDO4kDKywjjwfi33GqszBrgtfnWcFFJHdacJygVYDNw", "set": null, "tc": [false, null], "type_annot_cove": 0.61, "typed_seq": "", "untyped_seq": "", "variables": {"_ALLOWED_DECORATOR_NAMES": ""}, "variables_p": {"_ALLOWED_DECORATOR_NAMES": [["str", 0.8100978501605908], ["List[str]", 0.09283265692912503]]}}}