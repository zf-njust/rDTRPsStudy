{"error": null, "response": {"classes": [{"cls_lc": [[46, 0], [204, 19]], "cls_var_ln": {}, "cls_var_occur": {}, "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[53, 4], [63, 9]], "fn_var_ln": {"_hook": [[58, 8], [58, 18]], "base_folder": [[56, 32], [56, 43]], "bucket_name": [[56, 14], [56, 25]], "closed": [[59, 8], [59, 19]], "delete_local_copy": [[61, 8], [61, 30]], "log_relative_path": [[57, 8], [57, 30]], "upload_on_close": [[60, 8], [60, 28]]}, "fn_var_occur": {"_hook": [["self", "_hook", "None"]], "base_folder": [["self", "bucket_name", "self", "base_folder", "OSSHook", "parse_oss_url", "oss_log_folder"]], "bucket_name": [["self", "bucket_name", "self", "base_folder", "OSSHook", "parse_oss_url", "oss_log_folder"]], "closed": [["self", "closed", "False"]], "delete_local_copy": [["self", "delete_local_copy", "kwargs", "kwargs", "get_default_delete_local_copy"]], "log_relative_path": [["self", "log_relative_path"]], "upload_on_close": [["self", "upload_on_close", "True"]]}, "name": "__init__", "params": {"base_log_folder": "", "filename_template": "", "kwargs": "", "oss_log_folder": "", "self": ""}, "params_descr": {"base_log_folder": "", "filename_template": "", "kwargs": "", "oss_log_folder": "", "self": ""}, "params_occur": {"base_log_folder": [["super", "__init__", "base_log_folder", "filename_template"]], "filename_template": [["super", "__init__", "base_log_folder", "filename_template"]], "kwargs": [["self", "delete_local_copy", "kwargs", "kwargs", "get_default_delete_local_copy"]], "oss_log_folder": [["self", "bucket_name", "self", "base_folder", "OSSHook", "parse_oss_url", "oss_log_folder"]], "self": [["self", "log", "info"], ["self", "bucket_name", "self", "base_folder", "OSSHook", "parse_oss_url", "oss_log_folder"], ["self", "log_relative_path"], ["self", "_hook", "None"], ["self", "closed", "False"], ["self", "upload_on_close", "True"], ["self", "delete_local_copy", "kwargs", "kwargs", "get_default_delete_local_copy"]]}, "params_p": {"args": [], "base_log_folder": [["str", 0.19406244236381337], ["List[str]", 0.13460383987417077], ["bool", 0.1024246977366403], ["Optional[Dict]", 0.1003729622317894], ["Union[str, IO]", 0.0935663852402126], ["Optional[Callable[[], Any]]", 0.09304473831398018], ["Optional[Any]", 0.09304473831398018], ["list", 0.09142787442909459]], "filename_template": [["str", 0.19406244236381337], ["List[str]", 0.13460383987417077], ["bool", 0.1024246977366403], ["Optional[Dict]", 0.1003729622317894], ["Union[str, IO]", 0.0935663852402126], ["Optional[Callable[[], Any]]", 0.09304473831398018], ["Optional[Any]", 0.09304473831398018], ["list", 0.09142787442909459]], "kwargs": [], "oss_log_folder": [["str", 0.29135426897834465], ["List[str]", 0.22415535449570756], ["Dict[str, str]", 0.11601407279710642], ["dict", 0.10934398656344435], ["Dict[str, Any]", 0.08765262091871277], ["Optional[Dict]", 0.08759686914190147], ["Optional[str]", 0.08388282710478269]], "self": []}, "q_name": "OSSTaskHandler.__init__", "ret_exprs": [], "ret_type": "", "variables": {"_hook": "", "base_folder": "", "bucket_name": "", "closed": "", "delete_local_copy": "", "log_relative_path": "", "upload_on_close": ""}, "variables_p": {"_hook": [["\"Frame\"", 0.19999999999676038], ["str", 3.971941177518544e-12], ["Dict[str, Any]", 3.6175949269712212e-12]], "base_folder": [["Dict[str, Any]", 0.3891966169436655], ["str", 0.20936530165594835], ["dict", 0.19459830847183274], ["List[List[Any]]", 0.09729915423591637]], "bucket_name": [["str", 0.3764632365475392], ["Dict[str, str]", 0.250676559019848], ["Dict[str, Dict[str, str]]", 0.09475094023688357], ["Dict[str, Dict[str, Any]]", 0.09475094023688357], ["list", 0.09426597719159296], ["functools.partial[Any]", 0.0890923467672526]], "closed": [["dict", 0.6169768722014776], ["Set[str]", 0.1902812595168529]], "delete_local_copy": [["int", 0.393932812875819], ["str", 0.309570238807062], ["Dict[str, float]", 0.10479848758363984], ["List[int]", 0.09600030706318988], ["float", 0.09569815367028921]], "log_relative_path": [["str", 0.913732297261407], ["pathlib.Path", 0.08626770273859287]], "upload_on_close": [["str", 0.32010986135674746], ["pathlib.Path", 0.09739877717750213], ["bytes", 0.08918449966022948]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[66, 4], [78, 13]], "fn_var_ln": {"remote_conn_id": [[67, 8], [67, 22]]}, "fn_var_occur": {"remote_conn_id": [["remote_conn_id", "conf", "get"], ["self", "log", "info", "remote_conn_id"], ["OSSHook", "oss_conn_id", "remote_conn_id"], ["self", "log", "error", "remote_conn_id"]]}, "name": "hook", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "log", "info", "remote_conn_id"], ["self", "log", "exception", "e"], ["self", "log", "error", "remote_conn_id"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "OSSTaskHandler.hook", "ret_exprs": ["return OSSHook(oss_conn_id=remote_conn_id)"], "ret_type": "", "ret_type_p": [["str", 0.6987058445776235], ["bool", 0.10202493418227046]], "variables": {"remote_conn_id": ""}, "variables_p": {"remote_conn_id": [["int", 0.20332567853693778], ["dict", 0.19677158238291748], ["str", 0.18919691342610537]]}}, {"docstring": {"func": "This function is used to set the context of the handler.", "long_descr": null, "ret": null}, "fn_lc": [[80, 4], [92, 20]], "fn_var_ln": {"log_relative_path": [[85, 8], [85, 30]], "upload_on_close": [[86, 8], [86, 28]]}, "fn_var_occur": {"log_relative_path": [["self", "log_relative_path", "self", "_render_filename", "ti", "ti", "try_number"]], "upload_on_close": [["self", "upload_on_close", "ti", "raw"], ["self", "upload_on_close"]]}, "name": "set_context", "params": {"self": "", "ti": ""}, "params_descr": {"self": "", "ti": ""}, "params_occur": {"self": [["self", "log_relative_path", "self", "_render_filename", "ti", "ti", "try_number"], ["self", "upload_on_close", "ti", "raw"], ["self", "upload_on_close"], ["open", "self", "handler", "baseFilename"]], "ti": [["super", "set_context", "ti"], ["self", "log_relative_path", "self", "_render_filename", "ti", "ti", "try_number"], ["self", "upload_on_close", "ti", "raw"]]}, "params_p": {"args": [], "kwargs": [], "self": [], "ti": [["str", 0.11418351351998639], ["Exception", 0.10442417871013122], ["bool", 0.10185363018500151]]}, "q_name": "OSSTaskHandler.set_context", "ret_exprs": [], "ret_type": "", "variables": {"log_relative_path": "", "upload_on_close": ""}, "variables_p": {"log_relative_path": [["str", 0.8178992042280636]], "upload_on_close": [["str", 0.5616834529326185], ["Dict[Any, Tuple[Any, Any, Any]]", 0.07586427845590916], ["list", 0.06520736429725983], ["List[str]", 0.05955706024955479], ["int", 0.04477859420856257]]}}, {"docstring": {"func": "Close and upload local log file to remote storage OSS.", "long_descr": null, "ret": null}, "fn_lc": [[94, 4], [118, 26]], "fn_var_ln": {"closed": [[118, 8], [118, 19]], "local_loc": [[108, 8], [108, 17]], "log": [[112, 12], [112, 15]], "oss_write": [[113, 12], [113, 21]], "remote_loc": [[109, 8], [109, 18]]}, "fn_var_occur": {"closed": [["self", "closed"], ["self", "closed", "True"]], "local_loc": [["local_loc", "os", "path", "join", "self", "local_base", "self", "log_relative_path"], ["os", "path", "exists", "local_loc"], ["log", "pathlib", "Path", "local_loc", "read_text"], ["shutil", "rmtree", "os", "path", "dirname", "local_loc"]], "log": [["log", "pathlib", "Path", "local_loc", "read_text"], ["oss_write", "self", "oss_write", "log", "remote_loc"]], "oss_write": [["oss_write", "self", "oss_write", "log", "remote_loc"], ["oss_write", "self", "delete_local_copy"]], "remote_loc": [["remote_loc", "self", "log_relative_path"], ["oss_write", "self", "oss_write", "log", "remote_loc"]]}, "name": "close", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "closed"], ["self", "upload_on_close"], ["local_loc", "os", "path", "join", "self", "local_base", "self", "log_relative_path"], ["remote_loc", "self", "log_relative_path"], ["oss_write", "self", "oss_write", "log", "remote_loc"], ["oss_write", "self", "delete_local_copy"], ["self", "closed", "True"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "OSSTaskHandler.close", "ret_exprs": ["return", "return"], "ret_type": "", "ret_type_p": [["Iterator", 0.08488967993129183]], "variables": {"closed": "", "local_loc": "", "log": "", "oss_write": "", "remote_loc": ""}, "variables_p": {"closed": [["dict", 0.35915633792617185], ["int", 0.24405593695993985], ["str", 0.18091526088807333]], "local_loc": [["str", 0.8930964726396488], ["int", 0.10690352736035112]], "log": [["pathlib.Path", 0.9351273451157585], ["str", 0.034691537628871456]], "oss_write": [["str", 0.5875410945874613], ["int", 0.10472484730226365], ["Pattern[str]", 0.09981685540265238], ["Dict[str, Any]", 0.09417038572524995]], "remote_loc": [["str", 0.3829054640694497], ["int", 0.09568319330689944], ["Callable", 0.0904342463102788], ["List[str]", 0.08465733506591291], ["Optional[int]", 0.08384819999108212]]}}, {"docstring": {"func": "Read logs of given task instance and try_number from OSS remote storage.", "long_descr": "If failed, read the log from task instance host machine.", "ret": null}, "fn_lc": [[120, 4], [144, 40]], "fn_var_ln": {"log": [[143, 8], [143, 11]], "log_relative_path": [[134, 8], [134, 25]], "remote_loc": [[135, 8], [135, 18]], "remote_log": [[142, 8], [142, 18]]}, "fn_var_occur": {"log": [["log", "remote_loc", "remote_log"], ["log", "True"]], "log_relative_path": [["log_relative_path", "self", "_render_filename", "ti", "try_number"], ["remote_loc", "log_relative_path"]], "remote_loc": [["remote_loc", "log_relative_path"], ["self", "oss_log_exists", "remote_loc"], ["remote_log", "self", "oss_read", "remote_loc", "return_error", "True"], ["log", "remote_loc", "remote_log"]], "remote_log": [["remote_log", "self", "oss_read", "remote_loc", "return_error", "True"], ["log", "remote_loc", "remote_log"]]}, "name": "_read", "params": {"metadata": "", "self": "", "ti": "", "try_number": ""}, "params_descr": {"metadata": "log metadata,\ncan be used for steaming log reading and auto-tailing.", "self": "", "ti": "task instance object", "try_number": "task instance try_number to read logs from"}, "params_occur": {"metadata": [["super", "_read", "ti", "try_number", "metadata"]], "self": [["log_relative_path", "self", "_render_filename", "ti", "try_number"], ["self", "oss_log_exists", "remote_loc"], ["remote_log", "self", "oss_read", "remote_loc", "return_error", "True"]], "ti": [["log_relative_path", "self", "_render_filename", "ti", "try_number"], ["super", "_read", "ti", "try_number", "metadata"]], "try_number": [["log_relative_path", "self", "_render_filename", "ti", "try_number"], ["super", "_read", "ti", "try_number", "metadata"]]}, "params_p": {"args": [], "kwargs": [], "metadata": [["Optional[int]", 0.12414943513978384], ["List[int]", 0.10794507105774857], ["Optional[str]", 0.10696724915370898], ["List[str]", 0.10397178388944193], ["tuple", 0.1032605604163161], ["List[Dict[str, Any]]", 0.09585700991846169], ["Set[int]", 0.09099244422226704], ["List[float]", 0.08999189931434111], ["list", 0.0879267708615397]], "self": [], "ti": [["str", 0.10233688615199292], ["bool", 0.09489581267282982]], "try_number": [["str", 0.10233688615199292], ["bool", 0.09489581267282982]]}, "q_name": "OSSTaskHandler._read", "ret_exprs": ["return super()._read(ti, try_number, metadata)", "return log, {\"end_of_log\": True}"], "ret_type": "", "ret_type_p": [["Tuple[Any, Any, Any]", 0.10345879952406552], ["int", 0.09630742967164073], ["float", 0.09343105767402131], ["str", 0.09161260126090763]], "variables": {"log": "", "log_relative_path": "", "remote_loc": "", "remote_log": ""}, "variables_p": {"log": [], "log_relative_path": [["str", 0.8944561498396548], ["pathlib.Path", 0.10554385016034505]], "remote_loc": [["str", 0.7004650233731333], ["List[List[str]]", 0.10326704180195052]], "remote_log": [["Dict[str, int]", 0.10235689615541914], ["bool", 0.09477199383855922], ["list", 0.09279670050410331], ["str", 0.09090850166997042], ["Dict[str, Union[dict, int]]", 0.08945854360518551]]}}, {"docstring": {"func": "Check if remote_log_location exists in remote storage.", "long_descr": null, "ret": "True if location exists else False"}, "fn_lc": [[146, 4], [156, 20]], "fn_var_ln": {"oss_remote_log_location": [[153, 8], [153, 31]]}, "fn_var_occur": {"oss_remote_log_location": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"], ["self", "hook", "key_exist", "self", "bucket_name", "oss_remote_log_location"]]}, "name": "oss_log_exists", "params": {"remote_log_location": "", "self": ""}, "params_descr": {"remote_log_location": "log's location in remote storage", "self": ""}, "params_occur": {"remote_log_location": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"]], "self": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"], ["self", "hook", "key_exist", "self", "bucket_name", "oss_remote_log_location"]]}, "params_p": {"args": [], "kwargs": [], "remote_log_location": [["str", 0.4786425822771476], ["Optional[Callable[..., Any]]", 0.13559222940301982], ["int", 0.10201124744823768], ["Optional[str]", 0.09621298548728696]], "self": []}, "q_name": "OSSTaskHandler.oss_log_exists", "ret_exprs": ["return self.hook.key_exist(self.bucket_name, oss_remote_log_location)", "return False"], "ret_type": "", "ret_type_p": [["str", 0.5923392239106436], ["List[Dict[str, Any]]", 0.10927675745776737], ["int", 0.09407150534625154]], "variables": {"oss_remote_log_location": ""}, "variables_p": {"oss_remote_log_location": [["Pattern[str]", 0.797390008595015], ["Tuple[Literal]", 0.1086892445324009], ["Set[str]", 0.09392074687258449]]}}, {"docstring": {"func": "Returns the log at the remote_log_location. Returns '' if no logs are found or there is an error.", "long_descr": null, "ret": null}, "fn_lc": [[158, 4], [175, 26]], "fn_var_ln": {"msg": [[171, 12], [171, 15]], "oss_remote_log_location": [[167, 12], [167, 35]]}, "fn_var_occur": {"msg": [["msg", "oss_remote_log_location"], ["self", "log", "exception", "msg"]], "oss_remote_log_location": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"], ["self", "log", "info", "oss_remote_log_location"], ["self", "hook", "read_key", "self", "bucket_name", "oss_remote_log_location"], ["msg", "oss_remote_log_location"]]}, "name": "oss_read", "params": {"remote_log_location": "", "return_error": "", "self": ""}, "params_descr": {"remote_log_location": "the log's location in remote storage", "return_error": "if True, returns a string error message if an\nerror occurs. Otherwise, returns '' when an error occurs.", "self": ""}, "params_occur": {"remote_log_location": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"]], "return_error": [], "self": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"], ["self", "log", "info", "oss_remote_log_location"], ["self", "hook", "read_key", "self", "bucket_name", "oss_remote_log_location"], ["self", "log", "exception", "msg"]]}, "params_p": {"args": [], "kwargs": [], "remote_log_location": [["str", 0.22764521780766195], ["bool", 0.08513706447391763]], "return_error": [["bool", 0.4286837004468176], ["int", 0.19011320489201722], ["Optional[int]", 0.09558250448074865]], "self": []}, "q_name": "OSSTaskHandler.oss_read", "ret_exprs": ["return self.hook.read_key(self.bucket_name, oss_remote_log_location)", "return msg"], "ret_type": "", "ret_type_p": [["dict", 0.3849107943298442], ["str", 0.1821675621578648], ["cmk.utils.type_defs.EventRule", 0.112489036386827]], "variables": {"msg": "", "oss_remote_log_location": ""}, "variables_p": {"msg": [["str", 0.7942824186494327], ["Dict[str, str]", 0.08365874019312557]], "oss_remote_log_location": [["str", 0.4753389188958824], ["int", 0.19774732890335084], ["list", 0.11453532680290915], ["bool", 0.1130179485200237], ["Dict[str, int]", 0.09936047687783388]]}}, {"docstring": {"func": "Write the log to remote_log_location and return `True`; fails silently and returns `False` on error.", "long_descr": null, "ret": "whether the log is successfully written to remote location or not."}, "fn_lc": [[177, 4], [204, 19]], "fn_var_ln": {"head": [[190, 12], [190, 16]], "oss_remote_log_location": [[187, 8], [187, 31]], "pos": [[191, 12], [191, 15]]}, "fn_var_occur": {"head": [["head", "self", "hook", "head_key", "self", "bucket_name", "oss_remote_log_location"], ["pos", "head", "content_length"]], "oss_remote_log_location": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"], ["append", "self", "oss_log_exists", "oss_remote_log_location"], ["head", "self", "hook", "head_key", "self", "bucket_name", "oss_remote_log_location"], ["self", "log", "info", "oss_remote_log_location"], ["self", "hook", "append_string", "self", "bucket_name", "log", "oss_remote_log_location", "pos"], ["self", "log", "exception", "oss_remote_log_location", "str", "pos", "str", "append"]], "pos": [["pos", "head", "content_length"], ["self", "log", "info", "str", "pos"], ["self", "hook", "append_string", "self", "bucket_name", "log", "oss_remote_log_location", "pos"], ["self", "log", "exception", "oss_remote_log_location", "str", "pos", "str", "append"]]}, "name": "oss_write", "params": {"append": "", "log": "", "remote_log_location": "", "self": ""}, "params_descr": {"append": "if False, any existing log file is overwritten. If True,\nthe new log is appended to any existing logs.", "log": "the log to write to the remote_log_location", "remote_log_location": "the log's location in remote storage", "self": ""}, "params_occur": {"append": [["append", "self", "oss_log_exists", "oss_remote_log_location"], ["self", "log", "exception", "oss_remote_log_location", "str", "pos", "str", "append"]], "log": [["self", "log", "info", "str", "pos"], ["self", "log", "info", "oss_remote_log_location"], ["self", "hook", "append_string", "self", "bucket_name", "log", "oss_remote_log_location", "pos"], ["self", "log", "exception", "oss_remote_log_location", "str", "pos", "str", "append"]], "remote_log_location": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"]], "self": [["oss_remote_log_location", "self", "base_folder", "remote_log_location"], ["append", "self", "oss_log_exists", "oss_remote_log_location"], ["head", "self", "hook", "head_key", "self", "bucket_name", "oss_remote_log_location"], ["self", "log", "info", "str", "pos"], ["self", "log", "info", "oss_remote_log_location"], ["self", "hook", "append_string", "self", "bucket_name", "log", "oss_remote_log_location", "pos"], ["self", "log", "exception", "oss_remote_log_location", "str", "pos", "str", "append"]]}, "params_p": {"append": [["str", 0.4985032638971207], ["bool", 0.21822492382977798], ["Optional[str]", 0.09483291773184092], ["Optional[cmk.utils.type_defs.HostAddress]", 0.09360597680941958]], "args": [], "kwargs": [], "log": [["str", 0.33187845185130577], ["Union[int, float]", 0.0929949486921481], ["Optional[float]", 0.09102027469711328]], "remote_log_location": [["str", 0.26803365832271014], ["Optional[Callable[..., Any]]", 0.2222319342083912], ["Optional[str]", 0.17455668621692572], ["bool", 0.1397496483449571], ["int", 0.11721950670163846], ["dict", 0.07820856620537739]], "self": []}, "q_name": "OSSTaskHandler.oss_write", "ret_exprs": ["return False", "return True"], "ret_type": "builtins.bool", "ret_type_p": [["bool", 0.9999999999999999]], "variables": {"head": "", "oss_remote_log_location": "", "pos": ""}, "variables_p": {"head": [["str", 0.1817164099832898], ["dict", 0.16024001988694092], ["Optional[str]", 0.1378763975330615], ["Dict[str, Any]", 0.12510109947537676], ["int", 0.09085473600725263], ["bool", 0.08514881457261837], ["float", 0.0811861250083984]], "oss_remote_log_location": [["Dict[str, Union[Any, int, str]]", 0.4537212282996898], ["Type[Dict[str, Any]]", 0.09950846391453527], ["List[str]", 0.09078770676792133], ["dict", 0.09039945607316807], ["str", 0.0897395067254665]], "pos": [["str", 0.3949277197948332], ["Tuple[int, int]", 0.20463341744605895], ["bytes", 0.19507400738120245], ["List[int]", 0.10782785168730409], ["int", 0.09753700369060123]]}}], "name": "OSSTaskHandler", "q_name": "OSSTaskHandler", "variables": {}, "variables_p": {}}], "funcs": [{"docstring": {"func": "Load delete_local_logs conf if Airflow version > 2.6 and return False if not.", "long_descr": "TODO: delete this function when min airflow version >= 2.6", "ret": null}, "fn_lc": [[34, 0], [43, 58]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "get_default_delete_local_copy", "params": {}, "params_descr": {}, "params_occur": {}, "params_p": {"args": [], "kwargs": []}, "q_name": "get_default_delete_local_copy", "ret_exprs": ["return False", "return conf.getboolean(\"logging\", \"delete_local_logs\")"], "ret_type": "", "ret_type_p": [["bool", 0.9999999999999999]], "variables": {}, "variables_p": {}}], "imports": ["__future__", "annotations", "contextlib", "os", "pathlib", "shutil", "functools", "cached_property", "packaging", "version", "Version", "airflow", "configuration", "conf", "airflow", "providers", "alibaba", "cloud", "hooks", "oss", "OSSHook", "airflow", "utils", "log", "file_task_handler", "FileTaskHandler", "airflow", "utils", "log", "logging_mixin", "LoggingMixin", "airflow", "version", "version"], "mod_var_ln": {}, "mod_var_occur": {}, "no_types_annot": {"D": 1, "I": 0, "U": 47}, "session_id": "Kh1ZJ6ruiobCZbjdgdbGepwH_D07MnmPs7TPckGEAuE", "set": null, "tc": [false, null], "type_annot_cove": 0.02, "typed_seq": "", "untyped_seq": "", "variables": {}, "variables_p": {}}}