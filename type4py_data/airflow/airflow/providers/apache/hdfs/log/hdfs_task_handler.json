{"error": null, "response": {"classes": [{"cls_lc": [[32, 0], [135, 55]], "cls_var_ln": {}, "cls_var_occur": {}, "funcs": [{"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[35, 4], [48, 9]], "fn_var_ln": {"_hook": [[41, 8], [41, 18]], "closed": [[42, 8], [42, 19]], "delete_local_copy": [[44, 8], [44, 30]], "log_relative_path": [[40, 8], [40, 30]], "remote_base": [[39, 8], [39, 24]], "upload_on_close": [[43, 8], [43, 28]]}, "fn_var_occur": {"_hook": [["self", "_hook", "None"]], "closed": [["self", "closed", "False"]], "delete_local_copy": [["self", "delete_local_copy", "kwargs", "kwargs", "conf", "getboolean", "fallback", "False"]], "log_relative_path": [["self", "log_relative_path"]], "remote_base": [["self", "remote_base", "urlsplit", "hdfs_log_folder", "path"]], "upload_on_close": [["self", "upload_on_close", "True"]]}, "name": "__init__", "params": {"base_log_folder": "builtins.str", "filename_template": "str | None", "hdfs_log_folder": "builtins.str", "kwargs": "", "self": ""}, "params_descr": {"base_log_folder": "", "filename_template": "", "hdfs_log_folder": "", "kwargs": "", "self": ""}, "params_occur": {"base_log_folder": [["super", "__init__", "base_log_folder", "filename_template"]], "filename_template": [["super", "__init__", "base_log_folder", "filename_template"]], "hdfs_log_folder": [["self", "remote_base", "urlsplit", "hdfs_log_folder", "path"]], "kwargs": [["self", "delete_local_copy", "kwargs", "kwargs", "conf", "getboolean", "fallback", "False"]], "self": [["self", "remote_base", "urlsplit", "hdfs_log_folder", "path"], ["self", "log_relative_path"], ["self", "_hook", "None"], ["self", "closed", "False"], ["self", "upload_on_close", "True"], ["self", "delete_local_copy", "kwargs", "kwargs", "conf", "getboolean", "fallback", "False"]]}, "params_p": {"args": [], "base_log_folder": [["Optional[str]", 0.407017276855368], ["str", 0.19681324912512685], ["Optional[Dict]", 0.101735627164844], ["Union[str, List[str], Tuple[str, ...]]", 0.09512876044609524]], "filename_template": [["Optional[str]", 0.407017276855368], ["str", 0.19681324912512685], ["Optional[Dict]", 0.101735627164844], ["Union[str, List[str], Tuple[str, ...]]", 0.09512876044609524]], "hdfs_log_folder": [["str", 0.31435324563854994], ["Optional[bool]", 0.2019406267549441], ["Callable", 0.19929398163812972]], "kwargs": [], "self": []}, "q_name": "HdfsTaskHandler.__init__", "ret_exprs": [], "ret_type": "", "variables": {"_hook": "", "closed": "", "delete_local_copy": "", "log_relative_path": "", "remote_base": "", "upload_on_close": ""}, "variables_p": {"_hook": [["\"Frame\"", 0.19999999999676038], ["str", 3.971941177518544e-12], ["Dict[str, Any]", 3.6175949269712212e-12]], "closed": [["dict", 0.6169768722014776], ["Set[str]", 0.1902812595168529]], "delete_local_copy": [["Iterator[Tuple[int, ...]]", 0.3174119519079964], ["Pattern[str]", 0.22649018088882306], ["Set[str]", 0.09610929308737781], ["int", 0.0925457404657654], ["List[str]", 0.08924016024330574], ["frozenset[str]", 0.08481619127980776]], "log_relative_path": [["str", 0.913732297261407], ["pathlib.Path", 0.08626770273859287]], "remote_base": [["int", 0.2630337996583805], ["str", 0.20222653187486742], ["dict", 0.09185274094806566]], "upload_on_close": [["str", 0.32010986135674746], ["pathlib.Path", 0.09739877717750213], ["bytes", 0.08918449966022948]]}}, {"docstring": {"func": "Returns WebHDFSHook.", "long_descr": null, "ret": null}, "fn_lc": [[51, 4], [53, 85]], "fn_var_ln": {}, "fn_var_occur": {}, "name": "hook", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": []}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "HdfsTaskHandler.hook", "ret_exprs": ["return WebHDFSHook(webhdfs_conn_id=conf.get(\"logging\", \"REMOTE_LOG_CONN_ID\"))"], "ret_type": "", "ret_type_p": [["str", 0.18610433295779552], ["raiden.utils.TokenAmount", 0.09349334243516165]], "variables": {}, "variables_p": {}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[55, 4], [67, 20]], "fn_var_ln": {"full_path": [[59, 8], [59, 17]], "is_trigger_log_context": [[61, 8], [61, 30]], "log_relative_path": [[60, 8], [60, 30]], "upload_on_close": [[62, 8], [62, 28]]}, "fn_var_occur": {"full_path": [["full_path", "self", "handler", "baseFilename"], ["self", "log_relative_path", "pathlib", "Path", "full_path", "relative_to", "self", "local_base", "as_posix"]], "is_trigger_log_context": [["is_trigger_log_context", "getattr", "ti", "False"], ["self", "upload_on_close", "is_trigger_log_context", "ti", "raw"]], "log_relative_path": [["self", "log_relative_path", "pathlib", "Path", "full_path", "relative_to", "self", "local_base", "as_posix"]], "upload_on_close": [["self", "upload_on_close", "is_trigger_log_context", "ti", "raw"], ["self", "upload_on_close"]]}, "name": "set_context", "params": {"self": "", "ti": ""}, "params_descr": {"self": "", "ti": ""}, "params_occur": {"self": [["full_path", "self", "handler", "baseFilename"], ["self", "log_relative_path", "pathlib", "Path", "full_path", "relative_to", "self", "local_base", "as_posix"], ["self", "upload_on_close", "is_trigger_log_context", "ti", "raw"], ["self", "upload_on_close"], ["open", "self", "handler", "baseFilename"]], "ti": [["super", "set_context", "ti"], ["is_trigger_log_context", "getattr", "ti", "False"], ["self", "upload_on_close", "is_trigger_log_context", "ti", "raw"]]}, "params_p": {"args": [], "kwargs": [], "self": [], "ti": [["float", 0.23509137592505777]]}, "q_name": "HdfsTaskHandler.set_context", "ret_exprs": [], "ret_type": "", "variables": {"full_path": "", "is_trigger_log_context": "", "log_relative_path": "", "upload_on_close": ""}, "variables_p": {"full_path": [["pathlib.Path", 0.9999999999999999]], "is_trigger_log_context": [["bool", 0.21846919449873675], ["Dict[str, Any]", 0.17903866541201807], ["Dict[str, Union[Any, Any]]", 0.11188082238664247], ["Dict[str, str]", 0.10277581615474281], ["List[int]", 0.10101106647919895]], "log_relative_path": [["pathlib.Path", 0.9194316335541337], ["str", 0.0805683664458663]], "upload_on_close": [["str", 0.29256577413979573], ["bool", 0.11334998350835095]]}}, {"docstring": {"func": "Close and upload local log file to HDFS.", "long_descr": null, "ret": null}, "fn_lc": [[69, 4], [91, 26]], "fn_var_ln": {"closed": [[91, 8], [91, 19]], "local_loc": [[83, 8], [83, 17]], "remote_loc": [[84, 8], [84, 18]]}, "fn_var_occur": {"closed": [["self", "closed"], ["self", "closed", "True"]], "local_loc": [["local_loc", "os", "path", "join", "self", "local_base", "self", "log_relative_path"], ["os", "path", "exists", "local_loc", "os", "path", "isfile", "local_loc"], ["self", "hook", "load_file", "local_loc", "remote_loc"], ["shutil", "rmtree", "os", "path", "dirname", "local_loc"]], "remote_loc": [["remote_loc", "os", "path", "join", "self", "remote_base", "self", "log_relative_path"], ["self", "hook", "load_file", "local_loc", "remote_loc"]]}, "name": "close", "params": {"self": ""}, "params_descr": {"self": ""}, "params_occur": {"self": [["self", "closed"], ["self", "upload_on_close"], ["local_loc", "os", "path", "join", "self", "local_base", "self", "log_relative_path"], ["remote_loc", "os", "path", "join", "self", "remote_base", "self", "log_relative_path"], ["self", "hook", "load_file", "local_loc", "remote_loc"], ["self", "delete_local_copy"], ["self", "closed", "True"]]}, "params_p": {"args": [], "kwargs": [], "self": []}, "q_name": "HdfsTaskHandler.close", "ret_exprs": ["return", "return"], "ret_type": "", "ret_type_p": [["Iterator", 0.08488967993129183]], "variables": {"closed": "", "local_loc": "", "remote_loc": ""}, "variables_p": {"closed": [["dict", 0.35915633792617185], ["int", 0.24405593695993985], ["str", 0.18091526088807333]], "local_loc": [["str", 0.9999999999999999]], "remote_loc": [["str", 0.8994910514567729], ["pathlib.Path", 0.10050894854322714]]}}, {"docstring": {"func": null, "long_descr": null, "ret": null}, "fn_lc": [[93, 4], [107, 29]], "fn_var_ln": {"file_path": [[101, 8], [101, 17]], "logs": [[99, 8], [99, 12]], "messages": [[100, 8], [100, 16]], "worker_log_rel_path": [[97, 8], [97, 27]]}, "fn_var_occur": {"file_path": [["file_path", "os", "path", "join", "self", "remote_base", "worker_log_rel_path"], ["self", "hook", "check_for_path", "file_path"], ["logs", "append", "self", "hook", "read_file", "file_path", "decode"]], "logs": [["logs", "append", "self", "hook", "read_file", "file_path", "decode"], ["messages", "logs"]], "messages": [["messages", "append", "ti"], ["messages", "logs"]], "worker_log_rel_path": [["worker_log_rel_path", "self", "_render_filename", "ti", "try_number"], ["file_path", "os", "path", "join", "self", "remote_base", "worker_log_rel_path"]]}, "name": "_read_remote_logs", "params": {"metadata": "", "self": "", "ti": "", "try_number": ""}, "params_descr": {"metadata": "", "self": "", "ti": "", "try_number": ""}, "params_occur": {"metadata": [], "self": [["worker_log_rel_path", "self", "_render_filename", "ti", "try_number"], ["file_path", "os", "path", "join", "self", "remote_base", "worker_log_rel_path"], ["self", "hook", "check_for_path", "file_path"], ["logs", "append", "self", "hook", "read_file", "file_path", "decode"]], "ti": [["worker_log_rel_path", "self", "_render_filename", "ti", "try_number"], ["messages", "append", "ti"]], "try_number": [["worker_log_rel_path", "self", "_render_filename", "ti", "try_number"]]}, "params_p": {"args": [], "kwargs": [], "metadata": [["List[str]", 0.20917469928826699], ["bool", 0.20879561457670087], ["AbstractSet[str]", 0.15867171112662432], ["Callable", 0.15867171112662432], ["int", 0.11092997723840856], ["str", 0.09829129802417065]], "self": [], "ti": [["bytes", 0.09610966585396387]], "try_number": [["str", 0.21979191786254762], ["List[str]", 0.19721811181562438], ["bytes", 0.18391194679798925], ["os.PathLike", 0.09185880518587945]]}, "q_name": "HdfsTaskHandler._read_remote_logs", "ret_exprs": ["return messages, logs"], "ret_type": "", "ret_type_p": [["str", 0.3072689747625269], ["int", 0.2331730875123952], ["bool", 0.18833484208085974]], "variables": {"file_path": "", "logs": "", "messages": "", "worker_log_rel_path": ""}, "variables_p": {"file_path": [["str", 0.9175703510573823]], "logs": [["list", 1.0]], "messages": [["list", 0.17789644055797635], ["Optional[str]", 0.1737467220807956], ["Dict[str, Any]", 0.1737467220807956], ["str", 0.1067209710668767], ["Type[Dict[str, Any]]", 0.08546576690369845], ["bool", 0.08495413418015366], ["List[str]", 0.08495413418015366]], "worker_log_rel_path": [["str", 0.9999999999999999]]}}, {"docstring": {"func": "Read logs of given task instance and try_number from HDFS.", "long_descr": "If failed, read the log from task instance host machine.\n\ntodo: when min airflow version >= 2.6 then remove this method (``_read``)", "ret": null}, "fn_lc": [[109, 4], [135, 55]], "fn_var_ln": {"local_log": [[134, 12], [134, 21]], "log_prefix": [[133, 16], [133, 26]], "logs": [[126, 18], [126, 22]], "messages": [[126, 8], [126, 16]], "metadata": [[134, 23], [134, 31]]}, "fn_var_occur": {"local_log": [["local_log", "metadata", "super", "_read", "ti", "try_number", "metadata"], ["log_prefix", "local_log", "metadata"]], "log_prefix": [["log_prefix", "local_log", "metadata"]], "logs": [["messages", "logs", "self", "_read_remote_logs", "ti", "try_number", "metadata"], ["join", "x", "x", "messages", "join", "logs", "True"]], "messages": [["messages", "logs", "self", "_read_remote_logs", "ti", "try_number", "metadata"], ["join", "x", "x", "messages", "join", "logs", "True"]], "metadata": [["super", "_read", "ti", "try_number", "metadata"], ["messages", "logs", "self", "_read_remote_logs", "ti", "try_number", "metadata"], ["metadata", "metadata", "get"], ["local_log", "metadata", "super", "_read", "ti", "try_number", "metadata"], ["log_prefix", "local_log", "metadata"]]}, "name": "_read", "params": {"metadata": "", "self": "", "ti": "", "try_number": ""}, "params_descr": {"metadata": "log metadata,\ncan be used for steaming log reading and auto-tailing.", "self": "", "ti": "task instance object", "try_number": "task instance try_number to read logs from"}, "params_occur": {"metadata": [["super", "_read", "ti", "try_number", "metadata"], ["messages", "logs", "self", "_read_remote_logs", "ti", "try_number", "metadata"], ["metadata", "metadata", "get"], ["local_log", "metadata", "super", "_read", "ti", "try_number", "metadata"], ["log_prefix", "local_log", "metadata"]], "self": [["messages", "logs", "self", "_read_remote_logs", "ti", "try_number", "metadata"]], "ti": [["super", "_read", "ti", "try_number", "metadata"], ["messages", "logs", "self", "_read_remote_logs", "ti", "try_number", "metadata"], ["local_log", "metadata", "super", "_read", "ti", "try_number", "metadata"]], "try_number": [["super", "_read", "ti", "try_number", "metadata"], ["messages", "logs", "self", "_read_remote_logs", "ti", "try_number", "metadata"], ["local_log", "metadata", "super", "_read", "ti", "try_number", "metadata"]]}, "params_p": {"args": [], "kwargs": [], "metadata": [["bool", 0.11810812102840645], ["Callable", 0.08911836246315498], ["dict", 0.08813241228468924]], "self": [], "ti": [["bool", 0.10982290318484719], ["T", 0.09662996602129927], ["BinaryIO", 0.09282364025731914], ["Callable", 0.0903960518879863]], "try_number": [["bool", 0.10982290318484719], ["T", 0.09662996602129927], ["BinaryIO", 0.09282364025731914], ["Callable", 0.0903960518879863]]}, "q_name": "HdfsTaskHandler._read", "ret_exprs": ["return super()._read(ti, try_number, metadata)", "return \"\".join(f\"*** {x}n\" for x in messages) + \"n\".join(logs), {\"end_of_log\": True}", "return f\"{log_prefix}{local_log}\", metadata"], "ret_type": "", "ret_type_p": [["int", 0.30000000000000004], ["Callable", 0.2], ["str", 0.1]], "variables": {"local_log": "", "log_prefix": "", "logs": "", "messages": "", "metadata": ""}, "variables_p": {"local_log": [["bool", 0.16119176897744797], ["dict", 0.09333511538947144], ["list", 0.09096680365639633], ["List[str]", 0.08166986044991512], ["int", 0.08151340823955397]], "log_prefix": [["dict", 0.13400712234519294]], "logs": [], "messages": [["int", 0.16538233861300153], ["Dict[str, Union[Any, Any, Any, Any, Any, Any, Any, Any, Any]]", 0.12848386098502665], ["pathlib.PurePosixPath", 0.10874929634974105], ["Union[Literal, str]", 0.08128815703654914], ["Union[Literal[True], str]", 0.08128815703654914], ["str", 0.07796582674955986], ["iris.utils.prom_helpers.PromFileWriter", 0.07766417840539136]], "metadata": [["str", 0.2000324943661916], ["bytes", 0.09322943359713491]]}}], "name": "HdfsTaskHandler", "q_name": "HdfsTaskHandler", "variables": {}, "variables_p": {}}], "funcs": [], "imports": ["__future__", "annotations", "os", "pathlib", "shutil", "functools", "cached_property", "urllib", "parse", "urlsplit", "airflow", "configuration", "conf", "airflow", "providers", "apache", "hdfs", "hooks", "webhdfs", "WebHDFSHook", "airflow", "utils", "log", "file_task_handler", "FileTaskHandler", "airflow", "utils", "log", "logging_mixin", "LoggingMixin"], "mod_var_ln": {}, "mod_var_occur": {}, "no_types_annot": {"D": 3, "I": 0, "U": 35}, "session_id": "U6Puf0MYfZ1MmBzO-Q1S6VgB439rgIytwGfffkfibOk", "set": null, "tc": [false, null], "type_annot_cove": 0.08, "typed_seq": "", "untyped_seq": "", "variables": {}, "variables_p": {}}}