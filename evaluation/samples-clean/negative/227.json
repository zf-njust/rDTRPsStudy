{
    "code": "def main(unused_argv):\n  tf.logging.set_verbosity(FLAGS.log)\n\n  if not FLAGS.run_dir:\n    tf.logging.fatal('--run_dir required')\n    return\n  if not FLAGS.sequence_example_file:\n    tf.logging.fatal('--sequence_example_file required')\n    return\n\n  sequence_example_file_paths = tf.gfile.Glob(\n      os.path.expanduser(FLAGS.sequence_example_file))\n  run_dir = os.path.expanduser(FLAGS.run_dir)\n\n  config = melody_rnn_config_flags.config_from_flags()\n\n  mode = 'eval' if FLAGS.eval else 'train'\n  build_graph_fn = events_rnn_graph.get_build_graph_fn(\n      mode, config, sequence_example_file_paths)\n\n  train_dir = os.path.join(run_dir, 'train')\n  if not os.path.exists(train_dir):\n    tf.gfile.MakeDirs(train_dir)\n  tf.logging.info('Train dir: %s', train_dir)\n\n  if FLAGS.eval:\n    eval_dir = os.path.join(run_dir, 'eval')\n    if not os.path.exists(eval_dir):\n      tf.gfile.MakeDirs(eval_dir)\n    tf.logging.info('Eval dir: %s', eval_dir)\n    num_batches = (\n        (FLAGS.num_eval_examples or\n         magenta.common.count_records(sequence_example_file_paths)) //\n        config.hparams.batch_size)\n    events_rnn_train.run_eval(build_graph_fn, train_dir, eval_dir, num_batches)\n\n  else:\n    events_rnn_train.run_training(build_graph_fn, train_dir,\n                                  FLAGS.num_training_steps,\n                                  FLAGS.summary_frequency,\n                                  checkpoints_to_keep=FLAGS.num_checkpoints)",
    "smell": []
}